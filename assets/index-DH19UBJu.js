(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();const xl=!1;let Pa=Aa;const Zt=1,Cn=2,ka={owned:null,cleanups:null,context:null,owner:null};var ve=null;let Ti=null,vl=null,it=null,Me=null,gt=null,Kn=0;function $l(e,t){const r=it,n=ve,i=e.length===0,s=t===void 0?n:t,a=i?ka:{owned:null,cleanups:null,context:s?s.context:null,owner:s},o=i?e:()=>e(()=>an(()=>rn(a)));ve=a,it=null;try{return ei(o,!0)}finally{it=r,ve=n}}function Si(e,t,r){const n=Oa(e,t,!1,Zt);ts(n)}function bl(e,t,r){Pa=Sl;const n=Oa(e,t,!1,Zt);n.user=!0,gt?gt.push(n):ts(n)}function an(e){if(it===null)return e();const t=it;it=null;try{return e()}finally{it=t}}function Tl(e){bl(()=>an(e))}function _l(e,t,r){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&ei(()=>{for(let i=0;i<e.observers.length;i+=1){const s=e.observers[i],a=Ti&&Ti.running;a&&Ti.disposed.has(s),(a?!s.tState:!s.state)&&(s.pure?Me.push(s):gt.push(s),s.observers&&Ba(s)),a||(s.state=Zt)}if(Me.length>1e6)throw Me=[],new Error},!1)),t}function ts(e){if(!e.fn)return;rn(e);const t=Kn;zl(e,e.value,t)}function zl(e,t,r){let n;const i=ve,s=it;it=ve=e;try{n=e.fn(t)}catch(a){return e.pure&&(e.state=Zt,e.owned&&e.owned.forEach(rn),e.owned=null),e.updatedAt=r+1,Ca(a)}finally{it=s,ve=i}(!e.updatedAt||e.updatedAt<=r)&&(e.updatedAt!=null&&"observers"in e?_l(e,n):e.value=n,e.updatedAt=r)}function Oa(e,t,r,n=Zt,i){const s={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:ve,context:ve?ve.context:null,pure:r};return ve===null||ve!==ka&&(ve.owned?ve.owned.push(s):ve.owned=[s]),s}function Fn(e){if(e.state===0)return;if(e.state===Cn)return Ei(e);if(e.suspense&&an(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Kn);)e.state&&t.push(e);for(let r=t.length-1;r>=0;r--)if(e=t[r],e.state===Zt)ts(e);else if(e.state===Cn){const n=Me;Me=null,ei(()=>Ei(e,t[0]),!1),Me=n}}function ei(e,t){if(Me)return e();let r=!1;t||(Me=[]),gt?r=!0:gt=[],Kn++;try{const n=e();return Il(r),n}catch(n){r||(gt=null),Me=null,Ca(n)}}function Il(e){if(Me&&(Aa(Me),Me=null),e)return;const t=gt;gt=null,t.length&&ei(()=>Pa(t),!1)}function Aa(e){for(let t=0;t<e.length;t++)Fn(e[t])}function Sl(e){let t,r=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[r++]=n:Fn(n)}for(t=0;t<r;t++)Fn(e[t])}function Ei(e,t){e.state=0;for(let r=0;r<e.sources.length;r+=1){const n=e.sources[r];if(n.sources){const i=n.state;i===Zt?n!==t&&(!n.updatedAt||n.updatedAt<Kn)&&Fn(n):i===Cn&&Ei(n,t)}}}function Ba(e){for(let t=0;t<e.observers.length;t+=1){const r=e.observers[t];r.state||(r.state=Cn,r.pure?Me.push(r):gt.push(r),r.observers&&Ba(r))}}function rn(e){let t;if(e.sources)for(;e.sources.length;){const r=e.sources.pop(),n=e.sourceSlots.pop(),i=r.observers;if(i&&i.length){const s=i.pop(),a=r.observerSlots.pop();n<i.length&&(s.sourceSlots[a]=n,i[n]=s,r.observerSlots[n]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)rn(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)rn(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function El(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ca(e,t=ve){throw El(e)}function Ml(e,t){return an(()=>e(t||{}))}function Vl(e,t,r){let n=r.length,i=t.length,s=n,a=0,o=0,u=t[i-1].nextSibling,l=null;for(;a<i||o<s;){if(t[a]===r[o]){a++,o++;continue}for(;t[i-1]===r[s-1];)i--,s--;if(i===a){const p=s<n?o?r[o-1].nextSibling:r[s-o]:u;for(;o<s;)e.insertBefore(r[o++],p)}else if(s===o)for(;a<i;)(!l||!l.has(t[a]))&&t[a].remove(),a++;else if(t[a]===r[s-1]&&r[o]===t[i-1]){const p=t[--i].nextSibling;e.insertBefore(r[o++],t[a++].nextSibling),e.insertBefore(r[--s],p),t[i]=r[s]}else{if(!l){l=new Map;let d=o;for(;d<s;)l.set(r[d],d++)}const p=l.get(t[a]);if(p!=null)if(o<p&&p<s){let d=a,y=1,$;for(;++d<i&&d<s&&!(($=l.get(t[d]))==null||$!==p+y);)y++;if(y>p-o){const T=t[a];for(;o<p;)e.insertBefore(r[o++],T)}else e.replaceChild(r[o++],t[a++])}else a++;else t[a++].remove()}}}function Ul(e,t,r,n={}){let i;return $l(s=>{i=s,t===document?e():kl(t,e(),t.firstChild?null:void 0,r)},n.owner),()=>{i(),t.textContent=""}}function Pl(e,t,r,n){let i;const s=()=>{const o=document.createElement("template");return o.innerHTML=e,o.content.firstChild},a=()=>(i||(i=s())).cloneNode(!0);return a.cloneNode=a,a}function Ds(e,t,r){return an(()=>e(t,r))}function kl(e,t,r,n){if(r!==void 0&&!n&&(n=[]),typeof t!="function")return Gn(e,t,n,r);Si(i=>Gn(e,t(),i,r),n)}function Gn(e,t,r,n,i){for(;typeof r=="function";)r=r();if(t===r)return r;const s=typeof t,a=n!==void 0;if(e=a&&r[0]&&r[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===r))return r;if(a){let o=r[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),r=lr(e,r,n,o)}else r!==""&&typeof r=="string"?r=e.firstChild.data=t:r=e.textContent=t}else if(t==null||s==="boolean")r=lr(e,r,n);else{if(s==="function")return Si(()=>{let o=t();for(;typeof o=="function";)o=o();r=Gn(e,o,r,n)}),()=>r;if(Array.isArray(t)){const o=[],u=r&&Array.isArray(r);if(Mi(o,t,r,i))return Si(()=>r=Gn(e,o,r,n,!0)),()=>r;if(o.length===0){if(r=lr(e,r,n),a)return r}else u?r.length===0?qs(e,o,n):Vl(e,r,o):(r&&lr(e),qs(e,o));r=o}else if(t.nodeType){if(Array.isArray(r)){if(a)return r=lr(e,r,n,t);lr(e,r,null,t)}else r==null||r===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);r=t}}return r}function Mi(e,t,r,n){let i=!1;for(let s=0,a=t.length;s<a;s++){let o=t[s],u=r&&r[e.length],l;if(!(o==null||o===!0||o===!1))if((l=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))i=Mi(e,o,u)||i;else if(l==="function")if(n){for(;typeof o=="function";)o=o();i=Mi(e,Array.isArray(o)?o:[o],Array.isArray(u)?u:[u])||i}else e.push(o),i=!0;else{const p=String(o);u&&u.nodeType===3&&u.data===p?e.push(u):e.push(document.createTextNode(p))}}return i}function qs(e,t,r=null){for(let n=0,i=t.length;n<i;n++)e.insertBefore(t[n],r)}function lr(e,t,r,n){if(r===void 0)return e.textContent="";const i=n||document.createTextNode("");if(t.length){let s=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(i!==o){const u=o.parentNode===e;!s&&!a?u?e.replaceChild(i,o):e.insertBefore(i,r):u&&o.remove()}else s=!0}}else e.insertBefore(i,r);return[i]}var Jt="0.9.0",h=Symbol(`typegpu:${Jt}:$internal`),A=Symbol(`typegpu:${Jt}:$gpuValueOf`),se=Symbol(`typegpu:${Jt}:$getNameForward`),Xt=Symbol(`typegpu:${Jt}:$providing`),ze=Symbol(`typegpu:${Jt}:$ownSnippet`),z=Symbol(`typegpu:${Jt}:$resolve`),Or=Symbol(`typegpu:${Jt}:$repr`);function k(e){return!!e?.[h]}var re={[h]:!0,type:"void",toString(){return"void"}},Ol=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Z(e){let t=e;return k(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function Vi(e){let t=e;return k(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function Ui(e){let t=e;return k(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function Fa(e){let t=e;return k(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function at(e){return Vi(e)||Ui(e)||Fa(e)}function nt(e){let t=e;return k(t)&&typeof t.kind?.startsWith=="function"&&t.kind.startsWith("mat")}function Ga(e){return k(e)&&e?.type==="mat2x2f"}function La(e){return k(e)&&e?.type==="mat3x3f"}function Al(e){return k(e)&&e?.type==="mat4x4f"}function Ln(e){return Ga(e)||La(e)||Al(e)}function Ws(e){return Z(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function jt(e){return k(e)&&Ol.includes(e?.type)}function $e(e){return k(e)&&e?.type==="array"}function pe(e){return k(e)&&e?.type==="struct"}function qe(e){return k(e)&&e?.type==="ptr"}function jn(e){return k(e)&&e?.type==="atomic"}function rs(e){return k(e)&&e?.type==="@align"}function ns(e){return k(e)&&e?.type==="@size"}function ja(e){return k(e)&&e?.type==="@location"}function Bl(e){return k(e)&&e?.type==="@interpolate"}function is(e){return k(e)&&e?.type==="@builtin"}function We(e){return k(e)&&e?.type==="decorated"}function Ra(e){return k(e)&&e.type==="void"}function Bt(e){let t=e?.type;return k(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function ss(e){let t=e?.type;return k(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}var Cl=["abstractInt","abstractFloat","f32","f16","i32","u32","bool"];function we(e){return!k(e)||Cl.includes(e?.type)}function Fl(e){return e.schema}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(ti(e)&&k(e)&&!w(e)&&e.$name(t),e)});var Pi=globalThis;function Na(e){return!!e?.[se]}function w(e){return Na(e)?w(e[se]):ri(e)?.name}function F(e,t){Na(e)&&F(e[se],t),Gl(e,{name:t})}function ti(e){return!!e?.$name}function Xr(e){return!!ri(e)?.ast}function ri(e){return Pi.__TYPEGPU_META__.get(e)}function Gl(e,t){Pi.__TYPEGPU_META__??=new WeakMap;let r=Pi.__TYPEGPU_META__;r.set(e,{...r.get(e),...t})}var Da=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Ll={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function xt(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}function bn(e){return e.type==="ptr"?e.inner:e}var jl=["unstruct","disarray","loose-decorated",...Da];function Ar(e){return k(e)&&jl.includes(e?.type)}function vt(e){return k(e)&&e?.type==="disarray"}function Ye(e){return k(e)&&e?.type==="unstruct"}function Xe(e){return k(e)&&e?.type==="loose-decorated"}function Qr(e){return e.attribs?.find(rs)?.params[0]}function Rl(e){return e.attribs?.find(ns)?.params[0]}function Ct(e){return e.attribs?.find(ja)?.params[0]}function Br(e){return jt(e)||Ar(e)}var De={type:"unknown",toString(){return"unknown"}},qa=class{constructor(t,r,n){this.name=t,this.lhs=r,this.operator=n}},Wa=class{constructor(t){this.matrix=t}},Ys=class{constructor(t){this.op=t,F(this,"consoleLog")}[h]=!0},Nl="Invariant failed";function st(e,t){if(!e)throw new Error(Nl)}var Ir=class ki extends Error{constructor(t,r){let n=r.map(i=>`- ${Xr(i)?`fn*:${w(i)}`:i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Resolution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,ki.prototype)}appendToTrace(t){let r=[t,...this.trace];return new ki(this.cause,r)}},Xs=class Oi extends Error{constructor(t,r){let n=r.map(i=>`- ${i}`);n.length>20&&(n=[...n.slice(0,11),"...",...n.slice(-10)]),super(`Execution of the following tree failed:
${n.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=r,Object.setPrototypeOf(this,Oi.prototype)}appendToTrace(t){let r=[t,...this.trace];return new Oi(this.cause,r)}},Dl=class Ya extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,Ya.prototype)}},ql=class Xa extends Error{constructor(t){super(`Buffer '${w(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,Xa.prototype)}},Wl=class Qa extends Error{constructor(t,r){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${r}.`),Object.setPrototypeOf(this,Qa.prototype)}},as=class Ha extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(r=>w(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,Ha.prototype)}},Za=class Ja extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(r=>w(r)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Ja.prototype)}},Qs=class Ka extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ka.prototype)}},Hs=class eo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,eo.prototype)}},B=class to extends Error{constructor(t){super(t),Object.setPrototypeOf(this,to.prototype)}};function Ai(e){return e?.resourceType==="slot"}function Bi(e){return e?.resourceType==="derived"}function Ci(e){return e?.[Xt]!==void 0}function ni(e){return e?.resourceType==="accessor"}function ro(e){return e==="runtime"||e==="constant"||e==="argument"}function Sr(e){return ro(e.origin)}var Yl={uniform:{space:"uniform",access:"read"},readonly:{space:"storage",access:"read"},mutable:{space:"storage",access:"read-write"},workgroup:{space:"workgroup",access:"read-write"},private:{space:"private",access:"read-write"},function:{space:"function",access:"read-write"},"this-function":{space:"function",access:"read-write"}},no=class{constructor(t,r,n){this.value=t,this.dataType=r,this.origin=n}};function os(e){return e instanceof no}function Tn(e){return Bt(e.dataType)}function m(e,t,r){return new no(e,xt(t),r)}function us(e){return Tt("function",e,"read-write")}function Xl(e){return Tt("private",e,"read-write")}function Ql(e){return Tt("workgroup",e,"read-write")}function Hl(e,t="read"){return Tt("storage",e,t)}function Zl(e){return Tt("uniform",e,"read")}function Jl(e){return Tt("handle",e,"read")}function Tt(e,t,r,n=!1){return{[h]:!0,type:"ptr",addressSpace:e,inner:t,access:r,implicit:n,toString:()=>`ptr<${e}, ${t}, ${r}>`}}function io(e,t){let r=Yl[e];if(r)return Tt(r.space,t,r.access)}function Kl(e){return Tt(e.addressSpace,e.inner,e.access,!0)}function eh(e){return Tt(e.addressSpace,e.inner,e.access,!1)}var on=class{type="normal"},th=class{type="codegen"},rh=class{constructor(t,r){this.buffers=t,this.vars=r}type="simulate"};function so(e){return!!e?.[z]}function ii(e){return e?.[ze]}function Ee(e){return(typeof e.value!="string"||e.dataType.type==="unknown")&&ii(e.value)===void 0}function nh(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||so(e)||jt(e)||Ai(e)||Bi(e)||Ci(e)}function Fi(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var Un=!1;function ih(e){if(Un)return e();try{return Un=!0,e()}finally{Un=!1}}function Rn(){return Un}var Ut;function ao(e,t){if(st(Ut===void 0||Ut===e),Ut===e)return t();Ut=e;try{return t()}finally{Ut=void 0}}function Ue(){return Ut}var oo=new on;function Nn(){return Ut?.mode??oo}function He(){return Ut?.mode.type==="codegen"}function c(e,...t){let r=Ue();function n(s){return os(s)?r.resolve(s.value,s.dataType).value:s}let i="";for(let s=0;s<e.length;++s){i+=e[s];let a=t[s];Array.isArray(a)?i+=a.filter(o=>o!==void 0).map(n).join(", "):a&&(i+=n(a))}return i}var sh=(()=>{let e=n=>{if(n.origin==="argument")throw new B(c`d.ref(${n}) is illegal, cannot take a reference of an argument. Copy the value locally first, and take a reference of the copy.`);if(n.dataType.type==="ptr")return m(n.value,eh(n.dataType),n.origin);let i=io(n.origin,n.dataType);return m(new yt(n,i),i??De,"runtime")},t=n=>new lo(n),r=n=>He()?e(n):t(n);return F(r,"ref"),r.toString=()=>"ref",Object.defineProperty(r,h,{value:{jsImpl:t,gpuImpl:e,strictSignature:void 0,argConversionHint:"keep"}}),r})();function uo(e){return e instanceof lo}var lo=class{[h];type;#e;constructor(t){this[h]=!0,this.type="ref",this.#e=t}get $(){return this.#e}set $(t){if(t&&typeof t=="object")for(let r of Object.keys(t))this.#e[r]=t[r];else this.#e=t}},yt=class{[h];snippet;#e;constructor(t,r){this[h]=!0,this.snippet=t,this.#e=r}get[ze](){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return m(this,this.#e,this.snippet.origin)}[z](t){if(!this.#e)throw new Error(c`Cannot take a reference of ${this.snippet}`);return m(c`(&${this.snippet})`,this.#e,this.snippet.origin)}};function ls(e){if(!qe(e.dataType))return e;let t=e.dataType.inner,r=we(t)?"runtime":e.origin;return e.value instanceof yt?m(c`${e.value.snippet}`,t,r):m(c`(*${e})`,t,r)}function kr(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var hs={rank:Number.POSITIVE_INFINITY,action:"none"};function Dn(e,t){let r=xt(e),n=xt(t);if(r.type===n.type)return{rank:0,action:"none"};if(r.type==="abstractFloat"){if(n.type==="f32")return{rank:1,action:"none"};if(n.type==="f16")return{rank:2,action:"none"}}if(r.type==="abstractInt"){if(n.type==="i32")return{rank:3,action:"none"};if(n.type==="u32")return{rank:4,action:"none"};if(n.type==="abstractFloat")return{rank:5,action:"none"};if(n.type==="f32")return{rank:6,action:"none"};if(n.type==="f16")return{rank:7,action:"none"}}return at(r)&&at(n)?Dn(r.primitive,n.primitive):Ln(r)&&Ln(n)?{rank:0,action:"none"}:hs}function ah(e,t){let r=xt(e),n=xt(t);if(r.type==="ptr"&&r.implicit&&Dn(r.inner,n).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(n.type==="ptr"&&Dn(r,n.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let i={f32:0,f16:1,i32:2,u32:3,bool:4};if(r.type in i&&n.type in i){let s=r.type,a=n.type;if(s!==a){let o=i[s];return{rank:i[a]<o?10:20,action:"cast",targetType:n}}}if(r.type==="abstractFloat"){if(n.type==="u32")return{rank:2,action:"cast",targetType:n};if(n.type==="i32")return{rank:1,action:"cast",targetType:n}}return hs}function oh(e,t,r){let n=Dn(e,t);return n.rank<Number.POSITIVE_INFINITY?n:r?ah(e,t):hs}function Zs(e,t,r){let n;for(let s of t){let a=[],o=0;for(let u of e){let l=oh(u,s,r);if(o+=l.rank,l.rank===Number.POSITIVE_INFINITY)break;a.push(l)}o<(n?.sum??Number.POSITIVE_INFINITY)&&(n={type:s,details:a,sum:o})}if(!n)return;let i=n.details.map((s,a)=>({sourceIndex:a,action:s.action,...s.action==="cast"&&{targetType:s.targetType}}));return{targetType:n.type,actions:i,hasImplicitConversions:i.some(s=>s.action==="cast")}}function cs(e,t){if(e.length===0)return;let r=[...new Set((t||e).map(xt))],n=Zs(e,r,!1);if(n)return n;let i=Zs(e,r,!0);if(i)return i}function uh(e,t,r){if(t.action==="none")return m(e.value,r,e.origin);switch(t.action){case"ref":return m(new yt(e,r),r,e.origin);case"deref":return ls(e);case"cast":return r(e);default:kr(t.action,"applyActionToSnippet")}}function fe(e,t){if(e.some(n=>n.type==="unknown"))return;let r=cs(e,t);if(r)return e.map(()=>r.targetType)}function Er(e,t,r=!0){let n=e.map(s=>s.dataType);if(n.some(s=>s.type==="unknown"))return;let i=cs(n,t);if(i)return e.map((s,a)=>{let o=i.actions[a];return st(o),uh(s,o,i.targetType)})}function qt(e,t,r=!0){if(t===e.dataType)return m(e.value,t,e.origin);if(e.dataType.type==="unknown")return m(c`${m(e.value,t,e.origin)}`,t,e.origin);let n=Er([e],[t],r);if(!n)throw new B(`Cannot convert value of type '${String(e.dataType)}' to type '${t.type}'`);return n[0]}function lh(e,t){return Object.keys(e.propTypes).map(r=>{let n=t[r];if(!n)throw new Error(`Missing property ${r}`);let i=e.propTypes[r];return Er([n],[i])?.[0]??n})}var Qe=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function f(e){let t=(...n)=>{let i=Ue(),{argTypes:s,returnType:a}=typeof e.signature=="function"?e.signature(...n.map(u=>u.dataType.type==="ptr"&&u.dataType.implicit?u.dataType.inner:u.dataType)):e.signature,o=n.map((u,l)=>{let p=s[l];if(!p)throw new Error("Function called with invalid arguments");return qt(u,p,!e.ignoreImplicitCastWarning)});if(!e.noComptime&&o.every(u=>Ee(u))&&typeof e.normalImpl=="function"){i.pushMode(new on);try{return m(e.normalImpl(...o.map(u=>u.value)),a,"constant")}catch(u){if(!(u instanceof Qe))throw u}finally{i.popMode("normal")}}return m(e.codegenImpl(...o),a,"runtime")},r=((...n)=>{if(He())return t(...n);if(typeof e.normalImpl=="string")throw new Qe(e.normalImpl);return e.normalImpl(...n)});return F(r,e.name),r.toString=()=>e.name,Object.defineProperty(r,h,{value:{jsImpl:e.normalImpl,gpuImpl:t,get strictSignature(){return typeof e.signature!="function"?e.signature:void 0},argConversionHint:"keep"}}),r}var un={[h]:!0,type:"abstractInt",toString(){return"abstractInt"}},ot={[h]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},hh=f({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:C}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?c`${e}`:c`bool(${e})`}),C=Object.assign(hh,{type:"bool"}),ch=f({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:x}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?c`${e}`:c`u32(${e})`}),x=Object.assign(ch,{type:"u32"}),ph=f({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:j}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?c`${e}`:c`i32(${e})`}),fh={[h]:!0,type:"u16"},j=Object.assign(ph,{type:"i32"}),dh=f({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:v}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?c`${e}`:c`f32(${e})`}),v=Object.assign(dh,{type:"f32"}),ho=new ArrayBuffer(4),mh=new Float32Array(ho),yh=new Uint32Array(ho);function gh(e){mh[0]=e;let t=yh[0],r=t>>>31&1,n=t>>>23&255,i=t&8388607;return n===255?r<<15|31744|(i?512:0):(n=n-127+15,n<=0?n<-10?r<<15:(i=(i|8388608)>>1-n,i=i+4096>>13,r<<15|i):n>=31||(i=i+4096,i&8388608&&(i=0,++n,n>=31))?r<<15|31744:r<<15|n<<10|i>>13)}function wh(e){let t=e&32768?-1:1,r=e>>10&31,n=e&1023;return r===0?n?t*n*2**-24:t*0:r===31?n?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+n/1024)*2**(r-15)}function xh(e){return wh(gh(e))}var vh=f({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:ae}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:xh(e)},codegenImpl:e=>e.dataType.type==="f16"?c`${e}`:c`f16(${e})`}),ae=Object.assign(vh,{type:"f16"}),Kt=class extends Array{castElement(){return this[h].elementSchema[h].jsImpl}[z](){let t=this[h].elementSchema;return this.every(r=>!r)?m(`${this.kind}()`,t,"constant"):this.every(r=>this[0]===r)?m(`${this.kind}(${this[0]})`,t,"runtime"):m(`${this.kind}(${this.join(", ")})`,t,"runtime")}toString(){return this[z]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},ln=class extends Kt{e0;e1;constructor(t,r){super(2),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t)}get 0(){return this.e0}get 1(){return this.e1}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}},hn=class extends Kt{e0;e1;e2;constructor(t,r,n){super(3),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=this.castElement()(t)}set y(t){this[1]=this.castElement()(t)}set z(t){this[2]=this.castElement()(t)}},cn=class extends Kt{e0;e1;e2;e3;constructor(t,r,n,i){super(4),this.e0=this.castElement()(t),this.e1=this.castElement()(r??t),this.e2=this.castElement()(n??t),this.e3=this.castElement()(i??t)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(t){this.e0=this.castElement()(t)}set 1(t){this.e1=this.castElement()(t)}set 2(t){this.e2=this.castElement()(t)}set 3(t){this.e3=this.castElement()(t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}},ps=class co extends ln{get[h](){return{elementSchema:v}}get kind(){return"vec2f"}get _Vec2(){return co}get _Vec3(){return gs}get _Vec4(){return bs}},fs=class po extends ln{get[h](){return{elementSchema:ae}}get kind(){return"vec2h"}get _Vec2(){return po}get _Vec3(){return ws}get _Vec4(){return Ts}},ds=class fo extends ln{get[h](){return{elementSchema:j}}get kind(){return"vec2i"}get _Vec2(){return fo}get _Vec3(){return xs}get _Vec4(){return _s}},ms=class mo extends ln{get[h](){return{elementSchema:x}}get kind(){return"vec2u"}get _Vec2(){return mo}get _Vec3(){return vs}get _Vec4(){return zs}},ys=class yo extends ln{get[h](){return{elementSchema:C}}get kind(){return"vec2<bool>"}get _Vec2(){return yo}get _Vec3(){return $s}get _Vec4(){return Is}},gs=class go extends hn{get[h](){return{elementSchema:v}}get kind(){return"vec3f"}get _Vec2(){return ps}get _Vec3(){return go}get _Vec4(){return bs}},ws=class wo extends hn{get[h](){return{elementSchema:ae}}get kind(){return"vec3h"}get _Vec2(){return fs}get _Vec3(){return wo}get _Vec4(){return Ts}},xs=class xo extends hn{get[h](){return{elementSchema:j}}get kind(){return"vec3i"}get _Vec2(){return ds}get _Vec3(){return xo}get _Vec4(){return _s}},vs=class vo extends hn{get[h](){return{elementSchema:x}}get kind(){return"vec3u"}get _Vec2(){return ms}get _Vec3(){return vo}get _Vec4(){return zs}},$s=class $o extends hn{get[h](){return{elementSchema:C}}get kind(){return"vec3<bool>"}get _Vec2(){return ys}get _Vec3(){return $o}get _Vec4(){return Is}},bs=class bo extends cn{get[h](){return{elementSchema:v}}get kind(){return"vec4f"}get _Vec2(){return ps}get _Vec3(){return gs}get _Vec4(){return bo}},Ts=class To extends cn{get[h](){return{elementSchema:ae}}get kind(){return"vec4h"}get _Vec2(){return fs}get _Vec3(){return ws}get _Vec4(){return To}},_s=class _o extends cn{get[h](){return{elementSchema:j}}get kind(){return"vec4i"}get _Vec2(){return ds}get _Vec3(){return xs}get _Vec4(){return _o}},zs=class zo extends cn{get[h](){return{elementSchema:x}}get kind(){return"vec4u"}get _Vec2(){return ms}get _Vec3(){return vs}get _Vec4(){return zo}},Is=class Io extends cn{get[h](){return{elementSchema:C}}get kind(){return"vec4<bool>"}get _Vec2(){return ys}get _Vec3(){return $s}get _Vec4(){return Io}},_=be(ps,v),ut=be(fs,ae),me=be(ds,j),_e=be(ms,x),er=be(ys,C),oe=be(gs,v),lt=be(ws,ae),Pe=be(xs,j),ne=be(vs,x),tr=be($s,C),I=be(bs,v),ht=be(Ts,ae),he=be(_s,j),ye=be(zs,x),rr=be(Is,C),qn={vec2f:_,vec2h:ut,vec2i:me,vec2u:_e,"vec2<bool>":er,vec3f:oe,vec3h:lt,vec3i:Pe,vec3u:ne,"vec3<bool>":tr,vec4f:I,vec4h:ht,vec4i:he,vec4u:ye,"vec4<bool>":rr};function be(e,t){let{kind:r,length:n}=new e,i=f({name:r,signature:(...a)=>({argTypes:a.map(o=>at(o)?o:t),returnType:s}),normalImpl:(...a)=>{let o=new Array(a.length),u=0;for(let l of a)if(typeof l=="number"||typeof l=="boolean")o[u++]=l;else for(let p=0;p<l.length;++p)o[u++]=l[p];if(o.length<=1||o.length===n)return new e(...o);throw new Error(`'${r}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>a.length===1&&a[0]?.dataType===s?c`${a[0]}`:c`${r}(${a})`}),s=Object.assign(i,{type:r,primitive:t,[Or]:void 0});return e.prototype.schema=s,s}function Wn(e){return e>=2**63||e<-9223372036854776e3?m(e,ot,"constant"):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),m(e,un,"constant")):m(e,ot,"constant")}function Pt(e){return e.type==="abstractFloat"?v:e.type==="abstractInt"?j:e}function $h(e){return e.map(t=>m(t.value,Pt(t.dataType),t.origin))}function si(e){if(os(e))return e;if(uo(e))throw new Error("Cannot use refs (d.ref(...)) from the outer scope.");return ii(e)||(Z(e)||nt(e)?m(e,Fl(e),"constant"):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?m(e,De,"constant"):typeof e=="number"?Wn(e):typeof e=="boolean"?m(e,C,"constant"):m(e,De,"constant"))}function Ft(e){let t=(...n)=>{let i=n;if(!i.every(s=>Ee(s)))throw new B(`Called comptime function with runtime-known values: ${i.filter(s=>!Ee(s)).map(s=>`'${s.value}'`).join(", ")}`);return si(e(...i.map(s=>s.value)))},r=((...n)=>{let i=Ue();if(i?.mode.type==="codegen"){i.pushMode(new on);try{return t(...n)}finally{i.popMode("normal")}}return e(...n)});return r.toString=()=>"comptime",r[se]=e,r.$name=n=>(F(e,n),r),Object.defineProperty(r,h,{value:{jsImpl:e,gpuImpl:t,argConversionHint:"keep"}}),r}var S=class{constructor(e){this.type=e}[h]=!0},$t={uint8:x,uint8x2:_e,uint8x4:ye,sint8:j,sint8x2:me,sint8x4:he,unorm8:v,unorm8x2:_,unorm8x4:I,snorm8:v,snorm8x2:_,snorm8x4:I,uint16:x,uint16x2:_e,uint16x4:ye,sint16:j,sint16x2:me,sint16x4:he,unorm16:v,unorm16x2:_,unorm16x4:I,snorm16:v,snorm16x2:_,snorm16x4:I,float16:v,float16x2:_,float16x4:I,float32:v,float32x2:_,float32x3:oe,float32x4:I,uint32:x,uint32x2:_e,uint32x3:ne,uint32x4:ye,sint32:j,sint32x2:me,sint32x3:Pe,sint32x4:he,"unorm10-10-10-2":I,"unorm8x4-bgra":I},Ss=new Set(Object.keys($t)),bh=new S("uint8"),Th=new S("uint8x2"),_h=new S("uint8x4"),zh=new S("sint8"),Ih=new S("sint8x2"),Sh=new S("sint8x4"),Eh=new S("unorm8"),Mh=new S("unorm8x2"),Vh=new S("unorm8x4"),Uh=new S("snorm8"),Ph=new S("snorm8x2"),kh=new S("snorm8x4"),Oh=new S("uint16"),Ah=new S("uint16x2"),Bh=new S("uint16x4"),Ch=new S("sint16"),Fh=new S("sint16x2"),Gh=new S("sint16x4"),Lh=new S("unorm16"),jh=new S("unorm16x2"),Rh=new S("unorm16x4"),Nh=new S("snorm16"),Dh=new S("snorm16x2"),qh=new S("snorm16x4"),Wh=new S("float16"),Yh=new S("float16x2"),Xh=new S("float16x4"),Qh=new S("float32"),Hh=new S("float32x2"),Zh=new S("float32x3"),Jh=new S("float32x4"),Kh=new S("uint32"),ec=new S("uint32x2"),tc=new S("uint32x3"),rc=new S("uint32x4"),nc=new S("sint32"),ic=new S("sint32x2"),sc=new S("sint32x3"),ac=new S("sint32x4"),oc=new S("unorm10-10-10-2"),uc=new S("unorm8x4-bgra");function So(e){return k(e)&&Ss.has(e?.type)}function Gt(e,t){let r=e?.type,n=r in $t?$t[r]:e;return typeof n!="function"?t:t===void 0?n():n(t)}function ai(e){return Eo(e,!1)}function ce(e){return Eo(e,!0)}function Eo(e,t){let r=n=>Object.fromEntries(Object.entries(e).map(([i,s])=>[i,Gt(s,n?.[i])]));return Object.setPrototypeOf(r,lc),r.propTypes=e,Object.defineProperty(r,h,{value:{isAbstruct:t}}),r}var lc={type:"struct",$name(e){return F(this,e),this},toString(){return`struct:${w(this)??"<unnamed>"}`}};function Lt(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(r){return console.error("Error parsing JSON:",r),"<invalid json>"}}function Gi(e){return Z(e)||nt(e)?e.toString():Array.isArray(e)?`[${e.map(Gi).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,r])=>`${t}: ${Gi(r)}`).join(", ")} }`:String(e)}var hc={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function cc(e){let t=e?.type,r=hc[t];if(r!==void 0)return r;if(pe(e))return Object.values(e.propTypes).map(J).reduce((n,i)=>n>i?n:i);if($e(e))return J(e.elementType);if(Ye(e)){let n=Object.values(e.propTypes)[0];return n?Qr(n)??1:1}if(vt(e))return Qr(e.elementType)??1;if(We(e)||Xe(e))return Qr(e)??J(e.inner);if(Ss.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Lt(e)}`)}function pc(e){if(Ye(e)){let t=Object.values(e.propTypes)[0];return t?Ge(t):1}return vt(e)?Ge(e.elementType):Xe(e)?Qr(e)??Ge(e.inner):Qr(e)??1}var Js=new WeakMap,Ks=new WeakMap;function J(e){let t=Js.get(e);return t===void 0&&(t=cc(e),Js.set(e,t)),t}function Ge(e){let t=Ks.get(e);return t===void 0&&(t=pc(e),Ks.set(e,t)),t}function fc(e){return J(e)}var Ve=(e,t)=>{let r=t-1,n=~r;return(e&r)===0?e:(e&n)+t},dc={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function mc(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Ve(t,J(n)),t+=P(n),Number.isNaN(t)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Ve(t,J(e))}function yc(e){let t=0,r=e.propTypes;for(let n of Object.values(r)){let i=Ge(n);t=Ve(t,i),t+=P(n)}return t}function gc(e){let t=dc[e?.type];if(t!==void 0)return t;if(pe(e))return mc(e);if(Ye(e))return yc(e);if($e(e)){if(e.elementCount===0)return Number.NaN;let r=J(e.elementType);return Ve(P(e.elementType),r)*e.elementCount}if(vt(e)){let r=Ge(e.elementType);return Ve(P(e.elementType),r)*e.elementCount}if(We(e)||Xe(e))return Rl(e)??P(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var ea=new WeakMap;function P(e){let t=ea.get(e);return t===void 0&&(t=gc(e),ea.set(e,t)),t}function wc(e){return P(e)}function Cr(e,t){return We(e)?new ta(e.inner,[t,...e.attribs]):Xe(e)?new ra(e.inner,[t,...e.attribs]):Ar(e)?new ra(e,[t]):new ta(e,[t])}function xc(e,t){return Cr(t,{[h]:!0,type:"@align",params:[e]})}function vc(e,t){return Cr(t,{[h]:!0,type:"@size",params:[e]})}function Yn(e,t){return Cr(t,{[h]:!0,type:"@location",params:[e]})}function $c(e,t){return Cr(t,{[h]:!0,type:"@interpolate",params:[e]})}function bc(e){if(!bt(e))throw new Error("The @invariant attribute must only be applied to the position built-in value.");let t=We(e)||Xe(e)?e.attribs.find(is):void 0;if(!t||t.params[0]!=="position")throw new Error("The @invariant attribute must only be applied to the position built-in value.");return Cr(e,{[h]:!0,type:"@invariant",params:[]})}function bt(e){return(We(e)||Xe(e))&&e.attribs.find(is)!==void 0}function Es(e){return!We(e)&&!Xe(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var Mo=class{constructor(t,r){this.inner=t,this.attribs=r;let n=r.find(rs)?.params[0],i=r.find(ns)?.params[0];if(n!==void 0){if(n<=0)throw new Error(`Custom data alignment must be a positive number, got: ${n}.`);if(Math.log2(n)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${n}.`);if(jt(this.inner)&&n%J(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${n}, expected multiple of: ${J(this.inner)}.`)}if(i!==void 0){if(i<P(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${i}, expected at least: ${P(this.inner)}.`);if(i<=0)throw new Error(`Custom data size must be a positive number. Got: ${i}.`)}}[h]=!0},ta=class extends Mo{[h]=!0;type="decorated"},ra=class extends Mo{[h]=!0;type="loose-decorated"},Qt=Ft(((e,t)=>t===void 0?Ft(r=>na(e,r)):na(e,t))).$name("arrayOf");function na(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Gt(e,n?.[s]))};if(Object.setPrototypeOf(r,Tc),Number.isNaN(P(e)))throw new Error("Cannot nest runtime sized arrays.");if(r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return r.elementCount=t,r}var Tc={[h]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function xe(e,t){return Cr(e,{[h]:!0,type:"@builtin",params:[t]})}var Vo={vertexIndex:xe(x,"vertex_index"),instanceIndex:xe(x,"instance_index"),position:xe(I,"position"),clipDistances:xe(Qt(x,8),"clip_distances"),frontFacing:xe(C,"front_facing"),fragDepth:xe(v,"frag_depth"),sampleIndex:xe(x,"sample_index"),sampleMask:xe(x,"sample_mask"),localInvocationId:xe(ne,"local_invocation_id"),localInvocationIndex:xe(x,"local_invocation_index"),globalInvocationId:xe(ne,"global_invocation_id"),workgroupId:xe(ne,"workgroup_id"),numWorkgroups:xe(ne,"num_workgroups"),subgroupInvocationId:xe(x,"subgroup_invocation_id"),subgroupSize:xe(x,"subgroup_size")};function Pr(e,t){for(let[r,n]of Object.entries(t))e[r]=n,n&&(typeof n=="object"||typeof n=="function")&&w(n)===void 0&&F(n,r)}function _c(e,t,r){let n=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(i=>i?i[1]:void 0);r(Object.fromEntries(t.flatMap((i,s)=>{let a=n?n[s]:void 0;return pe(i)&&a!==void 0?[[a,i]]:[]})))}function Uo(e,t,r){let n=e.match(/->\s(?<output>[\w\d_]+)\s{/),i=n?n[1]?.trim():void 0;pe(t)&&i&&!/\s/g.test(i)&&r({[i]:t})}function zc(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function pn(e,t,r){return Object.entries(t).reduce((n,[i,s])=>{let a=zc(i);if(r&&i!=="Out"&&i!=="In"&&!a.test(r)&&console.warn(`The external '${i}' wasn't used in the resolved template.`),nh(s)||Ar(s)||Xr(s))return n.replaceAll(a,e.resolve(s).value);if(s!==null&&typeof s=="object"){let o=[...r.matchAll(new RegExp(`${i.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(u=>u[1]);return[...new Set(o)].reduce((u,l)=>l&&l in s?pn(e,{[`${i}.${l}`]:s[l]},u):u,n)}return console.warn(`During resolution, the external '${i}' has been omitted. Only TGPU resources, 'use gpu' functions, primitives, and plain JS objects can be used as externals.`),n},r)}function Ic(e){let{strippedCode:t,argRange:r}=Sc(e),n=new Po(t);n.consume("(");let i=[];for(;!n.isAt(")");){let a=[];for(;n.isAt("@");)n.parseUntil(ia,sa),n.consume(")"),a.push(n.lastParsed);n.parseUntil(Mc);let o=n.lastParsed,u;n.isAt(":")&&(n.consume(":"),n.parseUntil(Vc,Pc),u=n.lastParsed),i.push({identifier:o,attributes:a,type:u}),n.isAt(",")&&n.consume(",")}n.consume(")");let s;if(n.isAt("->")){n.consume("->");let a=[];for(;n.isAt("@");)n.parseUntil(ia,sa),n.consume(")"),a.push(n.lastParsed);s={type:n.str.slice(n.pos),attributes:a}}return{args:i,ret:s,range:{begin:r[0],end:r[1]}}}function Sc(e){let t=new Po(e),r="",n;for(;!t.isFinished();){if(t.isAt(Ec)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(ko),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(Uc,kc),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:r,argRange:[n,t.pos]};t.isAt("(")&&n===void 0&&(n=t.pos),n!==void 0&&(r+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var Po=class{constructor(t){this.str=t,this.#t=0}#e;#t;get pos(){return this.#t}get lastParsed(){if(this.#e===void 0)throw new Error("Parse was not called yet!");return this.str.slice(this.#e,this.pos)}isFinished(){return this.#t>=this.str.length}isAt(t){if(typeof t=="string"){for(let r=0;r<t.length;r++)if(this.str[this.#t+r]!==t[r])return!1;return!0}for(let r of t)if(this.isAt(r))return!0;return!1}parseUntil(t,r){this.#e=this.#t;let n=0;for(;this.#t<this.str.length;){if(r&&this.isAt(r[0])&&(n+=1),r&&this.isAt(r[1])&&(n-=1),n===0&&this.isAt(t))return this.#t;this.#t+=1}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){this.#t+=t}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${this.#t}, but found '${this.str.slice(this.#t,this.#t+t.length)}'`);this.advanceBy(t.length)}},ko=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),Ec=new Set([...ko," ","	","",""]),ia=new Set([")"]),Mc=new Set([":",",",")"]),Vc=new Set([",",")"]),Uc=new Set(["*/"]),sa=["(",")"],Pc=["<",">"],kc=["/*","*/"];function fn(e,t=""){let r=[],n={applyExternals(s){r.push(s)},resolve(s,a,o){let u={};for(let Te of r)Pr(u,Te);let l=s.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let Te=pn(s,u,e),Mt="",or="";if(t!==""){let ct=pe(a[0])?`(in: ${s.resolve(a[0]).value})`:"()",ur=jt(o)?Es(o):"",jr=o!==re?pe(o)?`-> ${s.resolve(o).value}`:`-> ${ur!==""?ur:"@location(0)"} ${s.resolve(o).value}`:"";Mt=`${ct} ${jr} `,or=Te}else{let ct=Ic(Te);if(ct.args.length!==a.length)throw new Error(`WGSL implementation has ${ct.args.length} arguments, while the shell has ${a.length} arguments.`);let ur=ct.args.map((Vt,xn)=>`${Vt.identifier}: ${aa(s,`parameter ${Vt.identifier}`,Vt.type,a[xn])}`).join(", "),jr=o===re?"":`-> ${aa(s,"return type",ct.ret?.type,o)}`;Mt=`(${ur}) ${jr}`,or=Te.slice(ct.range.end)}return s.addDeclaration(`${t}fn ${l}${Mt}${or}`),m(l,o,"runtime")}let p=ri(e),d=typeof p?.externals=="function"?p.externals():p?.externals;if(d){let Te=Object.fromEntries(Object.entries(d).filter(([Mt])=>!(Mt in u)));Pr(u,Te)}let y=p?.ast;if(!y)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let $=y.externalNames.filter(Te=>!(Te in u));if($.length>0)throw new Wl(w(this),$);let T=y.params[1];T&&T.type==="i"&&t!==""&&Pr(u,{[T.name]:xt(o)});let{head:G,body:Y,returnType:D}=s.fnToWgsl({functionType:t.includes("@compute")?"compute":t.includes("@vertex")?"vertex":t.includes("@fragment")?"fragment":"normal",argTypes:a,params:y.params,returnType:o,body:y.body,externalMap:u});return s.addDeclaration(`${t}fn ${l}${s.resolve(G).value}${s.resolve(Y).value}`),m(l,D,"runtime")}},i=w(e);return i!==void 0&&F(n,i),n}function aa(e,t,r,n){let i=e.resolve(n).value.replace(/\s/g,"");if(!r)return i;let s=r.replace(/\s/g,"");if(s!==i)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${i}", WGSL type "${s}".`);return r}function Oc(e,t={}){let r=0,n=new Set;return Object.fromEntries(Object.entries(e??{}).map(([i,s])=>{let a=Ct(s);if(a!==void 0){if(n.has(a))throw new Error("Duplicate custom location attributes found");n.add(a)}return[i,s]}).map(([i,s])=>{if(bt(s))return[i,s];if(Ct(s)!==void 0)return[i,s];if(t[i])return[i,Yn(t[i],s)];for(;n.has(r);)r++;return[i,Yn(r++,s)]}))}function dn(e,t={}){return Br(e)?Ra(e)||bt(e)||Ct(e)!==void 0?e:Yn(0,e):ai(Oc(e,t))}function oi(e,...t){return Ac(e)?Bc(e,...t):e}function Ac(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function Bc(e,...t){return e.slice(1).reduce((r,n,i)=>`${r}${t[i]}${n}`,e[0])}function Cc(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[dn(e.in)]:[],isEntry:!0};return Object.assign((r,...n)=>Fc(t,oi(r,...n)),t)}function Fc(e,t){let r=fn(t,"@vertex "),n=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[h]:!0,[se]:r,$name(i){return F(r,i),ti(n)&&n.$name(`${i}_Input`),this},[z](i){let s=dn(e.out,i.varyingLocations).$name(`${w(this)??""}_Output`);return typeof t=="string"&&(n&&r.applyExternals({In:n}),r.applyExternals({Out:s})),r.resolve(i,e.argTypes,s)},toString(){return`vertexFn:${w(r)??"<unnamed>"}`}}}var Fr=class{};function Ms(e){let t=f({name:e.type,normalImpl:(...n)=>{let i=[];for(let s of n)if(typeof s=="number")i.push(s);else for(let a=0;a<s.length;++a)i.push(s[a]);if(i.length!==0&&i.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let s=i.length;s<e.columns*e.rows;++s)i.push(0);return new e.MatImpl(...i)},ignoreImplicitCastWarning:!0,signature:(...n)=>({argTypes:n.map(i=>at(i)?i:v),returnType:r}),codegenImpl:(...n)=>c`${e.type}(${n})`}),r=Object.assign(t,{type:e.type,identity:qc[e.columns],translation:e.columns===4?ui:void 0,scaling:e.columns===4?li:void 0,rotationX:e.columns===4?hi:void 0,rotationY:e.columns===4?ci:void 0,rotationZ:e.columns===4?pi:void 0});return e.MatImpl.prototype.schema=r,r}var Gc=class extends Fr{[h]=!0;columns;length=4;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1]),this.makeColumn(t[2],t[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[1].x=t}set 3(t){this.columns[1].y=t}*[Symbol.iterator](){yield this[0],yield this[1],yield this[2],yield this[3]}[z](){return m(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,_t,"runtime")}toString(){return this[z]().value}},Lc=class extends Gc{kind="mat2x2f";makeColumn(t,r){return _(t,r)}},jc=class extends Fr{[h]=!0;columns;length=12;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[Symbol.iterator](){for(let t=0;t<12;t++)yield this[t]}[z](){return m(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,zt,"runtime")}toString(){return this[z]().value}},Rc=class extends jc{kind="mat3x3f";makeColumn(t,r,n){return oe(t,r,n)}},Nc=class extends Fr{[h]=!0;columns;constructor(...t){super(),this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}length=16;get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[Symbol.iterator](){for(let t=0;t<16;t++)yield this[t]}[z](){return m(`${this.kind}(${Array.from({length:this.length}).map((t,r)=>this[r]).join(", ")})`,W,"runtime")}toString(){return this[z]().value}},Dc=class extends Nc{kind="mat4x4f";makeColumn(t,r,n,i){return I(t,r,n,i)}},Oo=Ft(()=>_t(1,0,0,1)).$name("identity2"),Ao=Ft(()=>zt(1,0,0,0,1,0,0,0,1)).$name("identity3"),Bo=Ft(()=>W(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)).$name("identity4"),qc={2:Oo,3:Ao,4:Bo},ui=f({name:"translation4",normalImpl:e=>W(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),get signature(){return{argTypes:[oe],returnType:W}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`}),li=f({name:"scaling4",normalImpl:e=>W(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),get signature(){return{argTypes:[oe],returnType:W}},codegenImpl:e=>c`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`}),hi=f({name:"rotationX4",normalImpl:e=>W(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[v],returnType:W}},codegenImpl:e=>c`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`}),ci=f({name:"rotationY4",normalImpl:e=>W(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),get signature(){return{argTypes:[v],returnType:W}},codegenImpl:e=>c`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`}),pi=f({name:"rotationZ4",normalImpl:e=>W(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),get signature(){return{argTypes:[v],returnType:W}},codegenImpl:e=>c`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`}),_t=Ms({type:"mat2x2f",rows:2,columns:2,MatImpl:Lc}),zt=Ms({type:"mat3x3f",rows:3,columns:3,MatImpl:Rc}),W=Ms({type:"mat4x4f",rows:4,columns:4,MatImpl:Dc});function Wc(e){return e.kind==="mat3x3f"?[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]:Array.from({length:e.length}).map((t,r)=>e[r])}var Wt=(e,t,r)=>{if(e===t)return 0;let n=M((r-e)/(t-e),0,1);return n*n*(3-2*n)},M=(e,t,r)=>Math.min(Math.max(t,e),r),hr=(e,t)=>t===0?e:Math.trunc(e/t);function Je(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function Ke(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Oe=er[h].jsImpl,Ce=_[h].jsImpl,dt=ut[h].jsImpl,Mr=me[h].jsImpl,Hr=_e[h].jsImpl,Ae=tr[h].jsImpl,Se=oe[h].jsImpl,et=lt[h].jsImpl,Vr=Pe[h].jsImpl,Zr=ne[h].jsImpl,Be=rr[h].jsImpl,Fe=I[h].jsImpl,mt=ht[h].jsImpl,Ur=he[h].jsImpl,Jr=ye[h].jsImpl,cr=e=>Math.sqrt(e.x**2+e.y**2),pr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),fr=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),_n=(e,t)=>e.x*t.x+e.y*t.y,zn=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,In=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,q=e=>t=>Ce(e(t.x),e(t.y)),X=e=>t=>dt(e(t.x),e(t.y)),dr=e=>t=>Mr(e(t.x),e(t.y)),Rr=e=>t=>Hr(e(t.x),e(t.y)),N=e=>t=>Se(e(t.x),e(t.y),e(t.z)),Q=e=>t=>et(e(t.x),e(t.y),e(t.z)),mr=e=>t=>Vr(e(t.x),e(t.y),e(t.z)),Nr=e=>t=>Zr(e(t.x),e(t.y),e(t.z)),R=e=>t=>Fe(e(t.x),e(t.y),e(t.z),e(t.w)),H=e=>t=>mt(e(t.x),e(t.y),e(t.z),e(t.w)),yr=e=>t=>Ur(e(t.x),e(t.y),e(t.z),e(t.w)),Dr=e=>t=>Jr(e(t.x),e(t.y),e(t.z),e(t.w)),oa=e=>t=>{let r=t.columns;return _t(q(e)(r[0]),q(e)(r[1]))},ua=e=>t=>{let r=t.columns;return zt(N(e)(r[0]),N(e)(r[1]),N(e)(r[2]))},la=e=>t=>{let r=t.columns;return W(R(e)(r[0]),R(e)(r[1]),R(e)(r[2]),R(e)(r[3]))},ft=e=>(t,r)=>Ce(e(t.x,r.x),e(t.y,r.y)),Rt=e=>(t,r)=>dt(e(t.x,r.x),e(t.y,r.y)),gr=e=>(t,r)=>Mr(e(t.x,r.x),e(t.y,r.y)),wr=e=>(t,r)=>Hr(e(t.x,r.x),e(t.y,r.y)),tt=e=>(t,r)=>Se(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Nt=e=>(t,r)=>et(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),xr=e=>(t,r)=>Vr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),vr=e=>(t,r)=>Zr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z)),Ne=e=>(t,r)=>Fe(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Dt=e=>(t,r)=>mt(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),$r=e=>(t,r)=>Ur(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),br=e=>(t,r)=>Jr(e(t.x,r.x),e(t.y,r.y),e(t.z,r.z),e(t.w,r.w)),Yc=e=>(t,r)=>{let n=t.columns,i=r.columns;return _t(ft(e)(n[0],i[0]),ft(e)(n[1],i[1]))},Xc=e=>(t,r)=>{let n=t.columns,i=r.columns;return zt(tt(e)(n[0],i[0]),tt(e)(n[1],i[1]),tt(e)(n[2],i[2]))},Qc=e=>(t,r)=>{let n=t.columns,i=r.columns;return W(Ne(e)(n[0],i[0]),Ne(e)(n[1],i[1]),Ne(e)(n[2],i[2]),Ne(e)(n[3],i[3]))},Hc=e=>(t,r,n)=>Ce(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),Zc=e=>(t,r,n)=>dt(e(t.x,r.x,n.x),e(t.y,r.y,n.y)),Jc=e=>(t,r,n)=>Se(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),Kc=e=>(t,r,n)=>et(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z)),ep=e=>(t,r,n)=>Fe(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),tp=e=>(t,r,n)=>mt(e(t.x,r.x,n.x),e(t.y,r.y,n.y),e(t.z,r.z,n.z),e(t.w,r.w,n.w)),b={eq:{vec2f:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Oe(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Oe(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Oe(e.x===t.x,e.y===t.y),vec3f:(e,t)=>Ae(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>Ae(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>Ae(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>Ae(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>Ae(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Be(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Oe(e.x<t.x,e.y<t.y),vec3f:(e,t)=>Ae(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>Ae(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>Ae(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>Ae(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Be(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Oe(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>Ae(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Be(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:q(Math.abs),vec2h:X(Math.abs),vec2i:dr(Math.abs),vec2u:Rr(Math.abs),vec3f:N(Math.abs),vec3h:Q(Math.abs),vec3i:mr(Math.abs),vec3u:Nr(Math.abs),vec4f:R(Math.abs),vec4h:H(Math.abs),vec4i:yr(Math.abs),vec4u:Dr(Math.abs)},atan2:{vec2f:ft(Math.atan2),vec2h:Rt(Math.atan2),vec3f:tt(Math.atan2),vec3h:Nt(Math.atan2),vec4f:Ne(Math.atan2),vec4h:Dt(Math.atan2)},acos:{vec2f:q(Math.acos),vec2h:X(Math.acos),vec2i:dr(Math.acos),vec2u:Rr(Math.acos),vec3f:N(Math.acos),vec3h:Q(Math.acos),vec3i:mr(Math.acos),vec3u:Nr(Math.acos),vec4f:R(Math.acos),vec4h:H(Math.acos),vec4i:yr(Math.acos),vec4u:Dr(Math.acos)},acosh:{vec2f:q(Math.acosh),vec2h:X(Math.acosh),vec3f:N(Math.acosh),vec3h:Q(Math.acosh),vec4f:R(Math.acosh),vec4h:H(Math.acosh)},asin:{vec2f:q(Math.asin),vec2h:X(Math.asin),vec3f:N(Math.asin),vec3h:Q(Math.asin),vec4f:R(Math.asin),vec4h:H(Math.asin)},asinh:{vec2f:q(Math.asinh),vec2h:X(Math.asinh),vec3f:N(Math.asinh),vec3h:Q(Math.asinh),vec4f:R(Math.asinh),vec4h:H(Math.asinh)},atan:{vec2f:q(Math.atan),vec2h:X(Math.atan),vec3f:N(Math.atan),vec3h:Q(Math.atan),vec4f:R(Math.atan),vec4h:H(Math.atan)},atanh:{vec2f:q(Math.atanh),vec2h:X(Math.atanh),vec3f:N(Math.atanh),vec3h:Q(Math.atanh),vec4f:R(Math.atanh),vec4h:H(Math.atanh)},ceil:{vec2f:q(Math.ceil),vec2h:X(Math.ceil),vec3f:N(Math.ceil),vec3h:Q(Math.ceil),vec4f:R(Math.ceil),vec4h:H(Math.ceil)},clamp:{vec2f:(e,t,r)=>Ce(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2h:(e,t,r)=>dt(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2i:(e,t,r)=>Mr(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec2u:(e,t,r)=>Hr(M(e.x,t.x,r.x),M(e.y,t.y,r.y)),vec3f:(e,t,r)=>Se(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3h:(e,t,r)=>et(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3i:(e,t,r)=>Vr(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec3u:(e,t,r)=>Zr(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z)),vec4f:(e,t,r)=>Fe(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4h:(e,t,r)=>mt(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4i:(e,t,r)=>Ur(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w)),vec4u:(e,t,r)=>Jr(M(e.x,t.x,r.x),M(e.y,t.y,r.y),M(e.z,t.z,r.z),M(e.w,t.w,r.w))},length:{vec2f:cr,vec2h:cr,vec3f:pr,vec3h:pr,vec4f:fr,vec4h:fr},add:{vec2f:ft((e,t)=>e+t),vec2h:Rt((e,t)=>e+t),vec2i:gr((e,t)=>e+t),vec2u:wr((e,t)=>e+t),vec3f:tt((e,t)=>e+t),vec3h:Nt((e,t)=>e+t),vec3i:xr((e,t)=>e+t),vec3u:vr((e,t)=>e+t),vec4f:Ne((e,t)=>e+t),vec4h:Dt((e,t)=>e+t),vec4i:$r((e,t)=>e+t),vec4u:br((e,t)=>e+t),mat2x2f:Yc((e,t)=>e+t),mat3x3f:Xc((e,t)=>e+t),mat4x4f:Qc((e,t)=>e+t)},smoothstep:{vec2f:Hc(Wt),vec2h:Zc(Wt),vec3f:Jc(Wt),vec3h:Kc(Wt),vec4f:ep(Wt),vec4h:tp(Wt)},addMixed:{vec2f:(e,t)=>q(r=>r+t)(e),vec2h:(e,t)=>X(r=>r+t)(e),vec2i:(e,t)=>dr(r=>r+t)(e),vec2u:(e,t)=>Rr(r=>r+t)(e),vec3f:(e,t)=>N(r=>r+t)(e),vec3h:(e,t)=>Q(r=>r+t)(e),vec3i:(e,t)=>mr(r=>r+t)(e),vec3u:(e,t)=>Nr(r=>r+t)(e),vec4f:(e,t)=>R(r=>r+t)(e),vec4h:(e,t)=>H(r=>r+t)(e),vec4i:(e,t)=>yr(r=>r+t)(e),vec4u:(e,t)=>Dr(r=>r+t)(e),mat2x2f:(e,t)=>oa(r=>r+t)(e),mat3x3f:(e,t)=>ua(r=>r+t)(e),mat4x4f:(e,t)=>la(r=>r+t)(e)},mulSxV:{vec2f:(e,t)=>q(r=>e*r)(t),vec2h:(e,t)=>X(r=>e*r)(t),vec2i:(e,t)=>dr(r=>e*r)(t),vec2u:(e,t)=>Rr(r=>e*r)(t),vec3f:(e,t)=>N(r=>e*r)(t),vec3h:(e,t)=>Q(r=>e*r)(t),vec3i:(e,t)=>mr(r=>e*r)(t),vec3u:(e,t)=>Nr(r=>e*r)(t),vec4f:(e,t)=>R(r=>e*r)(t),vec4h:(e,t)=>H(r=>e*r)(t),vec4i:(e,t)=>yr(r=>e*r)(t),vec4u:(e,t)=>Dr(r=>e*r)(t),mat2x2f:(e,t)=>oa(r=>e*r)(t),mat3x3f:(e,t)=>ua(r=>e*r)(t),mat4x4f:(e,t)=>la(r=>e*r)(t)},mulVxV:{vec2f:ft((e,t)=>e*t),vec2h:Rt((e,t)=>e*t),vec2i:gr((e,t)=>e*t),vec2u:wr((e,t)=>e*t),vec3f:tt((e,t)=>e*t),vec3h:Nt((e,t)=>e*t),vec3i:xr((e,t)=>e*t),vec3u:vr((e,t)=>e*t),vec4f:Ne((e,t)=>e*t),vec4h:Dt((e,t)=>e*t),vec4i:$r((e,t)=>e*t),vec4u:br((e,t)=>e*t),mat2x2f:(e,t)=>{let r=e.columns,n=t.columns;return _t(r[0].x*n[0].x+r[1].x*n[0].y,r[0].y*n[0].x+r[1].y*n[0].y,r[0].x*n[1].x+r[1].x*n[1].y,r[0].y*n[1].x+r[1].y*n[1].y)},mat3x3f:(e,t)=>{let r=e.columns,n=t.columns;return zt(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z)},mat4x4f:(e,t)=>{let r=e.columns,n=t.columns;return W(r[0].x*n[0].x+r[1].x*n[0].y+r[2].x*n[0].z+r[3].x*n[0].w,r[0].y*n[0].x+r[1].y*n[0].y+r[2].y*n[0].z+r[3].y*n[0].w,r[0].z*n[0].x+r[1].z*n[0].y+r[2].z*n[0].z+r[3].z*n[0].w,r[0].w*n[0].x+r[1].w*n[0].y+r[2].w*n[0].z+r[3].w*n[0].w,r[0].x*n[1].x+r[1].x*n[1].y+r[2].x*n[1].z+r[3].x*n[1].w,r[0].y*n[1].x+r[1].y*n[1].y+r[2].y*n[1].z+r[3].y*n[1].w,r[0].z*n[1].x+r[1].z*n[1].y+r[2].z*n[1].z+r[3].z*n[1].w,r[0].w*n[1].x+r[1].w*n[1].y+r[2].w*n[1].z+r[3].w*n[1].w,r[0].x*n[2].x+r[1].x*n[2].y+r[2].x*n[2].z+r[3].x*n[2].w,r[0].y*n[2].x+r[1].y*n[2].y+r[2].y*n[2].z+r[3].y*n[2].w,r[0].z*n[2].x+r[1].z*n[2].y+r[2].z*n[2].z+r[3].z*n[2].w,r[0].w*n[2].x+r[1].w*n[2].y+r[2].w*n[2].z+r[3].w*n[2].w,r[0].x*n[3].x+r[1].x*n[3].y+r[2].x*n[3].z+r[3].x*n[3].w,r[0].y*n[3].x+r[1].y*n[3].y+r[2].y*n[3].z+r[3].y*n[3].w,r[0].z*n[3].x+r[1].z*n[3].y+r[2].z*n[3].z+r[3].z*n[3].w,r[0].w*n[3].x+r[1].w*n[3].y+r[2].w*n[3].z+r[3].w*n[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let r=e.columns;return Ce(r[0].x*t.x+r[1].x*t.y,r[0].y*t.x+r[1].y*t.y)},mat3x3f:(e,t)=>{let r=e.columns;return Se(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z)},mat4x4f:(e,t)=>{let r=e.columns;return Fe(r[0].x*t.x+r[1].x*t.y+r[2].x*t.z+r[3].x*t.w,r[0].y*t.x+r[1].y*t.y+r[2].y*t.z+r[3].y*t.w,r[0].z*t.x+r[1].z*t.y+r[2].z*t.z+r[3].z*t.w,r[0].w*t.x+r[1].w*t.y+r[2].w*t.z+r[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let r=t.columns;return Ce(e.x*r[0].x+e.y*r[0].y,e.x*r[1].x+e.y*r[1].y)},mat3x3f:(e,t)=>{let r=t.columns;return Se(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z)},mat4x4f:(e,t)=>{let r=t.columns;return Fe(e.x*r[0].x+e.y*r[0].y+e.z*r[0].z+e.w*r[0].w,e.x*r[1].x+e.y*r[1].y+e.z*r[1].z+e.w*r[1].w,e.x*r[2].x+e.y*r[2].y+e.z*r[2].z+e.w*r[2].w,e.x*r[3].x+e.y*r[3].y+e.z*r[3].z+e.w*r[3].w)}},div:{vec2f:ft((e,t)=>e/t),vec2h:Rt((e,t)=>e/t),vec2i:gr(hr),vec2u:wr(hr),vec3f:tt((e,t)=>e/t),vec3h:Nt((e,t)=>e/t),vec3i:xr(hr),vec3u:vr(hr),vec4f:Ne((e,t)=>e/t),vec4h:Dt((e,t)=>e/t),vec4i:$r(hr),vec4u:br(hr)},dot:{vec2f:_n,vec2h:_n,vec2i:_n,vec2u:_n,vec3f:zn,vec3h:zn,vec3i:zn,vec3u:zn,vec4f:In,vec4h:In,vec4i:In,vec4u:In},normalize:{vec2f:e=>{let t=cr(e);return Ce(e.x/t,e.y/t)},vec2h:e=>{let t=cr(e);return dt(e.x/t,e.y/t)},vec2i:e=>{let t=cr(e);return Mr(e.x/t,e.y/t)},vec2u:e=>{let t=cr(e);return Hr(e.x/t,e.y/t)},vec3f:e=>{let t=pr(e);return Se(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=pr(e);return et(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=pr(e);return Vr(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=pr(e);return Zr(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=fr(e);return Fe(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=fr(e);return mt(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=fr(e);return Ur(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=fr(e);return Jr(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>Se(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>et(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:ft((e,t)=>e%t),vec2h:Rt((e,t)=>e%t),vec2i:gr((e,t)=>e%t),vec2u:wr((e,t)=>e%t),vec3f:tt((e,t)=>e%t),vec3h:Nt((e,t)=>e%t),vec3i:xr((e,t)=>e%t),vec3u:vr((e,t)=>e%t),vec4f:Ne((e,t)=>e%t),vec4h:Dt((e,t)=>e%t),vec4i:$r((e,t)=>e%t),vec4u:br((e,t)=>e%t)},floor:{vec2f:q(Math.floor),vec2h:X(Math.floor),vec3f:N(Math.floor),vec3h:Q(Math.floor),vec4f:R(Math.floor),vec4h:H(Math.floor)},max:{vec2f:ft(Math.max),vec2h:Rt(Math.max),vec2i:gr(Math.max),vec2u:wr(Math.max),vec3f:tt(Math.max),vec3h:Nt(Math.max),vec3i:xr(Math.max),vec3u:vr(Math.max),vec4f:Ne(Math.max),vec4h:Dt(Math.max),vec4i:$r(Math.max),vec4u:br(Math.max)},min:{vec2f:ft(Math.min),vec2h:Rt(Math.min),vec2i:gr(Math.min),vec2u:wr(Math.min),vec3f:tt(Math.min),vec3h:Nt(Math.min),vec3i:xr(Math.min),vec3u:vr(Math.min),vec4f:Ne(Math.min),vec4h:Dt(Math.min),vec4i:$r(Math.min),vec4u:br(Math.min)},pow:{vec2f:(e,t)=>Ce(e.x**t.x,e.y**t.y),vec2h:(e,t)=>dt(e.x**t.x,e.y**t.y),vec3f:(e,t)=>Se(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>et(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Fe(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>mt(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:q(Math.sign),vec2h:X(Math.sign),vec2i:dr(Math.sign),vec3f:N(Math.sign),vec3h:Q(Math.sign),vec3i:mr(Math.sign),vec4f:R(Math.sign),vec4h:H(Math.sign),vec4i:yr(Math.sign)},sqrt:{vec2f:q(Math.sqrt),vec2h:X(Math.sqrt),vec3f:N(Math.sqrt),vec3h:Q(Math.sqrt),vec4f:R(Math.sqrt),vec4h:H(Math.sqrt)},mix:{vec2f:(e,t,r)=>typeof r=="number"?Ce(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):Ce(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec2h:(e,t,r)=>typeof r=="number"?dt(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r):dt(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y),vec3f:(e,t,r)=>typeof r=="number"?Se(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):Se(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec3h:(e,t,r)=>typeof r=="number"?et(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r):et(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z),vec4f:(e,t,r)=>typeof r=="number"?Fe(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):Fe(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w),vec4h:(e,t,r)=>typeof r=="number"?mt(e.x*(1-r)+t.x*r,e.y*(1-r)+t.y*r,e.z*(1-r)+t.z*r,e.w*(1-r)+t.w*r):mt(e.x*(1-r.x)+t.x*r.x,e.y*(1-r.y)+t.y*r.y,e.z*(1-r.z)+t.z*r.z,e.w*(1-r.w)+t.w*r.w)},sin:{vec2f:q(Math.sin),vec2h:X(Math.sin),vec3f:N(Math.sin),vec3h:Q(Math.sin),vec4f:R(Math.sin),vec4h:H(Math.sin)},cos:{vec2f:q(Math.cos),vec2h:X(Math.cos),vec3f:N(Math.cos),vec3h:Q(Math.cos),vec4f:R(Math.cos),vec4h:H(Math.cos)},cosh:{vec2f:q(Math.cosh),vec2h:X(Math.cosh),vec3f:N(Math.cosh),vec3h:Q(Math.cosh),vec4f:R(Math.cosh),vec4h:H(Math.cosh)},exp:{vec2f:q(Math.exp),vec2h:X(Math.exp),vec3f:N(Math.exp),vec3h:Q(Math.exp),vec4f:R(Math.exp),vec4h:H(Math.exp)},exp2:{vec2f:q(e=>2**e),vec2h:X(e=>2**e),vec3f:N(e=>2**e),vec3h:Q(e=>2**e),vec4f:R(e=>2**e),vec4h:H(e=>2**e)},log:{vec2f:q(Math.log),vec2h:X(Math.log),vec3f:N(Math.log),vec3h:Q(Math.log),vec4f:R(Math.log),vec4h:H(Math.log)},log2:{vec2f:q(Math.log2),vec2h:X(Math.log2),vec3f:N(Math.log2),vec3h:Q(Math.log2),vec4f:R(Math.log2),vec4h:H(Math.log2)},fract:{vec2f:q(e=>e-Math.floor(e)),vec2h:X(e=>e-Math.floor(e)),vec3f:N(e=>e-Math.floor(e)),vec3h:Q(e=>e-Math.floor(e)),vec4f:R(e=>e-Math.floor(e)),vec4h:H(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:q(e=>-e),vec2h:X(e=>-e),vec2i:dr(e=>-e),vec2u:Rr(e=>-e),"vec2<bool>":e=>Oe(!e.x,!e.y),vec3f:N(e=>-e),vec3h:Q(e=>-e),vec3i:mr(e=>-e),vec3u:Nr(e=>-e),"vec3<bool>":e=>Ae(!e.x,!e.y,!e.z),vec4f:R(e=>-e),vec4h:H(e=>-e),vec4i:yr(e=>-e),vec4u:Dr(e=>-e),"vec4<bool>":e=>Be(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,r)=>Ce(r.x?t.x:e.x,r.y?t.y:e.y),vec2h:(e,t,r)=>dt(r.x?t.x:e.x,r.y?t.y:e.y),vec2i:(e,t,r)=>Mr(r.x?t.x:e.x,r.y?t.y:e.y),vec2u:(e,t,r)=>Hr(r.x?t.x:e.x,r.y?t.y:e.y),"vec2<bool>":(e,t,r)=>Oe(r.x?t.x:e.x,r.y?t.y:e.y),vec3f:(e,t,r)=>Se(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3h:(e,t,r)=>et(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3i:(e,t,r)=>Vr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec3u:(e,t,r)=>Zr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),"vec3<bool>":(e,t,r)=>Ae(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z),vec4f:(e,t,r)=>Fe(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4h:(e,t,r)=>mt(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4i:(e,t,r)=>Ur(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),vec4u:(e,t,r)=>Jr(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w),"vec4<bool>":(e,t,r)=>Be(r.x?t.x:e.x,r.y?t.y:e.y,r.z?t.z:e.z,r.w?t.w:e.w)},tanh:{vec2f:q(Math.tanh),vec2h:X(Math.tanh),vec3f:N(Math.tanh),vec3h:Q(Math.tanh),vec4f:R(Math.tanh),vec4h:H(Math.tanh)},bitcastU32toF32:{vec2u:e=>Ce(Je(e.x),Je(e.y)),vec3u:e=>Se(Je(e.x),Je(e.y),Je(e.z)),vec4u:e=>Fe(Je(e.x),Je(e.y),Je(e.z),Je(e.w))},bitcastU32toI32:{vec2u:e=>Mr(Ke(e.x),Ke(e.y)),vec3u:e=>Vr(Ke(e.x),Ke(e.y),Ke(e.z)),vec4u:e=>Ur(Ke(e.x),Ke(e.y),Ke(e.z),Ke(e.w))}};function Co(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Z(t))return b.addMixed[t.kind](t,e);if(Z(e)&&typeof t=="number")return b.addMixed[e.kind](e,t);if(Z(e)&&Z(t)||nt(e)&&nt(t))return b.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var kt=f({name:"add",signature:(...e)=>{let t=fe(e)??e;return{argTypes:t,returnType:Bt(t[0])?t[1]:t[0]}},normalImpl:Co,codegenImpl:(e,t)=>c`(${e} + ${t})`});function rp(e,t){return Co(e,Fo(-1,t))}var nr=f({name:"sub",signature:(...e)=>{let t=fe(e)??e;return{argTypes:t,returnType:Bt(t[0])?t[1]:t[0]}},normalImpl:rp,codegenImpl:(e,t)=>c`(${e} - ${t})`});function Fo(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Z(t)||nt(t)))return b.mulSxV[t.kind](e,t);if((Z(e)||nt(e))&&typeof t=="number")return b.mulSxV[e.kind](t,e);if(Z(e)&&Z(t))return b.mulVxV[e.kind](e,t);if(Ws(e)&&nt(t))return b.mulVxM[t.kind](e,t);if(nt(e)&&Ws(t))return b.mulMxV[e.kind](e,t);if(nt(e)&&nt(t))return b.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var Ht=f({name:"mul",signature:(...e)=>{let t=fe(e)??e,r=Bt(t[0])?t[1]:Bt(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:r}},normalImpl:Fo,codegenImpl:(e,t)=>c`(${e} * ${t})`});function np(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Z(t)){let r=qn[t.kind][h].jsImpl;return b.div[t.kind](r(e),t)}if(Z(e)&&typeof t=="number"){let r=qn[e.kind][h].jsImpl;return b.div[e.kind](e,r(t))}if(Z(e)&&Z(t))return b.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var fi=f({name:"div",signature:(...e)=>{let t=fe(e,[v,ae,ot])??e;return{argTypes:t,returnType:Bt(t[0])?t[1]:t[0]}},normalImpl:np,codegenImpl:(e,t)=>c`(${e} / ${t})`,ignoreImplicitCastWarning:!0}),ip=f({name:"mod",signature:(...e)=>{let t=fe(e)??e;return{argTypes:t,returnType:Bt(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Z(t)){let r=qn[t.kind];return b.mod[t.kind](r(e),t)}if(Z(e)&&typeof t=="number"){let r=qn[e.kind];return b.mod[e.kind](e,r(t))}if(Z(e)&&Z(t))return b.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>c`(${e} % ${t})`});function sp(e){return typeof e=="number"?-e:b.neg[e.kind](e)}var Go=f({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:sp,codegenImpl:e=>c`-(${e})`});function Li(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return Ro(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Lo(e.sampleType);case"2d":return jo(e.sampleType);case"2d-array":return No(e.sampleType);case"3d":return Wo(e.sampleType);case"cube":return Do(e.sampleType);case"cube-array":return qo(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return Yo(e.format,e.access);case"2d":return Xo(e.format,e.access);case"2d-array":return Qo(e.format,e.access);case"3d":return Ho(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Le(e,t){let r=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[h]:!0,[Or]:void 0,type:e,bindingSampleType:r,...t}}function di(e,t){return{[h]:!0,[Or]:void 0,type:e,...t}}var ha=new Map,mn={"write-only":"write","read-only":"read","read-write":"read_write"};function ge(e,t){let r=ha.get(e);return r||(r=t(),ha.set(e,r)),r}function Lo(e){let t=e||v,r=`texture_1d<${t.type}>`;return ge(r,()=>Le("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function jo(e){let t=e||v,r=`texture_2d<${t.type}>`;return ge(r,()=>Le("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function Ro(e){let t=e||v,r=`texture_multisampled_2d<${t.type}>`;return ge(r,()=>Le("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function No(e){let t=e||v,r=`texture_2d_array<${t.type}>`;return ge(r,()=>Le("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Do(e){let t=e||v,r=`texture_cube<${t.type}>`;return ge(r,()=>Le("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function qo(e){let t=e||v,r=`texture_cube_array<${t.type}>`;return ge(r,()=>Le("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function Wo(e){let t=e||v,r=`texture_3d<${t.type}>`;return ge(r,()=>Le("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function Yo(e,t){let r=t||"write-only",n=`texture_storage_1d<${e}, ${mn[r]}>`;return ge(n,()=>di("texture_storage_1d",{dimension:"1d",format:e,access:r}))}function Xo(e,t){let r=t||"write-only",n=`texture_storage_2d<${e}, ${mn[r]}>`;return ge(n,()=>di("texture_storage_2d",{dimension:"2d",format:e,access:r}))}function Qo(e,t){let r=t||"write-only",n=`texture_storage_2d_array<${e}, ${mn[r]}>`;return ge(n,()=>di("texture_storage_2d_array",{dimension:"2d-array",format:e,access:r}))}function Ho(e,t){let r=t||"write-only",n=`texture_storage_3d<${e}, ${mn[r]}>`;return ge(n,()=>di("texture_storage_3d",{dimension:"3d",format:e,access:r}))}function ap(){return ge("texture_depth_2d",()=>Le("texture_depth_2d",{dimension:"2d",sampleType:v,multisampled:!1}))}function op(){return ge("texture_depth_multisampled_2d",()=>Le("texture_depth_multisampled_2d",{dimension:"2d",sampleType:v,multisampled:!0}))}function up(){return ge("texture_depth_2d_array",()=>Le("texture_depth_2d_array",{dimension:"2d-array",sampleType:v,multisampled:!1}))}function lp(){return ge("texture_depth_cube",()=>Le("texture_depth_cube",{dimension:"cube",sampleType:v,multisampled:!1}))}function hp(){return ge("texture_depth_cube_array",()=>Le("texture_depth_cube_array",{dimension:"cube-array",sampleType:v,multisampled:!1}))}function Zo(){return ge("texture_external",()=>({[h]:!0,[Or]:void 0,type:"texture_external",dimension:"2d"}))}function Jo(e){return!!e[h]&&typeof e.multisampled=="boolean"}function ji(e){return!!e[h]&&typeof e.format=="string"&&typeof e.access=="string"}var cp=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],Ri={add:kt,sub:nr,mul:Ht,div:fi},pp={f:{1:v,2:_,3:oe,4:I},h:{1:ae,2:ut,3:lt,4:ht},i:{1:j,2:me,3:Pe,4:he},u:{1:x,2:_e,3:ne,4:ye},b:{1:C,2:er,3:tr,4:rr}};function Vs(e,t){if(cp.includes(e.dataType.type)&&t in Ri)return m(new qa(t,e,Ri[t][h].gpuImpl),De,e.origin);if($e(e.dataType)&&t==="length")return e.dataType.elementCount===0?m(c`arrayLength(&${e})`,x,"runtime"):m(e.dataType.elementCount,un,"constant");if(Ln(e.dataType)&&t==="columns")return m(new Wa(e),De,e.origin);if(pe(e.dataType)||Ye(e.dataType)){let n=e.dataType.propTypes[t];return n?(n=xt(n),m(c`${e}.${t}`,n,e.origin==="argument"?"argument":!Sr(e)&&!we(n)?e.origin:e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime")):void 0}if(qe(e.dataType)){let n=ls(e);return t==="$"?n:Vs(n,t)}if(at(e.dataType)&&t==="kind")return m(e.dataType.type,De,"constant");let r=t.length;if(at(e.dataType)&&r>=1&&r<=4){let n=e.dataType.type.includes("bool")?"b":e.dataType.type[4],i=pp[n][r];return i?m(Ee(e)?e.value[t]:c`${e}.${t}`,i,e.origin==="argument"&&r===1?"argument":e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime"):void 0}if(Ee(e)||e.dataType.type==="unknown")return si(e.value[t])}function Us(){return{[h]:!0,type:"sampler",[Or]:void 0}}function Ps(){return{[h]:!0,type:"sampler_comparison",[Or]:void 0}}function fp(e){return!!e[h]&&e.type==="sampler"}function dp(e){return!!e[h]&&e.type==="sampler_comparison"}function Ko(e){return new mp(e)}var mp=class{constructor(e){this.inner=e}[h]=!0;type="atomic"},eu=Object.defineProperty,yp=(e,t,r)=>t in e?eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gp=(e,t)=>{for(var r in t)eu(e,r,{get:t[r],enumerable:!0})},V=(e,t,r)=>yp(e,typeof t!="symbol"?t+"":t,r),wp={};gp(wp,{BufferReader:()=>At,BufferWriter:()=>ir,MaxValue:()=>ie,Measurer:()=>K,UnresolvedReferenceError:()=>Yt,ValidationError:()=>mi,arrayOf:()=>Tp,bool:()=>zp,byte:()=>Up,chars:()=>qp,concat:()=>Qp,dynamicArrayOf:()=>Zp,f16:()=>jp,f32:()=>Np,f32Array:()=>df,f64Array:()=>mf,generic:()=>Yp,genericEnum:()=>Xp,i16:()=>kp,i16Array:()=>pf,i32:()=>Cp,i32Array:()=>ff,i8:()=>Mp,i8Array:()=>cf,keyed:()=>ef,object:()=>Wp,optional:()=>rf,string:()=>Sp,tupleOf:()=>af,u16:()=>Ap,u16Array:()=>lf,u32:()=>Gp,u32Array:()=>hf,u8:()=>su,u8Array:()=>of,u8ClampedArray:()=>uf});var Yt=class tu extends Error{constructor(t){super(t),Object.setPrototypeOf(this,tu.prototype)}},mi=class ru extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ru.prototype)}},xp=class{constructor(){V(this,"size",Number.NaN),V(this,"unbounded",this),V(this,"isUnbounded",!0)}add(){return this}fork(){return this}},vp=new xp,K=class nu{constructor(){V(this,"size",0),V(this,"unbounded",vp),V(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new nu;return t.size=this.size,t}},ie=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),de=class{constructor(){V(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},$p=class{constructor(e){this.key=e}},Kr={STRING:"string",ENUM:"enum"},bp=class extends de{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,V(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new mi(`Expected array of length ${this.length}, got ${t.length}`);for(const r of t)this.elementSchema.write(e,r)}read(e){const t=[];for(let r=0;r<this.length;++r)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(ie).size*this.length}measure(e,t=new K){for(let r=0;r<this.length;++r)this.elementSchema.measure(e===ie?ie:e[r],t);return t}};function Tp(e,t){return new bp(e,t)}var _p=class extends de{constructor(){super(...arguments),V(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new K){return t.add(1)}},zp=new _p,iu=class Wr extends de{static get _encoder(){return Wr._cachedEncoder||(Wr._cachedEncoder=new TextEncoder),Wr._cachedEncoder}read(t){return t.readString()}write(t,r){t.writeString(r)}measure(t,r=new K){if(t===ie)return r.unbounded;const n=Wr._encoder.encode(t);return r.add(n.byteLength+1)}};V(iu,"_cachedEncoder");var Ip=iu,Sp=new Ip,Ep=class extends de{constructor(){super(...arguments),V(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new K){return t.add(1)}},Mp=new Ep,Vp=class extends de{constructor(){super(...arguments),V(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new K){return t.add(1)}},su=new Vp,Up=su,Pp=class extends de{constructor(){super(...arguments),V(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new K){return t.add(2)}},kp=new Pp,Op=class extends de{constructor(){super(...arguments),V(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new K){return t.add(2)}},Ap=new Op,Bp=class extends de{constructor(){super(...arguments),V(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new K){return t.add(4)}},Cp=new Bp,Fp=class extends de{constructor(){super(...arguments),V(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new K){return t.add(4)}},Gp=new Fp,Lp=class extends de{constructor(){super(...arguments),V(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new K){return t.add(2)}},jp=new Lp,Rp=class extends de{constructor(){super(...arguments),V(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new K){return t.add(4)}},Np=new Rp,Dp=class extends de{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new mi(`Expected char-string of length ${this.length}, got ${t.length}`);for(let r=0;r<t.length;++r)e.writeUint8(t.charCodeAt(r))}read(e){let t="";for(let r=0;r<this.length;++r)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new K){return t.add(this.length)}};function qp(e){return new Dp(e)}function Ot(e){return Object.entries(e)}function au(e,t){const r={};for(const[n,i]of Ot(t))r[n]=e.resolve(i);return r}var ks=class extends de{constructor(e){super(),this._properties=e,V(this,"properties"),this.properties=e}resolveReferences(e){this.properties=au(e,this._properties)}write(e,t){for(const[r,n]of Ot(this.properties))n.write(e,t[r])}read(e){const t={};for(const[r,n]of Ot(this.properties))t[r]=n.read(e);return t}get maxSize(){const e=new K;for(const t of Object.values(this.properties))t.measure(ie,e);return e.size}measure(e,t=new K){for(const[r,n]of Ot(this.properties))n.measure(e===ie?ie:e[r],t);return t}seekProperty(e,t){let r=0;for(const[n,i]of Ot(this.properties)){if(n===t)return{bufferOffset:r,schema:i};r+=i.measure(e).size}return null}};function Wp(e){return new ks(e)}var ou=class extends de{constructor(e,t,r){super(),this.keyedBy=e,this._subTypeMap=r,V(this,"_baseObject"),V(this,"subTypeMap"),this._baseObject=new ks(t),this.subTypeMap=r}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=au(e,this._subTypeMap)}write(e,t){const r=t.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Kr.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[i,s]of Ot(n.properties))s.write(e,t[i])}read(e){const t=this.keyedBy===Kr.ENUM?e.readByte():e.readString(),r=this.subTypeMap[t]||null;if(r===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const n=this._baseObject.read(e);if(n.type=t,r!==null)for(const[i,s]of Ot(r.properties))n[i]=s.read(e);return n}measure(e,t=new K){if(this._baseObject.measure(e,t),this.keyedBy===Kr.ENUM)t.add(1);else if(e!==ie)t.add(e.type.length+1);else return t.unbounded;if(e===ie){const r=Object.values(this.subTypeMap).map(n=>{const i=t.fork();for(const s of Object.values(n.properties))s.measure(ie,i);return[n,i.size]}).reduce((n,i)=>n[1]>i[1]?n:i)[0];for(const n of Object.values(r.properties))n.measure(ie,t)}else{const r=e.type,n=this.subTypeMap[r]||null;if(n===null)throw new Error(`Unknown sub-type '${r.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,s]of Ot(n.properties))s.measure(e[i],t)}return t}};function Yp(e,t){return new ou(Kr.STRING,e,t)}function Xp(e,t){return new ou(Kr.ENUM,e,t)}function Qp(e){return new ks(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var Hp=class extends de{constructor(e){super(),this._unstableElementType=e,V(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const r of t)this.elementType.write(e,r)}read(e){const t=[],r=e.readUint32();for(let n=0;n<r;++n)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(ie).size}measure(e,t=new K){if(e===ie)return t.unbounded;t.add(4);for(const r of e)this.elementType.measure(r,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const r=Number.parseInt(String(t),10);if(Number.isNaN(r))return null;if(e===ie)return{bufferOffset:this.elementType.measure(ie).size*r,schema:this.elementType};if(r>=e.length)return null;const n=new K;for(let i=0;i<r;++i)this.elementType.measure(e[i],n);return{bufferOffset:n.size,schema:this.elementType}}};function Zp(e){return new Hp(e)}var uu=class{constructor(e){V(this,"__unwrapped"),V(this,"ref"),this.ref=new $p(e)}resolveReferences(){throw new Yt("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Yt("Tried to read a reference directly. Resolve it instead.")}write(){throw new Yt("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Yt("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Yt("Tried to seek property of a reference directly. Resolve it instead.")}},Jp=class{constructor(){V(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof uu){const r=e.ref.key;if(this.registry[r]!==void 0)return this.registry[r];throw new Yt(`Couldn't resolve reference to ${r}. Unknown key.`)}return e.resolveReferences(this),e}},Kp=class{constructor(e,t){this.key=e,V(this,"__unwrapped"),V(this,"__keyDefinition"),V(this,"innerType"),this.innerType=t(new uu(e)),this.resolveReferences(new Jp)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(ie).size}measure(e,t=new K){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function ef(e,t){return new Kp(e,t)}var tf=class extends de{constructor(e){super(),this._innerUnstableSchema=e,V(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(ie).size}measure(e,t=new K){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function rf(e){return new tf(e)}function nf(e,t){return t.map(r=>e.resolve(r))}var sf=class extends de{constructor(e){super(),this._unstableSchemas=e,V(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=nf(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new mi(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let r=0;r<this.schemas.length;++r)this.schemas[r].write(e,t[r])}read(e){const t=[];for(let r=0;r<this.schemas.length;++r)t.push(this.schemas[r].read(e));return t}get maxSize(){return this.measure(ie).size}measure(e,t=new K){for(let r=0;r<this.schemas.length;++r)this.schemas[r].measure(e===ie?ie:e[r],t);return t}};function af(e){return new sf(e)}var It=class extends de{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,V(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),r=new this._arrayConstructor(t,0,this.length);return e.readSlice(r,0,this.byteLength),r}measure(e,t=new K){return t.add(this.byteLength)}},of=e=>new It(e,Uint8Array),uf=e=>new It(e,Uint8ClampedArray),lf=e=>new It(e,Uint16Array),hf=e=>new It(e,Uint32Array),cf=e=>new It(e,Int8Array),pf=e=>new It(e,Int16Array),ff=e=>new It(e,Int32Array),df=e=>new It(e,Float32Array),mf=e=>new It(e,Float64Array);function yf(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function lu(){return yf()?"big":"little"}function Os(e){let t=0,r=e;return r&&"buffer"in r&&"byteOffset"in r&&(t+=r.byteOffset,r=r.buffer),{buffer:r,byteOffset:t,byteLength:e.byteLength}}var hu=class{constructor(e,t){V(this,"dataView"),V(this,"littleEndian"),V(this,"byteOffset",0),V(this,"endianness");const{byteOffset:r=0,endianness:n="system"}=t??{};this.byteOffset=r;const i=lu();this.endianness=n==="system"?i:n,this.littleEndian=this.endianness==="little";const s=Os(e);this.byteOffset+=s.byteOffset,this.dataView=new DataView(s.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function gf(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,r=Math.abs(e),n=Math.floor(Math.log2(r)),i=r/2**n-1,s=n+15,a=Math.floor(i*1024);return t<<15|s<<10|a}function wf(e){const t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?t===0?n/1024:-n/1024:r===31?n===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+n/1024)*2**(r-15)}var At=class extends hu{constructor(){super(...arguments),V(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,wf(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,r){const n=Os(e),i=new Uint8Array(n.buffer,n.byteOffset+t);for(let s=0;s<r;++s)i[s]=this.dataView.getUint8(this.byteOffset++)}},ir=class extends hu{constructor(){super(...arguments),V(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,gf(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=Os(e),r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const n of r)this.dataView.setUint8(this.byteOffset++,n)}},U=e=>({argTypes:[e],returnType:e}),yi=(...e)=>{let t=fe(e)??e;return{argTypes:t,returnType:t[0]}};function cu(e){return(t,...r)=>{let n=t;for(let i of r)n=e(n,i);return n}}function pu(e){return(t,...r)=>{let n=c`${t}`;for(let i of r)n=c`${e}(${n}, ${i})`;return n}}function xf(e){return typeof e=="number"?Math.abs(e):b.abs[e.kind](e)}var vf=f({name:"abs",signature:U,normalImpl:xf,codegenImpl:e=>c`abs(${e})`});function $f(e){return typeof e=="number"?Math.acos(e):b.acos[e.kind](e)}var bf=f({name:"acos",signature:U,normalImpl:$f,codegenImpl:e=>c`acos(${e})`});function Tf(e){return typeof e=="number"?Math.acosh(e):b.acosh[e.kind](e)}var _f=f({name:"acosh",signature:U,normalImpl:Tf,codegenImpl:e=>c`acosh(${e})`});function zf(e){return typeof e=="number"?Math.asin(e):b.asin[e.kind](e)}var If=f({name:"asin",signature:U,normalImpl:zf,codegenImpl:e=>c`asin(${e})`});function Sf(e){return typeof e=="number"?Math.asinh(e):b.asinh[e.kind](e)}var Ef=f({name:"asinh",signature:U,normalImpl:Sf,codegenImpl:e=>c`asinh(${e})`});function Mf(e){return typeof e=="number"?Math.atan(e):b.atan[e.kind](e)}var Vf=f({name:"atan",signature:U,normalImpl:Mf,codegenImpl:e=>c`atan(${e})`});function Uf(e){return typeof e=="number"?Math.atanh(e):b.atanh[e.kind](e)}var Pf=f({name:"atanh",signature:U,normalImpl:Uf,codegenImpl:e=>c`atanh(${e})`});function kf(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):b.atan2[e.kind](e,t)}var Of=f({name:"atan2",signature:(...e)=>{let t=fe(e,[v,ae,ot])??e;return{argTypes:t,returnType:t[0]}},normalImpl:kf,codegenImpl:(e,t)=>c`atan2(${e}, ${t})`});function Af(e){return typeof e=="number"?Math.ceil(e):b.ceil[e.kind](e)}var fu=f({name:"ceil",signature:U,normalImpl:Af,codegenImpl:e=>c`ceil(${e})`});function Bf(e,t,r){return typeof e=="number"?Math.min(Math.max(t,e),r):b.clamp[e.kind](e,t,r)}var Cf=f({name:"clamp",signature:yi,normalImpl:Bf,codegenImpl:(e,t,r)=>c`clamp(${e}, ${t}, ${r})`});function Ff(e){return typeof e=="number"?Math.cos(e):b.cos[e.kind](e)}var Gf=f({name:"cos",signature:U,normalImpl:Ff,codegenImpl:e=>c`cos(${e})`});function Lf(e){return typeof e=="number"?Math.cosh(e):b.cosh[e.kind](e)}var jf=f({name:"cosh",signature:U,normalImpl:Lf,codegenImpl:e=>c`cosh(${e})`}),Rf=f({name:"countLeadingZeros",signature:U,normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countLeadingZeros(${e})`}),Nf=f({name:"countOneBits",signature:U,normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countOneBits(${e})`}),Df=f({name:"countTrailingZeros",signature:U,normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`countTrailingZeros(${e})`}),qf=f({name:"cross",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>b.cross[e.kind](e,t),codegenImpl:(e,t)=>c`cross(${e}, ${t})`});function Wf(e){if(typeof e=="number")return e*180/Math.PI;throw new Qe("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Yf=f({name:"degrees",signature:U,normalImpl:Wf,codegenImpl:e=>c`degrees(${e})`}),Xf=f({name:"determinant",signature:U,normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`determinant(${e})`});function Qf(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):en(nr(e,t))}var du=f({name:"distance",signature:(...e)=>({argTypes:e,returnType:ss(e[0])?ae:v}),normalImpl:Qf,codegenImpl:(e,t)=>c`distance(${e}, ${t})`}),mu=f({name:"dot",signature:(...e)=>({argTypes:e,returnType:e[0].primitive}),normalImpl:(e,t)=>b.dot[e.kind](e,t),codegenImpl:(e,t)=>c`dot(${e}, ${t})`}),Hf=f({name:"dot4U8Packed",signature:{argTypes:[x,x],returnType:x},normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4U8Packed(${e}, ${t})`}),Zf=f({name:"dot4I8Packed",signature:{argTypes:[x,x],returnType:j},normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`dot4I8Packed(${e}, ${t})`});function Jf(e){return typeof e=="number"?Math.exp(e):b.exp[e.kind](e)}var Kf=f({name:"exp",signature:U,normalImpl:Jf,codegenImpl:e=>c`exp(${e})`});function ed(e){return typeof e=="number"?2**e:b.exp2[e.kind](e)}var td=f({name:"exp2",signature:U,normalImpl:ed,codegenImpl:e=>c`exp2(${e})`}),rd=f({name:"extractBits",signature:(e,t,r)=>({argTypes:[e,x,x],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`extractBits(${e}, ${t}, ${r})`}),nd=f({name:"faceForward",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`faceForward(${e}, ${t}, ${r})`}),id=f({name:"firstLeadingBit",signature:U,normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstLeadingBit(${e})`}),sd=f({name:"firstTrailingBit",signature:U,normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`firstTrailingBit(${e})`});function ad(e){return typeof e=="number"?Math.floor(e):b.floor[e.kind](e)}var od=f({name:"floor",signature:U,normalImpl:ad,codegenImpl:e=>c`floor(${e})`});function ud(e,t,r){if(typeof e=="number")return e*t+r;throw new Qe("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var ld=f({name:"fma",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:ud,codegenImpl:(e,t,r)=>c`fma(${e}, ${t}, ${r})`});function hd(e){return typeof e=="number"?e-Math.floor(e):b.fract[e.kind](e)}var cd=f({name:"fract",signature:U,normalImpl:hd,codegenImpl:e=>c`fract(${e})`}),pd={f32:ce({fract:v,exp:j}),f16:ce({fract:ae,exp:j}),abstractFloat:ce({fract:ot,exp:un}),vec2f:ce({fract:_,exp:me}),vec3f:ce({fract:oe,exp:Pe}),vec4f:ce({fract:I,exp:he}),vec2h:ce({fract:ut,exp:me}),vec3h:ce({fract:lt,exp:Pe}),vec4h:ce({fract:ht,exp:he})},fd=f({name:"frexp",normalImpl:"CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",signature:e=>{let t=pd[e.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},codegenImpl:e=>c`frexp(${e})`}),dd=f({name:"insertBits",signature:(e,t,r,n)=>({argTypes:[e,t,x,x],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r,n)=>c`insertBits(${e}, ${t}, ${r}, ${n})`});function md(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new Qe("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var yd=f({name:"inverseSqrt",signature:U,normalImpl:md,codegenImpl:e=>c`inverseSqrt(${e})`}),gd=f({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[e,un],returnType:e};case"f32":case"f16":return{argTypes:[e,j],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,me],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Pe],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,he],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>c`ldexp(${e}, ${t})`});function wd(e){return typeof e=="number"?Math.abs(e):b.length[e.kind](e)}var en=f({name:"length",signature:e=>({argTypes:[e],returnType:ss(e)?ae:v}),normalImpl:wd,codegenImpl:e=>c`length(${e})`});function xd(e){return typeof e=="number"?Math.log(e):b.log[e.kind](e)}var vd=f({name:"log",signature:U,normalImpl:xd,codegenImpl:e=>c`log(${e})`});function $d(e){return typeof e=="number"?Math.log2(e):b.log2[e.kind](e)}var bd=f({name:"log2",signature:U,normalImpl:$d,codegenImpl:e=>c`log2(${e})`});function Td(e,t){return typeof e=="number"?Math.max(e,t):b.max[e.kind](e,t)}var _d=f({name:"max",signature:yi,normalImpl:cu(Td),codegenImpl:pu("max")});function zd(e,t){return typeof e=="number"?Math.min(e,t):b.min[e.kind](e,t)}var Id=f({name:"min",signature:yi,normalImpl:cu(zd),codegenImpl:pu("min")});function Sd(e,t,r){if(typeof e=="number"){if(typeof r!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-r)+t*r}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return b.mix[e.kind](e,t,r)}var Ed=f({name:"mix",signature:yi,normalImpl:Sd,codegenImpl:(e,t,r)=>c`mix(${e}, ${t}, ${r})`}),Md={f32:ce({fract:v,whole:v}),f16:ce({fract:ae,whole:ae}),abstractFloat:ce({fract:ot,whole:ot}),vec2f:ce({fract:_,whole:_}),vec3f:ce({fract:oe,whole:oe}),vec4f:ce({fract:I,whole:I}),vec2h:ce({fract:ut,whole:ut}),vec3h:ce({fract:lt,whole:lt}),vec4h:ce({fract:ht,whole:ht})},Vd=f({name:"modf",signature:e=>{let t=Md[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`modf(${e})`}),Ud=f({name:"normalize",signature:U,normalImpl:e=>b.normalize[e.kind](e),codegenImpl:e=>c`normalize(${e})`});function Pd(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Z(e)&&Z(t))return b.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var yu=f({name:"pow",signature:(...e)=>{let t=fe(e,[v,ae,ot])??e;return{argTypes:t,returnType:Bt(t[0])?t[1]:t[0]}},normalImpl:Pd,codegenImpl:(e,t)=>c`pow(${e}, ${t})`}),kd=f({name:"quantizeToF16",signature:U,normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`quantizeToF16(${e})`});function Od(e){if(typeof e=="number")return e*Math.PI/180;throw new Qe("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Ad=f({name:"radians",signature:(...e)=>{let t=fe(e,[v,ae,ot])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Od,codegenImpl:e=>c`radians(${e})`}),Bd=f({name:"reflect",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:(e,t)=>nr(e,Ht(2*mu(t,e),t)),codegenImpl:(e,t)=>c`reflect(${e}, ${t})`}),Cd=f({name:"refract",normalImpl:"CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,r)=>c`refract(${e}, ${t}, ${r})`,signature:(e,t,r)=>({argTypes:[e,t,ss(e)?ae:v],returnType:e})}),Fd=f({name:"reverseBits",signature:U,normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`reverseBits(${e})`});function Gd(e){if(typeof e=="number")return Math.round(e);throw new Qe("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Ld=f({name:"round",signature:U,normalImpl:Gd,codegenImpl:e=>c`round(${e})`});function jd(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new Qe("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Rd=f({name:"saturate",signature:U,normalImpl:jd,codegenImpl:e=>c`saturate(${e})`});function Nd(e){return typeof e=="number"?Math.sign(e):b.sign[e.kind](e)}var Dd=f({name:"sign",signature:U,normalImpl:Nd,codegenImpl:e=>c`sign(${e})`});function qd(e){return typeof e=="number"?Math.sin(e):b.sin[e.kind](e)}var Wd=f({name:"sin",signature:U,normalImpl:qd,codegenImpl:e=>c`sin(${e})`});function Yd(e){if(typeof e=="number")return Math.sinh(e);throw new Qe("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var Xd=f({name:"sinh",signature:U,normalImpl:Yd,codegenImpl:e=>c`sinh(${e})`});function Qd(e,t,r){return typeof r=="number"?Wt(e,t,r):b.smoothstep[r.kind](e,t,r)}var Hd=f({name:"smoothstep",signature:(...e)=>({argTypes:e,returnType:e[2]}),normalImpl:Qd,codegenImpl:(e,t,r)=>c`smoothstep(${e}, ${t}, ${r})`});function Zd(e){return typeof e=="number"?Math.sqrt(e):b.sqrt[e.kind](e)}var Jd=f({name:"sqrt",signature:U,normalImpl:Zd,codegenImpl:e=>c`sqrt(${e})`});function Kd(e,t){if(typeof e=="number")return e<=t?1:0;throw new Qe("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var em=f({name:"step",signature:(...e)=>{let t=fe(e,[v,ae,ot])??e;return{argTypes:t,returnType:t[0]}},normalImpl:Kd,codegenImpl:(e,t)=>c`step(${e}, ${t})`});function tm(e){if(typeof e=="number")return Math.tan(e);throw new Qe("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}var rm=f({name:"tan",signature:U,normalImpl:tm,codegenImpl:e=>c`tan(${e})`});function nm(e){return typeof e=="number"?Math.tanh(e):b.tanh[e.kind](e)}var im=f({name:"tanh",signature:U,normalImpl:nm,codegenImpl:e=>c`tanh(${e})`}),sm=f({name:"transpose",signature:U,normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`transpose(${e})`}),am=f({name:"trunc",signature:U,normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>c`trunc(${e})`}),gu=f({name:"bitcastU32toF32",normalImpl:(e=>typeof e=="number"?Je(e):b.bitcastU32toF32[e.kind](e)),codegenImpl:e=>c`bitcast<f32>(${e})`,signature:(...e)=>{let t=fe(e,[x])??e;return{argTypes:t,returnType:at(t[0])?t[0].type==="vec2u"?_:t[0].type==="vec3u"?oe:I:v}}}),wu=f({name:"bitcastU32toI32",normalImpl:(e=>typeof e=="number"?Ke(e):b.bitcastU32toI32[e.kind](e)),codegenImpl:e=>c`bitcast<i32>(${e})`,signature:(...e)=>{let t=fe(e,[x])??e;return{argTypes:t,returnType:at(t[0])?t[0].type==="vec2u"?me:t[0].type==="vec3u"?Pe:he:j}}}),xu=f({name:"unpack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4);new ir(t).writeUint32(e);let r=new At(t);return _(r.readFloat16(),r.readFloat16())},signature:{argTypes:[x],returnType:_},codegenImpl:e=>c`unpack2x16float(${e})`}),om=f({name:"pack2x16float",normalImpl:e=>{let t=new ArrayBuffer(4),r=new ir(t);r.writeFloat16(e.x),r.writeFloat16(e.y);let n=new At(t);return x(n.readUint32())},signature:{argTypes:[_],returnType:x},codegenImpl:e=>c`pack2x16float(${e})`}),um=f({name:"unpack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4);new ir(t).writeUint32(e);let r=new At(t);return I(r.readUint8()/255,r.readUint8()/255,r.readUint8()/255,r.readUint8()/255)},signature:{argTypes:[x],returnType:I},codegenImpl:e=>c`unpack4x8unorm(${e})`}),lm=f({name:"pack4x8unorm",normalImpl:e=>{let t=new ArrayBuffer(4),r=new ir(t);r.writeUint8(e.x*255),r.writeUint8(e.y*255),r.writeUint8(e.z*255),r.writeUint8(e.w*255);let n=new At(t);return x(n.readUint32())},signature:{argTypes:[I],returnType:x},codegenImpl:e=>c`pack4x8unorm(${e})`});function Gr(e){return e.type.includes("2")?er:e.type.includes("3")?tr:rr}var vu=f({name:"allEq",signature:(...e)=>({argTypes:e,returnType:C}),normalImpl:(e,t)=>Bs(yn(e,t)),codegenImpl:(e,t)=>c`all(${e} == ${t})`}),yn=(e,t)=>b.eq[e.kind](e,t),hm=f({name:"eq",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:yn,codegenImpl:(e,t)=>c`(${e} == ${t})`}),cm=f({name:"ne",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:(e,t)=>wt(yn(e,t)),codegenImpl:(e,t)=>c`(${e} != ${t})`}),gi=(e,t)=>b.lt[e.kind](e,t),pm=f({name:"lt",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:gi,codegenImpl:(e,t)=>c`(${e} < ${t})`}),fm=f({name:"le",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:(e,t)=>As(gi(e,t),yn(e,t)),codegenImpl:(e,t)=>c`(${e} <= ${t})`}),dm=f({name:"gt",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:(e,t)=>$u(wt(gi(e,t)),wt(yn(e,t))),codegenImpl:(e,t)=>c`(${e} > ${t})`}),mm=f({name:"ge",signature:(...e)=>({argTypes:e,returnType:Gr(e[0])}),normalImpl:(e,t)=>wt(gi(e,t)),codegenImpl:(e,t)=>c`(${e} >= ${t})`}),wt=e=>b.neg[e.kind](e),ym=f({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:wt,codegenImpl:e=>c`!(${e})`}),As=(e,t)=>b.or[e.kind](e,t),gm=f({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:As,codegenImpl:(e,t)=>c`(${e} | ${t})`}),$u=(e,t)=>wt(As(wt(e),wt(t))),wm=f({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:$u,codegenImpl:(e,t)=>c`(${e} & ${t})`}),Bs=e=>b.all[e.kind](e),xm=f({name:"all",signature:(...e)=>({argTypes:e,returnType:C}),normalImpl:Bs,codegenImpl:e=>c`all(${e})`}),vm=f({name:"any",signature:(...e)=>({argTypes:e,returnType:C}),normalImpl:e=>!Bs(wt(e)),codegenImpl:e=>c`any(${e})`}),$m=f({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:C}),normalImpl:(e,t,r=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<r:Z(e)&&Z(t)?b.isCloseToZero[e.kind](nr[h].jsImpl(e,t),r):!1,codegenImpl:(e,t,r=m(.01,v,"constant"))=>Tn(e)&&Tn(t)?c`(abs(f32(${e}) - f32(${t})) <= ${r})`:!Tn(e)&&!Tn(t)?c`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${r})`:"false"});function bm(e,t,r){return typeof r=="boolean"?r?t:e:b.select[e.kind](e,t,r)}var Tm=f({name:"select",signature:(e,t,r)=>{let[n,i]=fe([e,t])??[e,t];return{argTypes:[n,i,r],returnType:n}},normalImpl:bm,codegenImpl:(e,t,r)=>c`select(${e}, ${t}, ${r})`}),_m={channelType:v,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:"non-copyable"},zm={channelType:v,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:2},Im={channelType:v,vectorType:I,sampleTypes:["depth","unfilterable-float"],texelSize:4},Sm={channelType:x,vectorType:ye,sampleTypes:["uint"],texelSize:1},ca=new Map;function gn(e){let t=ca.get(e);return t===void 0&&(t=Em(e),ca.set(e,t)),t}function Em(e){let t=Um(e),r=Mm(e),n=e.includes("stencil");return{channelType:t,vectorType:t===x?ye:t===j?he:I,texelSize:Pm(e),sampleTypes:km(e),canRenderAttachment:Vm(e),...r&&{depthAspect:r},...n&&{stencilAspect:Sm}}}function Mm(e){if(e==="depth16unorm")return zm;if(e==="depth32float"||e==="depth32float-stencil8")return Im;if(e==="depth24plus"||e==="depth24plus-stencil8")return _m}function Vm(e){return!(e.startsWith("bc")||e.startsWith("etc2")||e.startsWith("eac")||e.startsWith("astc")||e==="rgb9e5ufloat")}function Um(e){return e==="stencil8"||e.includes("uint")?x:e.includes("sint")?j:v}function Pm(e){let[,t,r]=e.match(/^(rgba|bgra|rg|r)(8|16|32)/)??[];return t&&r?t.length*Number(r)/8:e==="stencil8"?1:e==="depth16unorm"?2:e==="depth32float"?4:e==="depth32float-stencil8"?5:e==="depth24plus"||e==="depth24plus-stencil8"?"non-copyable":/^(bc[14]-|etc2-rgb8|eac-r11)/.test(e)?8:/^(bc|astc-|etc2-rgba|eac-rg)/.test(e)?16:4}function km(e){return e==="stencil8"?["uint"]:e.includes("uint")?["uint"]:e.includes("sint")?["sint"]:e.includes("depth")?["depth","unfilterable-float"]:/^(r|rg|rgba)16(u|s)norm$/.test(e)?["unfilterable-float"]:["float","unfilterable-float"]}var Om=new Set(["r32float","rg32float","rgba32float"]);function Am(e,t){return Om.has(t)&&!e.features.has("float32-filterable")?["unfilterable-float"]:gn(t).sampleTypes}var Cs=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],bu={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"},Bm={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},Ni={identifier:"i",destructuredObject:"d"};const Cm=Object.freeze(Object.defineProperty({__proto__:null,FuncParameterType:Ni,NodeTypeCatalog:Bm},Symbol.toStringTag,{value:"Module"}));function Fm(e){return e?.[A]}var je={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let r=ii(e),n=Vs(r,String(t));if(n)return new Proxy({[h]:!0,[z]:i=>i.resolve(n.value,n.dataType),[ze]:n,toString:()=>`${String(e)}.${t}`},je)}};function wi(e){let t=e;for(;;){let r=Fm(t);if(!r)break;t=r}return t}function Di(e,t){return new Gm(e,t)}function Tu(e){let t=Reflect.ownKeys(e);for(let r of t){let n=e[r];(n&&typeof n=="object"||typeof n=="function")&&Tu(n)}return Object.freeze(e)}var Gm=class{constructor(t,r){this.dataType=t,this.#e=r&&typeof r=="object"?Tu(r):r}[h]={};#e;$name(t){return F(this,t),this}[z](t){let r=t.getUniqueName(this),n=t.resolve(this.dataType).value,i=t.resolve(this.#e,this.dataType).value;return t.addDeclaration(`const ${r}: ${n} = ${i};`),m(r,this.dataType,we(this.dataType)?"constant":"constant-tgpu-const-ref")}toString(){return`const:${w(this)??"<unnamed>"}`}get[A](){let t=this.dataType;return new Proxy({[h]:!0,get[ze](){return m(this,t,we(t)?"constant":"constant-tgpu-const-ref")},[z]:r=>r.resolve(this),toString:()=>`const:${w(this)??"<unnamed>"}.$`},je)}get $(){return He()?this[A]:this.#e}get value(){return this.$}};function Lm(e){return new jm(e)}var jm=class{constructor(t){this.declaration=t}[h]=!0;externalsToApply=[];$uses(t){return this.externalsToApply.push(t),this}[z](t){let r={};for(let i of this.externalsToApply)Pr(r,i);let n=pn(t,r,this.declaration);return t.addDeclaration(n),m("",re,"constant")}toString(){return`declare: ${this.declaration}`}};function _u(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[dn(e.in)]:[],returnType:re,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0};return Object.assign((r,...n)=>Rm(t,e.workgroupSize,oi(r,...n)),t)}function Rm(e,t,r){let n=fn(r,`@compute @workgroup_size(${t.join(", ")}) `),i=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[h]:!0,[se]:n,$name(s){return F(n,s),ti(i)&&i.$name(`${s}_Input`),this},[z](s){return n.resolve(s,e.argTypes,e.returnType)},toString(){return`computeFn:${w(n)??"<unnamed>"}`}}}function O(e,t){let r={[h]:!0,argTypes:e,returnType:t??re,isEntry:!1};return Object.assign((n,...i)=>Dm(r,oi(n,...i)),r)}function zu(e){return k(e)&&e?.resourceType==="function"}function Nm([e,t]){return`${w(e)??"<unnamed>"}=${t}`}function Dm(e,t){let r=fn(t,""),n={shell:e,resourceType:"function",$uses(a){return r.applyExternals(a),this},[se]:r,$name(a){return F(r,a),this},with(a,o){return Iu(s,[[ni(a)?a.slot:a,o]])},[z](a){return typeof t=="string"&&(_c(t,e.argTypes,r.applyExternals),Uo(t,e.returnType,r.applyExternals)),r.resolve(a,e.argTypes,e.returnType)}},i=f({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.argTypes,returnType:e.returnType},normalImpl:(...a)=>ih(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((l,p)=>Gt(e.argTypes[p],l)),u=t(...o);return Gt(e.returnType,u)}catch(o){throw o instanceof Xs?o.appendToTrace(s):new Xs(o,[s])}}),codegenImpl:(...a)=>{let o=Ue();return o.withResetIndentLevel(()=>c`${o.resolve(s).value}(${a})`)}}),s=Object.assign(i,n);return s[h].implementation=t,Object.defineProperty(s,"toString",{value(){return`fn:${w(r)??"<unnamed>"}`}}),s}function Iu(e,t){let r={resourceType:"function",shell:e.shell,[Xt]:{inner:e,pairs:t},$uses(s){return e.$uses(s),this},[se]:e,$name(s){return e.$name(s),this},with(s,a){return Iu(i,[...t,[ni(s)?s.slot:s,a]])}},n=f({name:"tgpuFnCall",noComptime:!0,signature:{argTypes:e.shell.argTypes,returnType:e.shell.returnType},normalImpl:e,codegenImpl:(...s)=>{let a=Ue();return a.withResetIndentLevel(()=>c`${a.resolve(i).value}(${s})`)}}),i=Object.assign(n,r);return i[h].implementation=e[h].implementation,Object.defineProperty(i,"toString",{value(){return`fn:${w(e)??"<unnamed>"}[${t.map(Nm).join(", ")}]`}}),i}function qm(e,t,r="runtime"){return new Wm(e,t,r)}var Wm=class{[h];dataType;origin;#e;#t;constructor(t,r,n){this[h]=!0,this.dataType=r,this.origin=n,this.#e=t,this.#t=[]}$uses(t){return this.#t.push(t),this}[z](t){let r={};for(let i of this.#t)Pr(r,i);let n=pn(t,r,this.#e);return m(n,this.dataType,this.origin)}toString(){return`raw(${String(this.dataType)}): "${this.#e}"`}get[A](){let t=this.dataType,r=this.origin;return new Proxy({[h]:!0,get[ze](){return m(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`raw(${String(this.dataType)}): "${this.#e}".$`},je)}get $(){if(!He())throw new Error("Raw code snippets can only be used on the GPU.");return this[A]}get value(){return this.$}};function Ym(e){let t={in:e.in,out:e.out,returnType:dn(e.out),isEntry:!0};return Object.assign((r,...n)=>Xm(t,oi(r,...n)),t)}function Xm(e,t){let r=fn(t,"@fragment "),n=e.returnType;return typeof t=="string"&&Uo(t,n,i=>r.applyExternals(i)),{shell:e,outputType:n,$uses(i){return r.applyExternals(i),this},[h]:!0,[se]:r,$name(i){return F(r,i),ti(n)&&n.$name(`${i}_Output`),this},[z](i){let s=e.in?dn(e.in,i.varyingLocations).$name(`${w(this)??""}_Input`):void 0;return s&&r.applyExternals({In:s}),r.applyExternals({Out:n}),r.resolve(i,s?[s]:[],e.returnType)},toString(){return`fragmentFn:${w(r)??"<unnamed>"}`}}}var Su=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield","sampler"]);function Qm(e){return e?e.replaceAll(/\s/g,"_").replaceAll(/[^\w\d]/g,""):"item"}function Eu(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!Su.has(t)}var Mu=class{#e;#t;constructor(){this.#e=new Set(Su),this.#t=[]}get usedFunctionScopeNames(){return this.#t[this.#t.length-1]}makeUnique(t,r){let n=Qm(t),i=this.getUniqueVariant(n);return r?this.#e.add(i):this.usedFunctionScopeNames?.add(i),i}makeValid(t){return Eu(t)&&!this.#e.has(t)?(this.usedFunctionScopeNames?.add(t),t):this.makeUnique(t,!1)}isUsed(t){return this.#e.has(t)||!!this.usedFunctionScopeNames?.has(t)}pushFunctionScope(){this.#t.push(new Set)}popFunctionScope(){this.#t.pop()}},Hm=class extends Mu{#e=0;getUniqueVariant(t){let r=`${t}_${this.#e++}`;for(;this.isUsed(r);)r=`${t}_${this.#e++}`;return r}},Zm=class extends Mu{getUniqueVariant(t){let r=0,n=t;for(;this.isUsed(n);)r++,n=`${t}_${r}`;return n}};function Jm(e,t){let r=fn(t,"");return{[h]:!0,[se]:r,resourceType:"shellless-impl",argTypes:e,[z](n){return r.resolve(n,e,void 0)},toString(){return`fn*:${w(r)??"<unnamed>"}(${e.map(n=>n.toString()).join(", ")})`}}}function qi(e,t){return e.type!==t.type?!1:e.type==="ptr"&&t.type==="ptr"?e.access===t.access&&e.addressSpace===t.addressSpace&&e.implicit===t.implicit&&qi(e.inner,t.inner):e.type==="array"&&t.type==="array"?e.elementCount===t.elementCount&&qi(e.elementType,t.elementType):e.type==="struct"&&t.type==="struct"?e===t:!0}var Km=class{cache=new Map;get(t,r){let n=ri(t);if(!n?.ast)return;if(!r&&n.ast.params.length>0)throw new Error(`Cannot resolve '${w(t)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let i=(r??[]).map((o,u)=>{if(o.value instanceof yt){if(o.dataType.type==="unknown")throw new B("d.ref() created with primitive types must be stored in a variable before use");return o.dataType}if(o.dataType.type==="unknown")throw new Error(`Passed illegal value ${o.value} as the #${u} argument to ${n.name}(...)`);let l=Pt(o.dataType);if(o.origin==="constant-tgpu-const-ref"||o.origin==="runtime-tgpu-const-ref"){let p=Ue();throw new Error(`Cannot pass constant references as function arguments. Explicitly copy them by wrapping them in a schema: '${p.resolve(l).value}(...)'`)}return qe(l)&&l.implicit&&(l=l.inner),l}),s=this.cache.get(t);if(s){let o=s.find(u=>u.argTypes.length===i.length&&u.argTypes.every((l,p)=>qi(l,i[p])));if(o)return o}else s=[],this.cache.set(t,s);let a=Jm(i,t);return s.push(a),a}},ey=class{[h];constructor(t){this[h]={nameRegistry:t,shelllessRepo:new Km,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(t,r){if(t==="name"){let n=this[h].listeners.name;return n.add(r),()=>n.delete(r)}throw new Error(`Unsupported event: ${t}`)}};function ty(e,t){let r=e.nameRegistry.makeUnique(w(t),!0);for(let n of e.listeners.name)n({target:t,name:r});return r}function Lr(e){let{names:t="strict"}=e??{};return new ey(t==="strict"?new Zm:new Hm)}function xi(e){return typeof e?.format=="string"}function ry(e,t){let r=[];if(Br(e)){if(!xi(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return r.push(t._layout),{usedVertexLayouts:r,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:Ct(e)??0}]}]}}let n=[],i=new WeakMap,s=0;for(let[a,o]of Object.entries(e)){if(bt(o))continue;let u=t[a];if(!u)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let l=u._layout,p=i.get(l);p||(r.push(l),p=[],n.push({arrayStride:l.stride,stepMode:l.stepMode,attributes:p}),i.set(l,p)),s=Ct(o)??s,p.push({format:u.format,offset:u.offset,shaderLocation:s++})}return{usedVertexLayouts:r,bufferDefinitions:n}}var ny=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function iy(e){return ny.includes(e.type)}function Wi(e,[t,r]){if(!Eu(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${Es(r)}${t}: ${e.resolve(r).value},
`}function sy(e,t){if(t[h].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>Wi(e,n)).join("")}}`),r}function ay(e,t){let r=e.getUniqueName(t);return e.addDeclaration(`struct ${r} {
${Object.entries(t.propTypes).map(n=>xi(n[1])?Wi(e,[n[0],$t[n[1].format]]):Wi(e,n)).join("")}
}`),r}function oy(e,t){let r=e.resolve(t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function uy(e,t){let r=e.resolve(xi(t.elementType)?$t[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${r}>`:`array<${r}, ${t.elementCount}>`}function Vu(e,t){if(Ar(t))return t.type==="unstruct"?ay(e,t):t.type==="disarray"?uy(e,t):t.type==="loose-decorated"?e.resolve(xi(t.inner)?$t[t.inner.format]:t.inner).value:e.resolve($t[t.type]).value;if(iy(t))return t.type;if(t.type==="struct")return sy(e,t);if(t.type==="array")return oy(e,t);if(t.type==="atomic")return`atomic<${Vu(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if(ji(t))return`${t.type}<${t.format}, ${mn[t.access]}>`;if(Jo(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(dp(t)||fp(t))return t.type;kr(t,"resolveData")}var Uu=class Yi{constructor(t){this.bindings=t}with(t,r){return new Yi([...this.bindings,[ni(t)?t.slot:t,r]])}pipe(t){let r=t(this);return new Yi([...this.bindings,...r.bindings])}};function*ly(e){let t=0;for(;;)e.has(t)||(yield t),t++}function hy(e,t){let r="size"in e?e.size:e.currentByteOffset,n=t-1,i=r&n;"skipBytes"in e?e.skipBytes(t-i&n):e.add(t-i&n)}var le=hy,pa=new WeakMap;function Pu(e){let t=pa.get(e);if(t)return t;let r=new K,n={},i;for(let s in e.propTypes){let a=e.propTypes[s];if(a===void 0)throw new Error(`Property ${s} is undefined in struct`);let o=r.size;le(r,Ye(e)?Ge(a):J(a)),i&&(i.padding=r.size-o);let u=P(a);n[s]={offset:r.size,size:u},i=n[s],r.add(u)}return i&&(i.padding=Ve(P(e),J(e))-r.size),pa.set(e,n),n}var cy=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),_i=new WeakMap,Sn={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},py={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},En={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},fy={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},fa={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let r=["z","y","x","w"],n="";for(let i=0;i<4;i++)n+=`output.setUint8((${e} + ${i}), Math.round(${t}.${r[i]} * 255), littleEndian);
`;return n}}};function Pn(e,t,r,n=0){let i=["i","j","k"][n]||`i${n}`;if(jn(e)||We(e))return Pn(e.inner,t,r,n);if(pe(e)||Ye(e)){let a=Pu(e),o="";for(let[u,l]of Object.entries(a)){let p=e.propTypes[u];p&&(o+=Pn(p,`(${t} + ${l.offset})`,`${r}.${u}`,n))}return o}if($e(e)||vt(e)){let a=Ve(P(e.elementType),J(e)),o="";return o+=`for (let ${i} = 0; ${i} < ${e.elementCount}; ${i}++) {
`,o+=Pn(e.elementType,`(${t} + ${i} * ${a})`,`${r}[${i}]`,n+1),o+=`}
`,o}if(at(e)){let a=Sn[e.type],o="",u=En[a],l=["x","y","z","w"],p=Vi(e)?2:Ui(e)?3:4;for(let d=0;d<p;d++)o+=`output.${u}((${t} + ${d*4}), ${r}.${l[d]}, littleEndian);
`;return o}if(Ln(e)){let a=Sn[e.type],o=En[a],u=Ga(e)?2:La(e)?3:4,l=u*u,p=Ve(u*4,8),d="";for(let y=0;y<l;y++){let $=Math.floor(y/u),T=y%u,G=$*p+T*4;d+=`output.${o}((${t} + ${G}), ${r}.columns[${$}].${["x","y","z","w"][T]}, littleEndian);
`}return d}if(So(e)){let a=e.type;if(a in fa)return fa[a].generator(t,r);let o=py[a],u=En[o],l=$t[a],p=Fa(l)?4:Ui(l)?3:Vi(l)?2:1,d=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,y=["x","y","z","w"],$=fy[a],T="";for(let G=0;G<p;G++){let Y=p===1?r:`${r}.${y[G]}`,D=$?$(Y):Y;T+=`output.${u}((${t} + ${G*d}), ${D}, littleEndian);
`}return T}if(!Object.hasOwn(Sn,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let s=Sn[e.type];return`output.${En[s]}(${t}, ${r}, littleEndian);
`}function da(e){if(!cy){console.warn("This environment does not allow eval - using default writer as fallback");return}if(_i.has(e))return _i.get(e);try{let t=Pn(e,"offset","value",0),r=new Function("output","offset","value","littleEndian=true",t);return _i.set(e,r),r}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var _r={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,r){e.writeFloat32(r)},f16(e,t,r){e.writeFloat16(r)},i32(e,t,r){e.writeInt32(r)},u32(e,t,r){e.writeUint32(r)},u16(e,t,r){e.writeUint16(r)},vec2f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},vec2h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},vec2i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},vec2u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},vec3h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z)},vec3i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},vec3u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},vec4h(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},vec4i(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},vec4u(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat3x3f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},mat4x4f(e,t,r){for(let n=0;n<r.length;++n)e.writeFloat32(r[n])},struct(e,t,r){let n=J(t);le(e,n);for(let[i,s]of Object.entries(t.propTypes))le(e,J(s)),Xn(e,s,r[i]);le(e,n)},array(e,t,r){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let n=J(t);le(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)le(e,n),Xn(e,t.elementType,r[s]);e.seekTo(i+P(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,r){_r[t.inner.type]?.(e,t,r)},decorated(e,t,r){let n=Ge(t);le(e,n);let i=e.currentByteOffset;_r[t.inner?.type]?.(e,t.inner,r),e.seekTo(i+P(t))},uint8(e,t,r){e.writeUint8(r)},uint8x2(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y)},uint8x4(e,t,r){e.writeUint8(r.x),e.writeUint8(r.y),e.writeUint8(r.z),e.writeUint8(r.w)},sint8(e,t,r){e.writeInt8(r)},sint8x2(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y)},sint8x4(e,t,r){e.writeInt8(r.x),e.writeInt8(r.y),e.writeInt8(r.z),e.writeInt8(r.w)},unorm8(e,t,r){e.writeUint8(Math.round(r*255))},unorm8x2(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255))},unorm8x4(e,t,r){e.writeUint8(Math.round(r.x*255)),e.writeUint8(Math.round(r.y*255)),e.writeUint8(Math.round(r.z*255)),e.writeUint8(Math.round(r.w*255))},snorm8(e,t,r){e.writeInt8(Math.round(r*127))},snorm8x2(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127))},snorm8x4(e,t,r){e.writeInt8(Math.round(r.x*127)),e.writeInt8(Math.round(r.y*127)),e.writeInt8(Math.round(r.z*127)),e.writeInt8(Math.round(r.w*127))},uint16(e,t,r){e.writeUint16(r)},uint16x2(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y)},uint16x4(e,t,r){e.writeUint16(r.x),e.writeUint16(r.y),e.writeUint16(r.z),e.writeUint16(r.w)},sint16(e,t,r){e.writeInt16(r)},sint16x2(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y)},sint16x4(e,t,r){e.writeInt16(r.x),e.writeInt16(r.y),e.writeInt16(r.z),e.writeInt16(r.w)},unorm16(e,t,r){e.writeUint16(r*65535)},unorm16x2(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535)},unorm16x4(e,t,r){e.writeUint16(r.x*65535),e.writeUint16(r.y*65535),e.writeUint16(r.z*65535),e.writeUint16(r.w*65535)},snorm16(e,t,r){e.writeInt16(Math.round(r*32767))},snorm16x2(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767))},snorm16x4(e,t,r){e.writeInt16(Math.round(r.x*32767)),e.writeInt16(Math.round(r.y*32767)),e.writeInt16(Math.round(r.z*32767)),e.writeInt16(Math.round(r.w*32767))},float16(e,t,r){e.writeFloat16(r)},float16x2(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y)},float16x4(e,t,r){e.writeFloat16(r.x),e.writeFloat16(r.y),e.writeFloat16(r.z),e.writeFloat16(r.w)},float32(e,t,r){e.writeFloat32(r)},float32x2(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y)},float32x3(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z)},float32x4(e,t,r){e.writeFloat32(r.x),e.writeFloat32(r.y),e.writeFloat32(r.z),e.writeFloat32(r.w)},uint32(e,t,r){e.writeUint32(r)},uint32x2(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y)},uint32x3(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z)},uint32x4(e,t,r){e.writeUint32(r.x),e.writeUint32(r.y),e.writeUint32(r.z),e.writeUint32(r.w)},sint32(e,t,r){e.writeInt32(r)},sint32x2(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y)},sint32x3(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z)},sint32x4(e,t,r){e.writeInt32(r.x),e.writeInt32(r.y),e.writeInt32(r.z),e.writeInt32(r.w)},"unorm10-10-10-2"(e,t,r){let n=0;n|=(r.x*1023&1023)<<22,n|=(r.y*1023&1023)<<12,n|=(r.z*1023&1023)<<2,n|=r.w*3&3,e.writeUint32(n)},"unorm8x4-bgra"(e,t,r){e.writeUint8(r.z*255),e.writeUint8(r.y*255),e.writeUint8(r.x*255),e.writeUint8(r.w*255)},disarray(e,t,r){let n=J(t);le(e,n);let i=e.currentByteOffset;for(let s=0;s<Math.min(t.elementCount,r.length);s++)le(e,n),_r[t.elementType?.type]?.(e,t.elementType,r[s]);e.seekTo(i+P(t))},unstruct(e,t,r){let n=t.propTypes;for(let[i,s]of Object.entries(n))_r[s.type]?.(e,s,r[i])},"loose-decorated"(e,t,r){let n=Ge(t);le(e,n);let i=e.currentByteOffset,s=_r[t.inner?.type];return s?.(e,t.inner,r),e.seekTo(i+P(t)),r}};function Xn(e,t,r){let n=_r[t.type];if(!n)throw new Error(`Cannot write data of type '${t.type}'.`);n(e,t,r)}var dy={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return _(e.readFloat32(),e.readFloat32())},vec3f(e){return oe(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return ut(e.readFloat16(),e.readFloat16())},vec3h(e){return lt(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return ht(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return me(e.readInt32(),e.readInt32())},vec3i(e){return Pe(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return he(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return _e(e.readUint32(),e.readUint32())},vec3u(e){return ne(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return _t(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let r=e.readFloat32();return e.readFloat32(),r};return zt(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return W(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let r=J(t);le(e,r);let n={},i=t.propTypes;for(let[s,a]of Object.entries(i))le(e,J(a)),n[s]=rt(e,a);return le(e,r),n},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let r=J(t),n=[];for(let i=0;i<t.elementCount;i++){le(e,r);let s=t.elementType,a=rt(e,s);n.push(a)}return le(e,r),n},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return rt(e,t.inner)},decorated(e,t){let r=Ge(t);le(e,r);let n=e.currentByteOffset,i=rt(e,t.inner);return e.seekTo(n+P(t)),i},uint8:e=>e.readUint8(),uint8x2:e=>_e(e.readUint8(),e.readUint8()),uint8x4:e=>ye(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>me(e.readInt8(),e.readInt8()),sint8x4:e=>he(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>_(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>I(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>_(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>I(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>_e(e.readUint16(),e.readUint16()),uint16x4:e=>ye(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>me(e.readInt16(),e.readInt16()),sint16x4:e=>he(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>_(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>I(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>_(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>I(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>_(e.readFloat16(),e.readFloat16()),float16x4:e=>I(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>_(e.readFloat32(),e.readFloat32()),float32x3:e=>oe(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>I(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>_e(e.readUint32(),e.readUint32()),uint32x3:e=>ne(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>ye(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>me(e.readInt32(),e.readInt32()),sint32x3:e=>Pe(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>he(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),r=(t>>22)/1023,n=(t>>12&1023)/1023,i=(t>>2&1023)/1023,s=(t&3)/3;return I(r,n,i,s)},"unorm8x4-bgra"(e){let t=e.readByte()/255,r=e.readByte()/255,n=e.readByte()/255,i=e.readByte()/255;return I(n,r,t,i)},unstruct(e,t){let r={},n=t.propTypes;for(let[i,s]of Object.entries(n))r[i]=rt(e,s);return r},disarray(e,t){let r=J(t),n=[];for(let i=0;i<t.elementCount;i++)le(e,r),n.push(rt(e,t.elementType));return le(e,r),n},"loose-decorated"(e,t){le(e,Ge(t));let r=e.currentByteOffset,n=rt(e,t.inner);return e.seekTo(r+P(t)),n}};function rt(e,t){let r=dy[t.type];if(!r)throw new Error(`Cannot read data of type '${t.type}'.`);return r(e,t)}function my(e,t){let r=P(e);if(r===0||t===void 0||t===null)return[];let n=new ArrayBuffer(r),i=new ir(n),s=[];function a(l,p,d,y){if(p!=null){if(pe(l)||Ye(l)){let $=Pu(l);for(let[T,G]of Object.entries($)){let Y=l.propTypes[T];if(!Y)continue;let D=p[T];D!==void 0&&a(Y,D,d+G.offset,G.padding??y)}return}if($e(l)||vt(l)){let $=l,T=Ve(P($.elementType),J($.elementType));if(!Array.isArray(p))throw new Error("Partial value for array must be an array");let G=p??[];G.sort((Y,D)=>Y.idx-D.idx);for(let{idx:Y,value:D}of G)a($.elementType,D,d+Y*T,T-P($.elementType))}else{let $=P(l);i.seekTo(d),Xn(i,l,p),s.push({start:d,end:d+$,padding:y})}}}if(a(e,t,0),s.length===0)return[];let o=[],u=s[0];for(let l=1;l<s.length;l++){let p=s[l];if(!p||!u)throw new Error("Internal error: missing segment");p.start===u.end+(u.padding??0)?(u.end=p.end,u.padding=p.padding):(o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),u=p)}if(!u)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(n,u.start,u.end-u.start)}),o}function Qn(e){return!!e?.usableAsStorage}var ma=class ku extends Error{constructor(t){super(`Resource '${w(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,ku.prototype)}};function Ou(e){return!!e.usableAsUniform}var Au={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},Fs=class{constructor(e,t){this.usage=e,this.buffer=t,this[h]={dataType:t.dataType},this[se]=t}resourceType="buffer-usage";[h];[se];$name(e){return this.buffer.$name(e),this}[z](e){let t=this.buffer.dataType,r=e.getUniqueName(this),{group:n,binding:i}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),s=Au[this.usage];return e.addDeclaration(`@group(${n}) @binding(${i}) var<${s}> ${r}: ${e.resolve(t).value};`),m(r,t,we(t)?"runtime":this.usage)}toString(){return`${this.usage}:${w(this)??"<unnamed>"}`}get[A](){let e=this.buffer.dataType,t=this.usage;return new Proxy({[h]:!0,get[ze](){return m(this,e,we(e)?"runtime":t)},[z]:r=>r.resolve(this),toString:()=>`${this.usage}:${w(this)??"<unnamed>"}.$`},je)}get $(){let e=Nn(),t=Rn();if(e.type==="normal")throw new Hs(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[A]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Gt(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):kr(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=Nn(),r=Rn();if(t.type==="normal")throw new Hs(r?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}kr(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},ya=class{constructor(e,t,r){this.usage=e,this.dataType=t,this[h]={dataType:t},this.#e=r,F(this,r.key)}[h];resourceType="buffer-usage";#e;[z](e){let t=this.dataType,r=e.getUniqueName(this),n=e.allocateLayoutEntry(this.#e.layout),i=Au[this.usage];return e.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var<${i}> ${r}: ${e.resolve(t).value};`),m(r,t,we(t)?"runtime":this.usage)}toString(){return`${this.usage}:${w(this)??"<unnamed>"}`}get[A](){let e=this.dataType,t=this.usage;return new Proxy({[h]:!0,get[ze](){return m(this,e,we(e)?"runtime":t)},[z]:r=>r.resolve(this),toString:()=>`${this.usage}:${w(this)??"<unnamed>"}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},ga=new WeakMap;function yy(e){if(!Qn(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=ga.get(e);return t||(t=new Fs("mutable",e),ga.set(e,t)),t}var wa=new WeakMap;function gy(e){if(!Qn(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=wa.get(e);return t||(t=new Fs("readonly",e),wa.set(e,t)),t}var xa=new WeakMap;function wy(e){if(!Ou(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=xa.get(e);return t||(t=new Fs("uniform",e),xa.set(e,t)),t}var xy={uniform:wy,mutable:yy,readonly:gy};function Mn(e,t,r){return jt(t)?new va(e,t,r):new va(e,t,r,["storage","uniform"])}function tn(e){return e.resourceType==="buffer"}var vy=lu(),va=class{constructor(t,r,n,i){this.dataType=r,this.initialOrBuffer=n,this._disallowedUsages=i,this.#e=t.device,Fi(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}[h]=!0;resourceType="buffer";flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC;#e;_buffer=null;_ownBuffer;_destroyed=!1;_hostBuffer;initial;usableAsUniform=!1;usableAsStorage=!1;usableAsVertex=!1;usableAsIndex=!1;get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(this.#e.createBuffer({size:P(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:w(this)??"<unnamed>"}),"_buffer"),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(t){return F(this,t),this._buffer&&(this._buffer.label=t),this}$usage(...t){for(let r of t){if(this._disallowedUsages?.includes(r))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${r}`);this.flags|=r==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=r==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=r==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=r==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||r==="uniform",this.usableAsStorage=this.usableAsStorage||r==="storage",this.usableAsVertex=this.usableAsVertex||r==="vertex",this.usableAsIndex=this.usableAsIndex||r==="index"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}compileWriter(){da(this.dataType)}_writeToTarget(t,r){let n=da(this.dataType);if(n)try{n(new DataView(t),0,r,vy==="little");return}catch(i){console.error(`Error when using compiled writer for buffer ${w(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,i)}Xn(new ir(t),this.dataType,r)}write(t){let r=this.buffer;if(r.mapState==="mapped"){let i=r.getMappedRange();this._writeToTarget(i,t);return}let n=P(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,t),this.#e.queue.writeBuffer(r,0,this._hostBuffer,0,n)}writePartial(t){let r=this.buffer,n=my(this.dataType,t);if(r.mapState==="mapped"){let i=r.getMappedRange(),s=new Uint8Array(i);for(let a of n)s.set(a.data,a.data.byteOffset)}else for(let i of n)this.#e.queue.writeBuffer(r,i.data.byteOffset,i.data,0,i.data.byteLength)}clear(){let t=this.buffer;if(t.mapState==="mapped"){new Uint8Array(t.getMappedRange()).fill(0);return}let r=this.#e.createCommandEncoder();r.clearBuffer(t),this.#e.queue.submit([r.finish()])}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let r=P(this.dataType),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t.buffer,0,this.buffer,0,r),this.#e.queue.submit([n.finish()])}async read(){let t=this.buffer;if(t.mapState==="mapped"){let s=t.getMappedRange();return rt(new At(s),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let s=t.getMappedRange(),a=rt(new At(s),this.dataType);return t.unmap(),a}let r=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(this.#e.createBuffer({size:P(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"r"),n=this.#e.createCommandEncoder();n.copyBufferToBuffer(t,0,r,0,P(this.dataType)),this.#e.queue.submit([n.finish()]),await r.mapAsync(GPUMapMode.READ,0,P(this.dataType));let i=rt(new At(r.getMappedRange()),this.dataType);return r.unmap(),r.destroy(),i}as(t){return xy[t]?.(this)}destroy(){this._destroyed||(this._destroyed=!0,this._ownBuffer&&this._buffer?.destroy())}toString(){return`buffer:${w(this)??"<unnamed>"}`}};function $y(e,t){return new Fu(Us(),e,t)}function by(e,t){return new Fu(Ps(),e,t)}function Bu(e){let t=e;return t?.resourceType==="sampler"&&!!t[h]}function Cu(e){let t=e;return t?.resourceType==="sampler-comparison"&&!!t[h]}var Ty=class{constructor(t,r){this.schema=t,this.#e=r,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",F(this,r.key)}[h]={unwrap:void 0};resourceType;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),m(r,this.schema,"handle")}get[A](){let t=this.schema;return new Proxy({[h]:!0,get[ze](){return m(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${w(this)??"<unnamed>"}`}},Fu=class{constructor(t,r,n){this.schema=t,this.#r=r,this.#n=n,this.resourceType=t.type==="sampler_comparison"?"sampler-comparison":"sampler",this[h]={unwrap:()=>(this.#t||(this.#t=this.#n.device.createSampler({...this.#r,label:w(this)??"<unnamed>"})),this.#t)},this.#e=r.minFilter==="linear"||r.magFilter==="linear"||r.mipmapFilter==="linear"}[h];resourceType;#e;#t=null;#r;#n;[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:this.#e?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),m(r,this.schema,"handle")}get[A](){let t=this.schema;return new Proxy({[h]:!0,get[ze](){return m(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(t){return F(this,t),this}toString(){return`${this.resourceType}:${w(this)??"<unnamed>"}`}},_y=class{constructor(t,r){this.schema=t,this.#e=r,F(this,r.key)}resourceType="external-texture";[h]=!0;#e;[z](t){let r=t.getUniqueName(this),n=t.allocateLayoutEntry(this.#e.layout);return t.addDeclaration(`@group(${n}) @binding(${this.#e.idx}) var ${r}: ${t.resolve(this.schema).value};`),m(r,Zo(),"handle")}get[A](){let t=this.schema;return new Proxy({[h]:!0,get[ze](){return m(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`textureExternal:${w(this)??"<unnamed>"}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${w(this)??"<unnamed>"}`}};function Gu(e){let{videoWidth:t,videoHeight:r}=e;if(t&&r)return{width:t,height:r};let{naturalWidth:n,naturalHeight:i}=e;if(n&&i)return{width:n,height:i};let{codedWidth:s,codedHeight:a}=e;if(s&&a)return{width:s,height:a};let{width:o,height:u}=e;if(o&&u)return{width:o,height:u};throw new Error("Cannot determine dimensions of the provided image source.")}var zy=`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) i: u32) -> VertexOutput {
  const pos = array(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  const uv = array(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));
  return VertexOutput(vec4f(pos[i], 0, 1), uv[i]);
}`,Iy=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(src, samp, uv);
}`,Sy=`
@group(0) @binding(0) var src: texture_2d<f32>;
@group(0) @binding(1) var samp: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  let r = textureGather(0, src, samp, uv);
  let g = textureGather(1, src, samp, uv);
  let b = textureGather(2, src, samp, uv);
  let a = textureGather(3, src, samp, uv);
  return vec4f(dot(r, vec4f(0.25)), dot(g, vec4f(0.25)), dot(b, vec4f(0.25)), dot(a, vec4f(0.25)));
}`,Xi=new WeakMap;function Ey(e){let t=Xi.get(e);return t||(t={vertexModule:e.createShaderModule({code:zy}),filterableResources:new Map,layoutResources:new Map},Xi.set(e,t)),t}function My(e,t,r){let n=Ey(e),i=n.filterableResources.get(t);i||(i={fragmentModule:e.createShaderModule({code:t?Iy:Sy}),sampler:(globalThis.__TYPEGPU_AUTONAME__??(o=>o))(e.createSampler(t?{magFilter:"linear",minFilter:"linear"}:{}),"sampler")},n.filterableResources.set(t,i));let s=`${t}:${r}`,a=n.layoutResources.get(s);if(!a){let o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:r}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:t?"filtering":"non-filtering"}}]});a={bindGroupLayout:o,pipelineLayout:e.createPipelineLayout({bindGroupLayouts:[o]})},n.layoutResources.set(s,a)}return{vertexModule:n.vertexModule,...i,...a}}function Lu(e){let{device:t,source:r,destination:n,format:i,filterable:s,sampleType:a}=e,o=My(t,s,a),u=t.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexModule},fragment:{module:o.fragmentModule,targets:[{format:i}]},primitive:{topology:"triangle-list"}}),l=t.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:r},{binding:1,resource:o.sampler}]}),p=!e.encoder,d=e.encoder??t.createCommandEncoder(),y=d.beginRenderPass({colorAttachments:[{view:n,loadOp:"clear",storeOp:"store"}]});y.setPipeline(u),y.setBindGroup(0,l),y.draw(3),y.end(),p&&t.queue.submit([d.finish()])}function Vy(e){Xi.delete(e)}function ju(e,t,r){let n=gn(t),i=Am(e,t),s=i.includes("float"),a=i.includes("unfilterable-float");if(!s&&!a)throw new Error(`Cannot ${r} for format '${t}': only float formats are supported.`);if(!n.canRenderAttachment)throw new Error(`Cannot ${r} for format '${t}': format does not support render attachments.`);return{filterable:s,sampleType:s?"float":"unfilterable-float"}}function Uy(e,t,r=0,n){if(t.dimension!=="2d")throw new Error("Mipmap generation only supports 2D textures.");let{filterable:i,sampleType:s}=ju(e,t.format,"generate mipmaps"),a=n??t.mipLevelCount-r;for(let o=0;o<t.depthOrArrayLayers;o++)for(let u=r;u<r+a-1;u++){let l=p=>({dimension:"2d",baseMipLevel:p,mipLevelCount:1,baseArrayLayer:o,arrayLayerCount:1});Lu({device:e,source:t.createView(l(u)),destination:t.createView(l(u+1)),format:t.format,filterable:i,sampleType:s})}}function Py(e,t,r,n=0){if(t.dimension!=="2d")throw new Error("Resampling only supports 2D textures.");let{filterable:i}=ju(e,t.format,"resample"),{width:s,height:a}=Gu(r),o=(globalThis.__TYPEGPU_AUTONAME__??(p=>p))(e.createTexture({size:[s,a],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),"s");e.queue.copyExternalImageToTexture({source:r},{texture:o},[s,a]);let u=(globalThis.__TYPEGPU_AUTONAME__??(p=>p))(e.createTexture({size:[t.width,t.height],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),"u"),l=e.createCommandEncoder();Lu({device:e,source:o.createView(),destination:u.createView(),format:t.format,filterable:i,sampleType:"float",encoder:l}),l.copyTextureToTexture({texture:u},{texture:t,origin:{x:0,y:0,z:n}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([l.finish()]),o.destroy(),u.destroy()}function ky(e){return{dimension:e.dimension??"2d",sampleType:gn(e.format).channelType,multisampled:(e.sampleCount??1)!==1}}function Oy(e,t){return new Ay(e,t)}function nn(e){return e?.resourceType==="texture"&&!!e[h]}function sn(e){return e?.resourceType==="texture-view"&&!!e[h]}var Ay=class{constructor(t,r){this.props=t;let n=t.format;this.#s=r,this.#e=gn(n);let i=this.#e.texelSize;this.#t=i==="non-copyable"?"non-copyable":t.size[0]*(t.size[1]??1)*(t.size[2]??1)*i,this[h]={unwrap:()=>{if(this.#r)throw new Error("This texture has been destroyed");return this.#i||(this.#i=r.device.createTexture({label:w(this)??"<unnamed>",format:t.format,size:t.size,usage:this.#n,dimension:t.dimension??"2d",viewFormats:t.viewFormats??[],mipLevelCount:t.mipLevelCount??1,sampleCount:t.sampleCount??1})),this.#i}}}[h];resourceType="texture";usableAsSampled=!1;usableAsStorage=!1;usableAsRender=!1;#e;#t;#r=!1;#n=GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;#i=null;#s;$name(t){return F(this,t),this}$usage(...t){let r=t.includes("storage"),n=t.includes("sampled"),i=t.includes("render");return this.#n|=n?GPUTextureUsage.TEXTURE_BINDING:0,this.#n|=r?GPUTextureUsage.STORAGE_BINDING:0,this.#n|=i?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||=r,this.usableAsSampled||=n,this.usableAsRender||=i,this}createView(t,r){return t==="render"?new Cy(this,r):new By(t??Li(ky(this.props)),this,r)}#a(t=0){let r=2**t,[n,i,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/r)),Math.max(1,Math.floor((this.props.size[1]??1)/r)),Math.max(1,Math.floor((this.props.size[2]??1)/r))],a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot clear texture with format '${this.props.format}': this format does not support copy operations.`);this.#s.device.queue.writeTexture({texture:this[h].unwrap(),mipLevel:t},new Uint8Array(n*i*s*a),{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}clear(t="all"){if(t==="all"){let r=this.props.mipLevelCount??1;for(let n=0;n<r;n++)this.#a(n)}else this.#a(t)}generateMipmaps(t=0,r){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=r??(this.props.mipLevelCount??1)-t;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${t}, total: ${this.props.mipLevelCount??1})`);return}if(t>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${t} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);Uy(this.#s.device,this[h].unwrap(),t,n)}write(t,r=0){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){this.#u(t,r);return}let n=this.props.dimension??"2d";if(!Array.isArray(t)){this.#o(t,n==="3d"?0:void 0);return}let i=this.props.size[2]??1;t.length>i&&console.warn(`Too many image sources provided. Expected ${i} layers, got ${t.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(t.length,i);s++){let a=t[s];a&&this.#o(a,s)}}#u(t,r){let n=Math.max(1,this.props.size[0]>>r),i=Math.max(1,(this.props.size[1]??1)>>r),s=Math.max(1,(this.props.size[2]??1)>>r),a=this.#e.texelSize;if(a==="non-copyable")throw new Error(`Cannot write to texture with format '${this.props.format}': this format does not support copy operations.`);let o=n*i*s*a,u=t.byteLength??t.byteLength;if(u!==o)throw new Error(`Buffer size mismatch. Expected ${o} bytes for mip level ${r}, got ${u} bytes.`);this.#s.device.queue.writeTexture({texture:this[h].unwrap(),mipLevel:r},"buffer"in t?t.buffer:t,{bytesPerRow:a*n,rowsPerImage:i},[n,i,s])}#o(t,r){let n=this.props.size[0],i=this.props.size[1]??1,{width:s,height:a}=Gu(t);if(s!==n||a!==i){Py(this.#s.device,this[h].unwrap(),t,r);return}this.#s.device.queue.copyExternalImageToTexture({source:t},{texture:this[h].unwrap(),...r!==void 0&&{origin:{x:0,y:0,z:r}}},r!==void 0?[n,i,1]:this.props.size)}copyFrom(t){if(t.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${t.props.format}, target texture has format ${this.props.format}`);if(t.props.size[0]!==this.props.size[0]||(t.props.size[1]??1)!==(this.props.size[1]??1)||(t.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${t.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let r=this.#s.device.createCommandEncoder();r.copyTextureToTexture({texture:t[h].unwrap()},{texture:this[h].unwrap()},t.props.size),this.#s.device.queue.submit([r.finish()])}get destroyed(){return this.#r}destroy(){this.#r||(this.#r=!0,this.#i?.destroy())}},By=class{constructor(t,r,n){this.schema=t,this.#e=r,this.#r=n,this[h]={unwrap:()=>{if(!this.#t){let i=this.schema,s=ji(i)?i.format:this.#e.props.format;this.#t=this.#e[h].unwrap().createView({...this.#r,label:w(this)??"<unnamed>",format:this.#r?.format??s,dimension:i.dimension})}return this.#t}}}[h];resourceType="texture-view";#e;#t;#r;$name(t){return F(this,t),this.#t&&(this.#t.label=t),this}get[A](){let t=this.schema;return new Proxy({[h]:!0,get[ze](){return m(this,t,"handle")},[z]:r=>r.resolve(this),toString:()=>`${this.toString()}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${w(this)??"<unnamed>"}`}[z](t){let r=t.getUniqueName(this),{group:n,binding:i}=t.allocateFixedEntry(ji(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:this.#r?.sampleType??this.schema.bindingSampleType[0]},this);return t.addDeclaration(`@group(${n}) @binding(${i}) var ${r}: ${t.resolve(this.schema).value};`),m(r,this.schema,"handle")}},$a=class{constructor(e,t){this.schema=e,this.#e=t,F(this,t.key)}[h]={unwrap:void 0};resourceType="texture-view";#e;toString(){return`textureView:${w(this)??"<unnamed>"}`}[z](e){let t=e.getUniqueName(this),r=e.allocateLayoutEntry(this.#e.layout);return e.addDeclaration(`@group(${r}) @binding(${this.#e.idx}) var ${t}: ${e.resolve(this.schema).value};`),m(t,this.schema,"handle")}get[A](){let e=this.schema;return new Proxy({[h]:!0,get[ze](){return m(this,e,"handle")},[z]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},je)}get $(){if(He())return this[A];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Cy=class{constructor(e,t={}){this.descriptor=t,this[h]={unwrap:()=>e[h].unwrap().createView({label:w(this)??"<unnamed>",...this.descriptor})}}[h];resourceType="texture-view"};function Fy(e){return!!e?.usableAsSampled}var Gy=class Ru extends Error{constructor(t){super(`Resource '${w(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Ru.prototype)}};function Ly(e){let t={};for(let[r,n]of Object.entries(e)){if(n===null){t[r]=null;continue}if("texture"in n&&typeof n.texture=="string"){let i=n.texture;t[r]={...n,texture:Li({dimension:n.viewDimension??"2d",sampleType:i==="sint"?j:i==="uint"?x:v,multisampled:n.multisampled??!1})}}else if("storageTexture"in n&&typeof n.storageTexture=="string"){let i={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[r]={...n,storageTexture:Li({access:i[n.access??"writeonly"],format:n.storageTexture,dimension:n.viewDimension??"2d"})}}else"externalTexture"in n&&Object.keys(n.externalTexture).length===0?t[r]={...n,externalTexture:{type:"texture_external",dimension:"2d"}}:t[r]=n}return t}function Nu(e){let t=Ly(e);return new Ry(t)}function Du(e){return!!e&&e.resourceType==="bind-group-layout"}function Hn(e){return!!e&&e.resourceType==="bind-group"}var jy=class qu extends Error{constructor(t,r){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${r}'`),Object.setPrototypeOf(this,qu.prototype)}},ba=["compute","fragment"],qr=["compute","vertex","fragment"],Ry=class{constructor(e){this.entries=e;let t=0;for(let[r,n]of Object.entries(e)){if(n===null){t++;continue}let i={layout:this,key:r,idx:t};if("uniform"in n&&(this.bound[r]=new ya("uniform",n.uniform,i)),"storage"in n){let s="type"in n.storage?n.storage:n.storage(0);this.bound[r]=new ya(n.access??"readonly",s,i)}"texture"in n&&(this.bound[r]=new $a(n.texture,i)),"storageTexture"in n&&(this.bound[r]=new $a(n.storageTexture,i)),"externalTexture"in n&&(this.bound[r]=new _y(n.externalTexture,i)),"sampler"in n&&(this.bound[r]=new Ty(n.sampler==="comparison"?Ps():Us(),i)),Object.defineProperty(this.value,r,{get:()=>this.bound[r].value}),t++}}[h]=!0;_index;resourceType="bind-group-layout";bound={};value={};$=this.value;get[A](){return this.$}toString(){return`bindGroupLayout:${w(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return F(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:w(this)??"<unnamed>",entries:Object.values(this.entries).map((t,r)=>{if(t===null)return null;let n=t.visibility,i={binding:r,visibility:0};if("uniform"in t)n=n??qr,i.buffer={type:"uniform"};else if("storage"in t)n=n??(t.access==="mutable"?ba:qr),i.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)n=n??qr,i.sampler={type:t.sampler};else if("texture"in t){n=n??qr;let{multisampled:s,dimension:a,bindingSampleType:o}=t.texture;i.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:s}}else if("storageTexture"in t){n=n??ba;let{dimension:s,access:a,format:o}=t.storageTexture;i.storageTexture={access:a,format:o,viewDimension:s}}else"externalTexture"in t&&(n=n??qr,i.externalTexture={});return n?.includes("compute")&&(i.visibility|=GPUShaderStage.COMPUTE),n?.includes("vertex")&&(i.visibility|=GPUShaderStage.VERTEX),n?.includes("fragment")&&(i.visibility|=GPUShaderStage.FRAGMENT),i}).filter(t=>t!==null)})}},Wu=class{constructor(e,t){this.layout=e,this.entries=t;for(let r of Object.keys(e.entries))if(e.entries[r]!==null&&!(r in t))throw new jy(w(e),r)}resourceType="bind-group";unwrap(e){return e.device.createBindGroup({label:w(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,r],n)=>{if(r===null)return null;let i=this.entries[t];if(i===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${w(this.layout)??"<unnamed>"}'.`);if("uniform"in r){let s;if(tn(i)){if(!Ou(i))throw new ql(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("storage"in r){let s;if(tn(i)){if(!Qn(i))throw new ma(i);s={buffer:e.unwrap(i)}}else s={buffer:i};return{binding:n,resource:s}}if("texture"in r){let s;if(nn(i)){if(!Fy(i))throw new Gy(i);s=e.unwrap(i.createView(r.texture))}else sn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("storageTexture"in r){let s;if(nn(i)){if(!Qn(i))throw new ma(i);s=e.unwrap(i.createView(r.storageTexture))}else sn(i)?s=e.unwrap(i):s=i;return{binding:n,resource:s}}if("sampler"in r)return Cu(i)||Bu(i)?{binding:n,resource:e.unwrap(i)}:{binding:n,resource:i};if("externalTexture"in r)return{binding:n,resource:i};throw new Error(`Malformed bind group entry: ${Lt(i)}`)}).filter(t=>t!==null)})}};function Zn(e){return new Ny(e)}var Ny=class{constructor(e=void 0){this.defaultValue=e}[h]=!0;resourceType="slot";$name(e){return F(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${w(this)??"<unnamed>"}`}get[A](){let e=Ue();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return wi(e.unwrap(this))}get value(){return this[A]}get $(){return this.value}};function Jn(e,t){return new Yu("private",e,t)}function Ta(e){return new Yu("workgroup",e)}var Yu=class{[h]={};#e;#t;#r;constructor(t,r,n){this.#e=t,this.#t=r,this.#r=n}[z](t){let r=t.getUniqueName(this),n=`var<${this.#e}> ${r}: ${t.resolve(this.#t).value}`;return this.#r?t.addDeclaration(`${n} = ${t.resolve(this.#r,this.#t).value};`):t.addDeclaration(`${n};`),m(r,this.#t,we(this.#t)?"runtime":this.#e)}$name(t){return F(this,t),this}toString(){return`var:${w(this)??"<unnamed>"}`}get[A](){let t=this.#t,r=we(t)?"runtime":this.#e;return new Proxy({[h]:!0,get[ze](){return m(this,t,r)},[z]:n=>n.resolve(this),toString:()=>`var:${w(this)??"<unnamed>"}.$`},je)}get $(){let t=Nn(),r=Rn();if(t.type==="normal")throw new Qs(r?`Cannot access variable '${w(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return t.type==="codegen"?this[A]:t.type==="simulate"?(t.vars[this.#e].has(this)||t.vars[this.#e].set(this,this.#r),t.vars[this.#e].get(this)):kr(t,"tgpuVariable.ts#TgpuVarImpl/$")}set $(t){let r=Nn(),n=Rn();if(r.type==="normal")throw new Qs(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(r.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(r.type==="simulate"){r.vars[this.#e].set(this,t);return}kr(r,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(t){this.$=t}},Xu=Jn(x,0).$name("dataBlockIndex"),Qu=Jn(x,0).$name("dataByteIndex"),Hu=Zn().$name("dataBuffer"),Dy=O([],x)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:Qu}).$name("nextByteIndex"),g="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",Zu={f32:O([v])`(n) => {
  ${g} = bitcast<u32>(n);
}`,f16:O([ae])`(n) => {
  ${g} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:O([j])`(n) => {
  ${g} = bitcast<u32>(n);
}`,u32:O([x])`(n) => {
  ${g} = n;
}`,bool:O([C])`(b) => {
  ${g} = u32(b);
}`,vec2f:O([_])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
}`,vec3f:O([oe])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
}`,vec4f:O([I])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
  ${g} = bitcast<u32>(v.w);
}`,vec2h:O([ut])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:O([lt])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${g} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:O([ht])`(v) => {
  ${g} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${g} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:O([me])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
}`,vec3i:O([Pe])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
}`,vec4i:O([he])`(v) => {
  ${g} = bitcast<u32>(v.x);
  ${g} = bitcast<u32>(v.y);
  ${g} = bitcast<u32>(v.z);
  ${g} = bitcast<u32>(v.w);
}`,vec2u:O([_e])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
}`,vec3u:O([ne])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
  ${g} = v.z;
}`,vec4u:O([ye])`(v) => {
  ${g} = v.x;
  ${g} = v.y;
  ${g} = v.z;
  ${g} = v.w;
}`,"vec2<bool>":O([er])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
}`,"vec3<bool>":O([tr])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
  ${g} = u32(v.z);
}`,"vec4<bool>":O([rr])`(v) => {
  ${g} = u32(v.x);
  ${g} = u32(v.y);
  ${g} = u32(v.z);
  ${g} = u32(v.w);
}`,mat2x2f:O([_t])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
}`,mat3x3f:O([zt])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[0][2]);
  ${g} = 0u;
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
  ${g} = bitcast<u32>(m[1][2]);
  ${g} = 0u;
  ${g} = bitcast<u32>(m[2][0]);
  ${g} = bitcast<u32>(m[2][1]);
  ${g} = bitcast<u32>(m[2][2]);
  ${g} = 0u;
}`,mat4x4f:O([W])`(m) => {
  ${g} = bitcast<u32>(m[0][0]);
  ${g} = bitcast<u32>(m[0][1]);
  ${g} = bitcast<u32>(m[0][2]);
  ${g} = bitcast<u32>(m[0][3]);
  ${g} = bitcast<u32>(m[1][0]);
  ${g} = bitcast<u32>(m[1][1]);
  ${g} = bitcast<u32>(m[1][2]);
  ${g} = bitcast<u32>(m[1][3]);
  ${g} = bitcast<u32>(m[2][0]);
  ${g} = bitcast<u32>(m[2][1]);
  ${g} = bitcast<u32>(m[2][2]);
  ${g} = bitcast<u32>(m[2][3]);
  ${g} = bitcast<u32>(m[3][0]);
  ${g} = bitcast<u32>(m[3][1]);
  ${g} = bitcast<u32>(m[3][2]);
  ${g} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(Zu))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:Xu,nextByteIndex:Dy,dataBuffer:Hu});function Ju(e){return`(${e.map((t,r)=>`_arg_${r}`).join(", ")})`}function Ku(e,t){let r=Zu[e.type];if(r)return r.with(Hu,t);if(pe(e)){let n=Object.keys(e.propTypes),i=Object.values(e.propTypes),s=el(i,t);return O([e])`(arg) {\n  propsSerializer(${n.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:s}).$name(`${w(e)??"struct"}Serializer`)}if($e(e)){let n=e.elementType,i=e.elementCount,s=Ku(n,t);return O([e])`(arg) {\n${Array.from({length:i},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:s}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function el(e,t){let r={},n=O(e),i=Ju(e),s=e.map((a,o)=>(r[`serializer${o}`]=Ku(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return n`${i} {\n${s}\n}`.$uses(r).$name("compoundSerializer")}function qy(e,t,r,n,i){let s=t.map(P).reduce((u,l)=>u+l,0);if(s>i.logSizeLimit)throw new Error(`Logged data needs to fit in ${i.logSizeLimit} bytes (one of the logs requires ${s} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=el(t,r).$name(`log${e}serializer`),o=Ju(t);return O(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${i.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:n,dataBuffer:r,dataBlockIndex:Xu,dataByteIndex:Qu,compoundSerializer:a}).$name(`log${e}`)}var Wy=["log","debug","info","warn","error","clear"],Yy={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},tl=m("/* console.log() */",re,"runtime"),Xy=class{get logResources(){}generateLog(){return console.warn("'console.log' is only supported when resolving pipelines."),tl}},Qy=class{#e;#t;#r=1;#n;#i;constructor(t){this.#e={...Yy,...t[h].logOptions},this.#t=new Map;let r=ai({id:x,serializedData:Qt(x,Math.ceil(this.#e.logSizeLimit/4))}).$name("SerializedLogData");this.#i=t.createMutable(Qt(r,this.#e.logCountLimit)).$name("dataBuffer"),this.#n=t.createMutable(Ko(x)).$name("indexBuffer")}generateLog(t,r,n){if(!Wy.includes(r))return console.warn(`Unsupported log method '${r}' was used in TGSL.`),tl;let i=$h(n),s=this.#r++,a=i.filter(l=>l.dataType!==De),o=qy(s,a.map(l=>l.dataType),this.#i,this.#n,this.#e),u=i.map(l=>l.dataType===De?l.value:l.dataType);return this.#t.set(s,{op:r,argTypes:u}),m(c`${t.resolve(o).value}(${a})`,re,"runtime")}get logResources(){return this.#r===1?void 0:{dataBuffer:this.#i,indexBuffer:this.#n,options:this.#e,logIdToMeta:this.#t}}},_a={mat2x2f:_,mat3x3f:oe,mat4x4f:I};function rl(e,t){if($e(e.dataType)||vt(e.dataType)){let r=e.dataType.elementType,n=we(r),i=Sr(e),s=t.origin==="constant",a;return e.origin==="constant-tgpu-const-ref"?s?a=n?"constant":"constant-tgpu-const-ref":a=n?"runtime":"runtime-tgpu-const-ref":e.origin==="runtime-tgpu-const-ref"?a=n?"runtime":"runtime-tgpu-const-ref":!i&&!n?a=e.origin:s&&e.origin==="constant"?a="constant":a="runtime",m(Ee(e)&&Ee(t)?e.value[t.value]:c`${e}[${t}]`,r,a)}if(at(e.dataType))return m(Ee(e)&&Ee(t)?e.value[t.value]:c`${e}[${t}]`,e.dataType.primitive,e.origin==="constant"||e.origin==="constant-tgpu-const-ref"?"constant":"runtime");if(qe(e.dataType))return rl(ls(e),t);if(e.value instanceof Wa){let r=_a[e.value.matrix.dataType.type];return m(c`${e.value.matrix}[${t}]`,r,e.origin)}if(e.dataType.type in _a)throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");if(Ee(e)&&Ee(t)||e.dataType.type==="unknown")return si(e.value[t.value])}var{NodeTypeCatalog:L}=Cm,Hy=["==","!=","===","!==","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],Zy=["&&","||","==","!=","===","!==","<","<=",">",">="],za={"===":"==","!==":"!=",get">>>"(){throw new Error("The `>>>` operator is unsupported in TypeGPU functions.")},get in(){throw new Error("The `in` operator is unsupported in TypeGPU functions.")},get instanceof(){throw new Error("The `instanceof` operator is unsupported in TypeGPU functions.")},get"|>"(){throw new Error("The `|>` operator is unsupported in TypeGPU functions.")},get"??"(){throw new Error("The `??` operator is unsupported in TypeGPU functions.")},get">>>="(){throw new Error("The `>>>=` operator is unsupported in TypeGPU functions.")},get"**="(){throw new Error("The `**=` operator is unsupported in TypeGPU functions.")},get"??="(){throw new Error("The `??=` operator is unsupported in TypeGPU functions.")},get"&&="(){throw new Error("The `&&=` operator is unsupported in TypeGPU functions.")},get"||="(){throw new Error("The `||=` operator is unsupported in TypeGPU functions.")}};function Ia(e,t,r){return r?Zy.includes(t)?C:t==="="?r:e:t==="!"||t==="~"?C:e}var Jy={"-":Go[h].gpuImpl},Ky={"+":kt[h].gpuImpl,"-":nr[h].gpuImpl,"*":Ht[h].gpuImpl,"/":fi[h].gpuImpl,"**":yu[h].gpuImpl},eg=class{#e=void 0;initGenerator(e){this.#e=e}get ctx(){if(!this.#e)throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return this.#e}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let r=t.map(n=>this.statement(n)).join(`
`);return this.ctx.dedent(),`{
${r}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}refVariable(e,t){let r=this.ctx.makeNameValid(e),n=us(t),i=m(new yt(m(r,t,"function"),n),n,"function");return this.ctx.defineVariable(e,i),r}blockVariable(e,t,r,n){let i=we(r),s;n==="constant-tgpu-const-ref"||n==="runtime-tgpu-const-ref"?s=n:n==="argument"?i?s="runtime":s="argument":i?n==="constant"&&e==="const"?s="constant":s="runtime":s=ro(n)?"this-function":n;let a=m(this.ctx.makeNameValid(t),r,s);return this.ctx.defineVariable(t,a),a}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let r=this.ctx.expectedType;this.ctx.expectedType=t;try{let n=this.expression(e);return qt(n,t)}finally{this.ctx.expectedType=r}}expression(e){if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return m(e,C,"constant");if(e[0]===L.logicalExpr||e[0]===L.binaryExpr||e[0]===L.assignmentExpr){let[t,r,n,i]=e,s=this.expression(r),a=this.expression(i);if(a.value instanceof yt)throw new B(c`Cannot assign a ref to an existing variable '${s}', define a new variable instead.`);if(n==="==")throw new Error("Please use the === operator instead of ==");if(n==="==="&&Ee(s)&&Ee(a))return m(s.value===a.value,C,"constant");if(s.dataType.type==="unknown")throw new B(`Left-hand side of '${n}' is of unknown type`);if(a.dataType.type==="unknown")throw new B(`Right-hand side of '${n}' is of unknown type`);let o=Ky[n];if(o)return o(s,a);let u=t===L.assignmentExpr?[s.dataType]:void 0,[l,p]=Er([s,a],u)??[s,a],d=this.ctx.resolve(l.value,l.dataType).value,y=this.ctx.resolve(p.value,p.dataType).value,$=Ia(l.dataType,n,p.dataType);if(t===L.assignmentExpr){if(l.origin==="constant"||l.origin==="constant-tgpu-const-ref"||l.origin==="runtime-tgpu-const-ref")throw new B(`'${d} = ${y}' is invalid, because ${d} is a constant.`);if(s.origin==="argument")throw new B(`'${d} ${n} ${y}' is invalid, because non-pointer arguments cannot be mutated.`);if(a.origin==="argument"&&!we(a.dataType))throw new B(`'${d} = ${y}' is invalid, because argument references cannot be assigned.
-----
Try '${d} = ${this.ctx.resolve(a.dataType).value}(${y})' to copy the value instead.
-----`);if(!Sr(a))throw new B(`'${d} = ${y}' is invalid, because references cannot be assigned.
-----
Try '${d} = ${this.ctx.resolve(a.dataType).value}(${y})' to copy the value instead.
-----`)}return m(Hy.includes(n)?`(${d} ${za[n]??n} ${y})`:`${d} ${za[n]??n} ${y}`,$,"runtime")}if(e[0]===L.postUpdate){let[t,r,n]=e,i=this.expression(n),s=this.ctx.resolve(i.value,i.dataType).value;return m(`${s}${r}`,i.dataType,"runtime")}if(e[0]===L.unaryExpr){let[t,r,n]=e,i=this.expression(n),s=Jy[r];if(s)return s(i);let a=this.ctx.resolve(i.value,i.dataType).value,o=Ia(i.dataType,r);return m(`${r}${a}`,o,"runtime")}if(e[0]===L.memberAccess){let[t,r,n]=e,i=this.expression(r);if(i.value===console)return m(new Ys(n),De,"runtime");let s=Vs(i,n);if(!s)throw new Error(c`Property '${n}' not found on value '${i}' of type ${this.ctx.resolve(i.dataType)}`);return s}if(e[0]===L.indexAccess){let[t,r,n]=e,i=this.expression(r),s=this.expression(n),a=Er([s],[x,j],!1)?.[0]??s,o=rl(i,a);if(!o){let u=this.ctx.resolve(i.value,i.dataType).value,l=this.ctx.resolve(a.value,a.dataType).value;throw new Error(`Unable to index value ${u} of unknown type with index ${l}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}return o}if(e[0]===L.numericLiteral){let t=typeof e[1]=="string"?Wn(rg(e[1])):Wn(e[1]);if(!t)throw new Error(`Invalid numeric literal ${e[1]}`);return t}if(e[0]===L.call){let[t,r,n]=e,i=this.expression(r);if(pe(i.value)||$e(i.value)){if(n.length>1)throw new B("Array and struct schemas should always be called with at most 1 argument");if(!n[0])return m(`${this.ctx.resolve(i.value).value}()`,i.value,"runtime");let o=this.typedExpression(n[0],i.value);return m(this.ctx.resolve(o.value,i.value).value,i.value,"runtime")}if(i.value===Di)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(i.value instanceof qa){if(!n[0])throw new B(`An infix operator '${i.value.name}' was called without any arguments`);let o=this.expression(n[0]);return i.value.operator(i.value.lhs,o)}if(!k(i.value)){let o=n.map(l=>this.expression(l)),u=this.ctx.shelllessRepo.get(i.value,o);if(u){let l=o.map((p,d)=>{let y=u.argTypes[d];return qt(p,y,!1)});return this.ctx.withResetIndentLevel(()=>{let p=this.ctx.resolve(u);return m(c`${p.value}(${l})`,p.dataType,"runtime")})}throw new Error(`Function '${w(i.value)??String(i.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let s=i.value[h]?.argConversionHint??"keep",a=i.value[h]?.strictSignature;try{let o;if(a)o=n.map((l,p)=>{let d=a.argTypes[p];if(!d)throw new B(`Function '${w(i.value)}' was called with too many arguments`);return this.typedExpression(l,d)});else if(Array.isArray(s))o=n.map((l,p)=>{let d=s[p];if(!d)throw new B(`Function '${w(i.value)}' was called with too many arguments`);return this.typedExpression(l,d)});else{let l=n.map(p=>this.expression(p));s==="keep"?o=l:s==="unify"?o=Er(l)??l:o=s(...l).map((p,d)=>[p,l[d]]).map(([p,d])=>qt(d,p))}if(i.value instanceof Ys)return this.ctx.generateLog(i.value.op,o);let u=i.value(...o);if(!os(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(o){throw o instanceof Ir?o:new Ir(o,[{toString:()=>`fn:${w(i.value)}`}])}}if(e[0]===L.objectExpr){let t=e[1],r=this.ctx.expectedType;if(!r||!pe(r))throw new B(`No target type could be inferred for object with keys [${Object.keys(t).join(", ")}], please wrap the object in the corresponding schema.`);let n=Object.fromEntries(Object.entries(r.propTypes).map(([s,a])=>{let o=t[s];if(o===void 0)throw new B(`Missing property ${s} in object literal for struct ${r}`);let u=this.typedExpression(o,a);return[s,u]})),i=lh(r,n);return m(c`${this.ctx.resolve(r).value}(${i})`,r,"runtime")}if(e[0]===L.arrayExpr){let[t,r]=e,n=this.ctx.expectedType,i,s;if($e(n)){if(i=n.elementType,s=r.map(o=>this.typedExpression(o,i)),s.length!==n.elementCount)throw new B(`Cannot create value of type '${n}' from an array of length: ${s.length}`)}else{let o=r.map(l=>{let p=this.expression(l);if(p.origin==="argument"&&!we(p.dataType)||!Sr(p)){let d=this.ctx.resolve(p.value,p.dataType).value,y=this.ctx.resolve(Pt(p.dataType)).value;throw new B(`'${d}' reference cannot be used in an array constructor.
-----
Try '${y}(${d})' or 'arrayOf(${y}, count)([...])' to copy the value instead.
-----`)}return p});if(o.length===0)throw new B("Cannot infer the type of an empty array literal.");let u=Er(o);if(!u)throw new B("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");s=u,i=Pt(s[0]?.dataType)}let a=`array<${this.ctx.resolve(i).value}, ${s.length}>`;return m(c`${a}(${s})`,Qt[h].jsImpl(i,s.length),"runtime")}if(e[0]===L.stringLiteral)return m(e[1],De,"constant");if(e[0]===L.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");tg(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===L.return){let t=e[1];if(t!==void 0){let r=this.ctx.topFunctionReturnType,n=r?this.typedExpression(t,r):this.expression(t);if(n.value instanceof yt)throw new B(c`Cannot return references, returning '${n.value.snippet}'`);if(n.origin==="argument"&&!we(n.dataType)&&this.ctx.topFunctionScope?.functionType==="normal")throw new B(c`Cannot return references to arguments, returning '${n}'. Copy the argument before returning it.`);if(!r&&!Sr(n)&&n.origin!=="this-function"){let i=this.ctx.resolve(n.value,n.dataType).value,s=this.ctx.resolve(bn(n.dataType)).value;throw new B(`'return ${i};' is invalid, cannot return references.
-----
Try 'return ${s}(${i});' instead.
-----`)}return n=qt(n,bn(n.dataType),!1),st(n.dataType.type!=="unknown"),this.ctx.reportReturnType(n.dataType),c`${this.ctx.pre}return ${n};`}return`${this.ctx.pre}return;`}if(e[0]===L.if){let[t,r,n,i]=e,s=this.typedExpression(r,C),a=s.value===!1?void 0:this.block(Vn(n)),o=s.value===!0||!i?void 0:this.block(Vn(i));return s.value===!0?`${this.ctx.pre}${a}`:s.value===!1?o?`${this.ctx.pre}${o}`:"":o?c`\
${this.ctx.pre}if (${s}) ${a}
${this.ctx.pre}else ${o}`:c`${this.ctx.pre}if (${s}) ${a}`}if(e[0]===L.let||e[0]===L.const){let t="var",[r,n,i]=e,s=i!==void 0?this.expression(i):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);let a=Sr(s),o=s.dataType,u=we(o);if(Ar(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);if(s.value instanceof yt){if(s.dataType.type!=="unknown")throw new B("Cannot store d.ref() in a variable if it references another value. Copy the value passed into d.ref() instead.");let p=s.value.snippet,d=this.refVariable(n,Pt(p.dataType));return c`${this.ctx.pre}var ${d} = ${qt(p,p.dataType,!1)};`}if(a){if(r===L.const)s.origin==="argument"?t="let":u&&(t=s.origin==="constant"?"const":"let");else if(s.origin==="argument"&&!u){let p=this.ctx.resolve(s.value).value,d=this.ctx.resolve(bn(s.dataType)).value;throw new B(`'let ${n} = ${p}' is invalid, because references to arguments cannot be assigned to 'let' variable declarations.
  -----
  - Try 'let ${n} = ${d}(${p})' if you need to reassign '${n}' later
  - Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
  -----`)}}else{if(r===L.let){let p=this.ctx.resolve(s.value).value,d=this.ctx.resolve(bn(s.dataType)).value;throw new B(`'let ${n} = ${p}' is invalid, because references cannot be assigned to 'let' variable declarations.
-----
- Try 'let ${n} = ${d}(${p})' if you need to reassign '${n}' later
- Try 'const ${n} = ${p}' if you won't reassign '${n}' later.
-----`)}if(s.origin==="constant-tgpu-const-ref")t="const";else if(s.origin==="runtime-tgpu-const-ref")t="let";else{if(t="let",!qe(o)){let p=io(s.origin,Pt(o));st(p!==void 0,`Creating pointer type from origin ${s.origin}`),o=p}s.value instanceof yt||(o=Kl(o))}}let l=this.blockVariable(t,n,Pt(o),s.origin);return c`${this.ctx.pre}${t} ${l.value} = ${qt(s,o,!1)};`}if(e[0]===L.block)return this.block(e);if(e[0]===L.for){let[t,r,n,i,s]=e,[a,o,u]=this.ctx.withResetIndentLevel(()=>[r?this.statement(r):void 0,n?this.typedExpression(n,C):void 0,i?this.statement(i):void 0]),l=a?a.slice(0,-1):"",p=u?u.slice(0,-1):"",d=this.block(Vn(s));return c`${this.ctx.pre}for (${l}; ${o}; ${p}) ${d}`}if(e[0]===L.while){let[t,r,n]=e,i=this.typedExpression(r,C),s=this.ctx.resolve(i.value).value,a=this.block(Vn(n));return`${this.ctx.pre}while (${s}) ${a}`}return e[0]===L.continue?`${this.ctx.pre}continue;`:e[0]===L.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}};function tg(e){throw new Error(`'${Lt(e)}' was not handled by the WGSL generator.`)}function rg(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function Vn(e){return typeof e!="object"||e[0]!==L.block?[L.block,[e]]:e}var ng=new eg,nl=ng,il="#CATCHALL#",ig=class{_stack=[];_itemDepth=0;get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,r,n,i){let s={type:"functionScope",functionType:e,args:t,argAliases:r,returnType:n,externalMap:i,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="item")r.usedSlots.add(e);else if(r?.type==="slotBinding"){let n=r.bindingMap.get(e);if(n!==void 0)return n}else if(!(r?.type==="functionScope"||r?.type==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let r=this._stack[t];if(r?.type==="functionScope"){let n=r.args.find(s=>s.value===e);if(n!==void 0)return n;if(r.argAliases[e])return r.argAliases[e];let i=r.externalMap[e];return i!=null?si(i):void 0}if(r?.type==="blockScope"){let n=r.declarations.get(e);if(n!==void 0)return n}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let r=this._stack.length-1;r>=0;--r){let n=this._stack[r];if(n?.type==="blockScope"){n.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},kn=["","  ","    ","      ","        ","          ","            ","              ","                "],zi=kn.length-1,sg=class{identLevel=0;get pre(){return kn[this.identLevel]??kn[zi].repeat(this.identLevel/zi)+kn[this.identLevel%zi]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},sl=class{#e;#t;_indentController=new sg;_itemStateStack=new ig;#r=[];_declarations=[];_varyingLocations;#n=new WeakSet;#i;get varyingLocations(){return this._varyingLocations}[h]={itemStateStack:this._itemStateStack};bindGroupLayoutsToPlaceholderMap=new Map;_nextFreeLayoutPlaceholderIdx=0;fixedBindings=[];enableExtensions;expectedType;constructor(e){this.enableExtensions=e.enableExtensions,this.#t=e.shaderGenerator??nl,this.#i=e.root?new Qy(e.root):new Xy,this.#e=e.namespace[h]}getUniqueName(e){return ty(this.#e,e)}makeNameValid(e){return this.#e.nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionScope(){return this._itemStateStack.topFunctionScope}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return st(e),e.returnType}get shelllessRepo(){return this.#e.shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;st(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return this.#i.generateLog(this,e,t)}get logResources(){return this.#i.logResources}fnToWgsl(e){let t=!1;try{this.#e.nameRegistry.pushFunctionScope();let r=[],n=[];for(let[o,u]of e.argTypes.entries()){let l=e.params[o],p=qe(u)?u.addressSpace==="storage"?u.access==="read"?"readonly":"mutable":u.addressSpace:"argument";switch(l?.type){case Ni.identifier:{let d=l.name,y=m(this.makeNameValid(d),u,p);r.push(y),y.value!==d&&n.push([d,y]);break}case Ni.destructuredObject:{r.push(m(`_arg_${o}`,u,p)),n.push(...l.props.map(({name:d,alias:y})=>{let $=xt(e.argTypes[o].propTypes[d]);return[y,m(`_arg_${o}.${d}`,$,"argument")]}));break}case void 0:r.push(m(`_arg_${o}`,u,p))}}let i=this._itemStateStack.pushFunctionScope(e.functionType,r,Object.fromEntries(n),e.returnType,e.externalMap);t=!0,this.#t.initGenerator(this);let s=this.#t.functionDefinition(e.body),a=e.returnType;if(!a){let o=[...i.reportedReturnTypes];if(o.length===0)a=re;else{let u=cs(o);u&&!u.hasImplicitConversions&&(a=u.targetType)}if(!a)throw new Error(`Expected function to have a single return type, got [${o.join(", ")}]. Cast explicitly to the desired type.`);a=Pt(a)}return{head:ag(this,r,a),body:s,returnType:a}}finally{t&&this._itemStateStack.popFunctionScope(),this.#e.nameRegistry.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,r=t.get(e);return r||(r=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,r)),r}allocateFixedEntry(e,t){let r=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:il,binding:r}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new Dl(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(Ci(e))return this.withSlots(e[Xt].pairs,()=>this.unwrap(e[Xt].inner));let t=e;for(;;)if(Ai(t))t=this.readSlot(t);else if(Bi(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=this.#e.memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;this.pushMode(new on);let r;try{r=e["~compute"]()}finally{this.popMode("normal")}let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedDerived.set(e,t),r}catch(r){throw r instanceof Ir?r.appendToTrace(e):new Ir(r,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=this.#e.memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let i of t)if([...i.slotToValueMap.entries()].every(([s,a])=>s.areEqual(this._itemStateStack.readSlot(s),a)))return i.result;let r;if(Br(e))r=m(Vu(this,e),re,"runtime");else if(Bi(e)||Ai(e))r=this.resolve(this.unwrap(e));else if(so(e))r=e[z](this);else if(Xr(e)){let i=this.#e.shelllessRepo.get(e,void 0);if(!i)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(i))}else throw new TypeError(`Unresolvable internal value: ${Lt(e)}`);let n=new Map;for(let i of this._itemStateStack.topItem.usedSlots)n.set(i,this._itemStateStack.readSlot(i));return t.push({slotToValueMap:n,result:r}),this.#e.memoizedResolves.set(e,t),r}catch(r){throw r instanceof Ir?r.appendToTrace(e):new Ir(r,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(zu(e)||Xr(e)){if(this.#n.has(e)&&!this.#e.memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);this.#n.add(e)}if(Ci(e))return this.withSlots(e[Xt].pairs,()=>this.resolve(e[Xt].inner,t));if(k(e)||Xr(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new th);let r=ao(this,()=>this._getOrInstantiate(e));return m(`${[...this._declarations].join(`

`)}${r.value}`,re,"runtime")}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let r=t??Wn(e).dataType;if(st(r.type!=="unknown"),r.type==="abstractInt")return m(`${e}`,r,"constant");if(r.type==="u32")return m(`${e}u`,r,"constant");if(r.type==="i32")return m(`${e}i`,r,"constant");let n=e.toExponential(),i=r.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,s=n.length<i.length?n:i;return r.type==="f32"?m(`${s}f`,r,"constant"):r.type==="f16"?m(`${s}h`,r,"constant"):m(s,r,"constant")}if(typeof e=="boolean")return m(e?"true":"false",C,"constant");if(typeof e=="string")return m(e,re,"runtime");if(t&&$e(t)){if(!Array.isArray(e))throw new B(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new B(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let r=this.resolve(t.elementType);return m(c`array<${r}, ${t.elementCount}>(${e.map(n=>m(n,t.elementType,"runtime"))})`,t,"runtime")}if(Array.isArray(e))return m(c`array(${e.map(r=>this.resolve(r))})`,De,"runtime");if(t&&pe(t))return m(c`${this.resolve(t)}(${Object.entries(t.propTypes).map(([r,n])=>m(e[r],n,"runtime"))})`,t,"runtime");throw new B(`Value ${e} (as json: ${Lt(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){this.#r.push(e)}popMode(e){let t=this.#r.pop();e!==void 0&&st(t?.type===e)}get mode(){return this.#r[this.#r.length-1]??oo}};function vi(e,t){let r=new sl(t),n=(t.config?r.withSlots(t.config(new Uu([])).bindings,()=>r.resolve(e)):r.resolve(e)).value,i=r.bindGroupLayoutsToPlaceholderMap,s=[],a=new Set([...i.keys()].map(d=>d.index).filter(d=>d!==void 0)),o=ly(a),u=r.fixedBindings.map((d,y)=>[String(y),d.layoutEntry]),l=()=>{let d=o.next().value,y=Nu(Object.fromEntries(u));return s[d]=y,n=n.replaceAll(il,String(d)),[d,new Wu(y,Object.fromEntries(r.fixedBindings.map(($,T)=>[String(T),$.resource])))]},p=u.length>0?l():void 0;for(let[d,y]of i.entries()){let $=d.index??o.next().value;s[$]=d,n=n.replaceAll(y,String($))}return t.enableExtensions&&t.enableExtensions.length>0&&(n=`${t.enableExtensions.map(d=>`enable ${d};`).join(`
`)}

${n}`),{code:n,usedBindGroupLayouts:s,catchall:p,logResources:r.logResources}}function ag(e,t,r){let n=t.map(i=>`${i.value}: ${e.resolve(i.dataType).value}`).join(", ");return r.type!=="void"?`(${n}) -> ${Es(r)}${e.resolve(r).value} `:`(${n}) `}function al(e){let t=e;return t?.resourceType==="compute-pipeline"&&!!t[h]}function ol(e){let t=e;return t?.resourceType==="render-pipeline"&&!!t[h]}function og(e){return ol(e)||al(e)}function Qi(e,t){return Array.isArray(e)?hg(e,t):lg(e)}function ug(e,t){return Array.isArray(e)?Qi(e,t).code:Qi(e).code}function lg(e){let{template:t,externals:r,shaderGenerator:n,names:i="strict",config:s,enableExtensions:a}=e;t||console.warn("Calling resolve with an empty template is deprecated and will soon return an empty string. Consider using the 'tgpu.resolve(resolvableArray, options)' API instead.");let o={};Pr(o,r??{});let u={[h]:!0,[z](l){return m(pn(l,o,t??""),re,"runtime")},toString:()=>"<root>"};return vi(u,{namespace:typeof i=="string"?Lr({names:i}):i,enableExtensions:a,shaderGenerator:n,config:s,root:ul(Object.values(r))})}function hg(e,t){let{shaderGenerator:r,names:n="strict",config:i,enableExtensions:s}=t??{},a={[h]:!0,[z](o){return e.forEach(u=>o.resolve(u)),m("",re,"runtime")},toString:()=>"<root>"};return vi(a,{namespace:typeof n=="string"?Lr({names:n}):n,enableExtensions:s,shaderGenerator:r,config:i,root:ul(e)})}function ul(e){let t=e.filter(og);if(t.length>1)throw new Error(`Found ${t.length} pipelines but can only resolve one at a time.`);return t[0]?.[h].branch}function cg(e){let t=Ue()??new sl({namespace:Lr(),shaderGenerator:nl}),r=[1,1,1],n=[1,1,1],i=[r[0]*n[0],r[1]*n[1],r[2]*n[2]],s=new Map,a=Array.from({length:r[0]},()=>Array.from({length:r[1]},()=>Array.from({length:r[2]},()=>new Map))),o=Array.from({length:i[0]},()=>Array.from({length:i[1]},()=>Array.from({length:i[2]},()=>new Map))),u=Array.from({length:i[0]},(l,p)=>Array.from({length:i[1]},(d,y)=>Array.from({length:i[2]},($,T)=>{let G=Math.floor(p/n[0]),Y=Math.floor(y/n[1]),D=Math.floor(T/n[2]);return new rh(s,{private:o[p][y][T],workgroup:a[G][Y][D]})})));t.pushMode(u[0][0][0]);try{return{value:ao(t,e),buffers:s,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function pg(e,t,r,n){return new fg(e,t,r,n)}function Gs(e){let t=e;return t?.resourceType==="query-set"&&!!t[h]}var fg=class{constructor(e,t,r,n){this.type=t,this.count=r,this.rawQuerySet=n,this.#e=e.device,this._ownQuerySet=!n,this._querySet=n||null}resourceType="query-set";#e;_querySet=null;_ownQuerySet;_destroyed=!1;_available=!0;_readBuffer=null;_resolveBuffer=null;get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(this.#e.createQuerySet({type:this.type,count:this.count}),"_querySet"),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[h](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"_readBuffer")),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=(globalThis.__TYPEGPU_AUTONAME__??(t=>t))(e.#e.createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),"_resolveBuffer")),e._resolveBuffer}}}$name(e){return F(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=this.#e.createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[h].resolveBuffer,0),this.#e.queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=this.#e.createCommandEncoder();e.copyBufferToBuffer(this[h].resolveBuffer,0,this[h].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),this.#e.queue.submit([e.finish()]);let t=this[h].readBuffer;await t.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(r)}finally{this._available=!0}}destroy(){this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),this._readBuffer?.destroy(),this._resolveBuffer?.destroy(),this._readBuffer=this._resolveBuffer=null)}},Sa=class{constructor(e){this._make=e}_map=new WeakMap;getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...t);return this._map.set(e,r),r}},Ii=class{constructor(e,t){this.resourceType=e,this.buffer=t,this[se]=t,this.#e=this.buffer.as(this.resourceType)}[h]=!0;[se];#e;$name(e){return F(this[se],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[A](){return this.#e.$}get $(){return this.#e.$}get value(){return this.$}[z](e){return e.resolve(this.#e)}},E=e=>gu(e??0),Ze=e=>wu(e??0),Tr=e=>xu(e??0),dg={f32:e=>E(e[0]),f16:e=>Tr(e[0]).x,i32:e=>Ze(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>_(E(e[0]),E(e[1])),vec3f:e=>oe(E(e[0]),E(e[1]),E(e[2])),vec4f:e=>I(E(e[0]),E(e[1]),E(e[2]),E(e[3])),vec2h(e){let t=Tr(e[0]);return ut(t.x,t.y)},vec3h(e){let t=Tr(e[0]),r=Tr(e[1]);return lt(t.x,t.y,r.x)},vec4h(e){let t=Tr(e[0]),r=Tr(e[1]);return ht(t.x,t.y,r.x,r.y)},vec2i:e=>me(Ze(e[0]),Ze(e[1])),vec3i:e=>Pe(Ze(e[0]),Ze(e[1]),Ze(e[2])),vec4i:e=>he(Ze(e[0]),Ze(e[1]),Ze(e[2]),Ze(e[3])),vec2u:e=>_e(e[0]??0,e[1]??0),vec3u:e=>ne(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>ye(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>er(!!e[0],!!e[1]),"vec3<bool>":e=>tr(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>rr(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>_t(E(e[0]),E(e[1]),E(e[2]),E(e[3])),mat3x3f:e=>zt(E(e[0]),E(e[1]),E(e[2]),E(e[4]),E(e[5]),E(e[6]),E(e[8]),E(e[9]),E(e[10])),mat4x4f:e=>W(E(e[0]),E(e[1]),E(e[2]),E(e[3]),E(e[4]),E(e[5]),E(e[6]),E(e[7]),E(e[8]),E(e[9]),E(e[10]),E(e[11]),E(e[12]),E(e[13]),E(e[14]),E(e[15]))};function mg(e,t){let r=dg[t.type];if(r)return r(e);if(pe(t)){let n=Object.keys(t.propTypes),i=Object.values(t.propTypes),s=Hi(e,i);return Object.fromEntries(n.map((a,o)=>[a,s[o]]))}if($e(t)){let n=t.elementType,i=t.elementCount;return Hi(e,Array.from({length:i},()=>n))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Hi(e,t){let r=0;return t.map(n=>{if(!jt(n))return n;let i=Math.ceil(P(n)/4),s=mg(e.subarray(r,r+i),n);return r+=i,s})}function yg(e,t){return Hi(e,t).map(Gi)}function Zi(e){let{indexBuffer:t,dataBuffer:r,logIdToMeta:n,options:i}=e;r.read().then(s=>{s.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:u,op:l}=n.get(a),p=yg(new Uint32Array(o),u);p.length===0&&p.push(""),console[l](`%c${i.messagePrefix}%c ${p[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...p.slice(1))})}),t.read().then(s=>{s>i.logCountLimit&&console.warn(`Log count limit per dispatch (${i.logCountLimit}) exceeded by ${s-i.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),r.buffer.clear(),t.buffer.clear()}function ll(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:(globalThis.__TYPEGPU_AUTONAME__??(n=>n))(r.createQuerySet("timestamp",2),"querySet"),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function hl(e,t,r){if(!r.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let n={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(n.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(n.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:n}}function cl(e,t){if(!e.timestampWrites)return{};let{querySet:r,beginningOfPassWriteIndex:n,endOfPassWriteIndex:i}=e.timestampWrites,s={querySet:Gs(r)?t.unwrap(r):r};return n!==void 0&&(s.beginningOfPassWriteIndex=n),i!==void 0&&(s.endOfPassWriteIndex=i),{timestampWrites:s}}function Ji({root:e,priors:t}){let r=t.timestampWrites?.querySet,n=t.performanceCallback;if(!r)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!Gs(r))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let i=e.device.createCommandEncoder();i.resolveQuerySet(e.unwrap(r),0,r.count,r[h].resolveBuffer,0),e.device.queue.submit([i.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{if(!r.available)return;let s=await r.read(),a=s[t.timestampWrites?.beginningOfPassWriteIndex??0],o=s[t.timestampWrites?.endOfPassWriteIndex??1];if(a===void 0||o===void 0)throw new Error("QuerySet did not return valid timestamps.");await n(a,o)})}function gg(e,t,r){return new wg(new xg(e,t,r),{})}var wg=class Yr{constructor(t,r){this._core=t,this._priors=r,this[h]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return r},get branch(){return t.branch}},this[se]=t}[h];resourceType="compute-pipeline";[se];[z](t){return t.resolve(this._core)}toString(){return`computePipeline:${w(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,r){return Hn(t)?new Yr(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new Yr(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,r]])})}withPerformanceCallback(t){let r=ll(this._priors,t,this._core.branch);return new Yr(this._core,r)}withTimestampWrites(t){let r=hl(this._priors,t,this._core.branch);return new Yr(this._core,r)}dispatchWorkgroups(t,r,n){let i=this._core.unwrap(),{branch:s}=this._core,a={label:w(this._core)??"<unnamed>",...cl(this._priors,s)},o=s.device.createCommandEncoder(),u=o.beginComputePass(a);u.setPipeline(i.pipeline);let l=new Set(i.usedBindGroupLayouts);if(i.usedBindGroupLayouts.forEach((p,d)=>{if(i.catchall&&d===i.catchall[0])u.setBindGroup(d,s.unwrap(i.catchall[1])),l.delete(p);else{let y=this._priors.bindGroupLayoutMap?.get(p);y!==void 0&&(l.delete(p),u.setBindGroup(d,s.unwrap(y)))}}),l.size>0)throw new as(l);u.dispatchWorkgroups(t,r,n),u.end(),s.device.queue.submit([o.finish()]),i.logResources&&Zi(i.logResources),this._priors.performanceCallback&&Ji({root:s,priors:this._priors})}$name(t){return F(this._core,t),this}},xg=class{constructor(e,t,r){this.branch=e,this._slotBindings=t,this._entryFn=r}[h]=!0;_memo;[z](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),m("",re,"runtime")))}toString(){return"computePipelineCore"}unwrap(){if(this._memo===void 0){let e=this.branch.device,t=Cs.filter(l=>this.branch.enabledFeatures.has(bu[l])),r,n=Lr({names:this.branch.nameRegistrySetting});r=vi(this,{namespace:n,enableExtensions:t,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:s,catchall:a,logResources:o}=r;a!==void 0&&s[a[0]]?.$name(`${w(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let u=e.createShaderModule({label:`${w(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:e.createComputePipeline({label:w(this)??"<unnamed>",layout:e.createPipelineLayout({label:`${w(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:s.map(l=>this.branch.unwrap(l))}),compute:{module:u}}),usedBindGroupLayouts:s,catchall:a,logResources:o}}return this._memo}};function Ea(e,t="vertex"){return new vg(e,t)}function pl(e){return e?.resourceType==="vertex-layout"}var Ki=Symbol("defaultAttribEntry");function On(e,t,r,n,i){if(We(t)||Xe(t)){let s=Ct(t);return s!==void 0&&(n[i??Ki]=s),On(e,t.inner,Ve(r,Ge(t)),n)}if(pe(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Ve(s,J(u));let l=[o,On(e,u,s,n,o)];return s+=P(u),l}))}if(Ye(t)){let s=r,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,u])=>{s=Ve(s,Ge(u));let l=[o,On(e,u,s,n,o)];return s+=P(u),l}))}if("type"in t&&typeof t.type=="string"){if(Da.includes(t.type))return{_layout:e,format:t.type,offset:r};let s=Ll[t.type];if(s)return{_layout:e,format:s,offset:r}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var vg=class{constructor(e,t){this.schemaForCount=e,this.stepMode=t;let r=e(0);this.stride=Ve(P(r.elementType),J(r)),this.attrib=On(this,r.elementType,0,this._customLocationMap)}[h]=!0;resourceType="vertex-layout";stride;attrib;_customLocationMap={};get vertexLayout(){if(this._customLocationMap[Ki]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[Ki]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return F(this,e),this}};function $g(e){return typeof e?.loadOp=="string"}function bg(e,t){if(Br(e)){if(bt(e))return[];if(!$g(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(bt(i))continue;let s=t[n];if(!s)throw new Error(`A color attachment by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function Tg(e){return typeof e?.format=="string"}function _g(e,t){if(Br(e)){if(Ra(e))return[];if(e.type==="decorated")return[];if(!Tg(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let r=[];for(let n of Object.keys(e)){let i=e[n];if(bt(i))continue;let s=t[n];if(!s)throw new Error(`A color target by the name of '${n}' was not provided to the shader.`);r.push(s)}return r}function fl(e){return new zg(new Ig(e),{})}var zg=class Re{[h];resourceType="render-pipeline";[se];hasIndexBuffer=!1;constructor(t,r){this[h]={core:t,priors:r,branch:t.options.branch},this[se]=t}[z](t){return t.resolve(this[h].core)}toString(){return`renderPipeline:${w(this)??"<unnamed>"}`}$name(t){return F(this[h].core,t),this}with(t,r){let n=this[h];if(Hn(t))return new Re(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(Du(t))return new Re(n.core,{...n.priors,bindGroupLayoutMap:new Map([...n.priors.bindGroupLayoutMap??[],[t,r]])});if(pl(t))return new Re(n.core,{...n.priors,vertexLayoutMap:new Map([...n.priors.vertexLayoutMap??[],[t,r]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let r=this[h],n=ll(r.priors,t,r.core.options.branch);return new Re(r.core,n)}withTimestampWrites(t){let r=this[h],n=hl(r.priors,t,r.core.options.branch);return new Re(r.core,n)}withColorAttachment(t){let r=this[h];return new Re(r.core,{...r.priors,colorAttachment:t})}withDepthStencilAttachment(t){let r=this[h];return new Re(r.core,{...r.priors,depthStencilAttachment:t})}withStencilReference(t){let r=this[h];return new Re(r.core,{...r.priors,stencilReference:t})}withIndexBuffer(t,r,n,i){let s=this[h];if(Fi(t)){if(typeof r!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new Re(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:r,offsetBytes:n,sizeBytes:i}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new Re(s.core,{...s.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:r!==void 0?r*P(o):void 0,sizeBytes:i!==void 0?i*P(o):void 0}})}setupRenderPass(t){let r=this[h],n=r.core.unwrap(),{branch:i,fragmentFn:s}=r.core.options,a=s?bg(s.shell.out,r.priors.colorAttachment??{}).map(y=>nn(y.view)?{...y,view:i.unwrap(y.view).createView()}:sn(y.view)?{...y,view:i.unwrap(y.view)}:y):[null],o={label:w(r.core)??"<unnamed>",colorAttachments:a,...cl(r.priors,i)},u=r.priors.depthStencilAttachment;if(u!==void 0){let y=nn(u.view)?i.unwrap(u.view).createView():sn(u.view)?i.unwrap(u.view):u.view;o.depthStencilAttachment={...u,view:y}}let l=t.beginRenderPass(o);l.setPipeline(n.pipeline),r.priors.stencilReference!==void 0&&l.setStencilReference(r.priors.stencilReference);let p=new Set(n.usedBindGroupLayouts);n.usedBindGroupLayouts.forEach((y,$)=>{if(n.catchall&&$===n.catchall[0])l.setBindGroup($,i.unwrap(n.catchall[1])),p.delete(y);else{let T=r.priors.bindGroupLayoutMap?.get(y);T!==void 0&&(p.delete(y),l.setBindGroup($,i.unwrap(T)))}});let d=new Set(r.core.usedVertexLayouts);if(r.core.usedVertexLayouts.forEach((y,$)=>{let T=r.priors.vertexLayoutMap?.get(y);T&&(d.delete(y),l.setVertexBuffer($,i.unwrap(T)))}),p.size>0)throw new as(p);if(d.size>0)throw new Za(d);return l}draw(t,r,n,i){let s=this[h],{branch:a}=s.core.options,{logResources:o}=s.core.unwrap(),u=a.device.createCommandEncoder(),l=this.setupRenderPass(u);l.draw(t,r,n,i),l.end(),a.device.queue.submit([u.finish()]),o&&Zi(o),s.priors.performanceCallback&&Ji({root:a,priors:s.priors})}drawIndexed(t,r,n,i,s){let a=this[h];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:u}=a.core.options,{buffer:l,indexFormat:p,offsetBytes:d,sizeBytes:y}=a.priors.indexBuffer,$=u.device.createCommandEncoder(),T=this.setupRenderPass($);Fi(l)?T.setIndexBuffer(l,p,d,y):T.setIndexBuffer(u.unwrap(l),p,d,y),T.drawIndexed(t,r,n,i,s),T.end(),u.device.queue.submit([$.finish()]),o&&Zi(o),a.priors.performanceCallback&&Ji({root:u,priors:a.priors})}},Ig=class{constructor(e){this.options=e;let t=ry(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?_g(e.fragmentFn.shell.out,e.targets):[null]}[h]=!0;usedVertexLayouts;_memo;_vertexBufferLayouts;_targets;[z](e){let{vertexFn:t,fragmentFn:r,slotBindings:n}=this.options,i=Sg(t.shell.out,r?.shell.in,w(t)??"<unnamed>",w(r)??"<unnamed>");return e.withVaryingLocations(i,()=>e.withSlots(n,()=>(e.resolve(t),r&&e.resolve(r),m("",re,"runtime"))))}toString(){return"renderPipelineCore"}unwrap(){if(this._memo===void 0){let{branch:e,primitiveState:t,depthStencilState:r,multisampleState:n}=this.options,i=e.device,s=Cs.filter(G=>e.enabledFeatures.has(bu[G])),a,o=Lr({names:e.nameRegistrySetting});a=vi(this,{namespace:o,enableExtensions:s,shaderGenerator:e.shaderGenerator,root:e});let{code:u,usedBindGroupLayouts:l,catchall:p,logResources:d}=a;p!==void 0&&l[p[0]]?.$name(`${w(this)??"<unnamed>"} - Automatic Bind Group & Layout`);let y=i.createShaderModule({label:`${w(this)??"<unnamed>"} - Shader`,code:u}),$={layout:i.createPipelineLayout({label:`${w(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:l.map(G=>e.unwrap(G))}),vertex:{module:y,buffers:this._vertexBufferLayouts}},T=w(this);T!==void 0&&($.label=T),this.options.fragmentFn&&($.fragment={module:y,targets:this._targets}),t&&(jt(t.stripIndexFormat)?$.primitive={...t,stripIndexFormat:{u32:"uint32",u16:"uint16"}[t.stripIndexFormat.type]}:$.primitive=t),r&&($.depthStencil=r),n&&($.multisample=n),this._memo={pipeline:i.createRenderPipeline($),usedBindGroupLayouts:l,catchall:p,logResources:d}}return this._memo}};function Sg(e,t,r,n){let i={},s=new Set;function a(u,l){i[u]=l,s.add(l)}for(let[u,l]of Object.entries(e)){let p=Ct(l);p!==void 0&&a(u,p)}for(let[u,l]of Object.entries(t??{})){let p=Ct(l);p!==void 0&&(i[u]===void 0?a(u,p):i[u]!==p&&console.warn(`Mismatched location between vertexFn (${r}) output (${i[u]}) and fragmentFn (${n}) input (${p}) for the key "${u}", using the location set on vertex output.`))}let o=0;for(let u of Object.keys(e??{}))if(!(bt(e[u])||i[u]!==void 0)){for(;s.has(o);)o++;a(u,o)}return i}function Eg(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return ne(e[0]??1,e[1]??1,e[2]??1)}var Mg=[ne(1,1,1),ne(256,1,1),ne(16,16,1),ne(8,8,4)],Vg=class dl{#e;#t;#r;#n;#i;constructor(t,r,n,i){this.#e=t,this.#t=r,this.#r=n,this.#n=i,this.#i=ne()}with(t){return new dl(this.#e,this.#t.with(t),this.#r,this.#n)}dispatchThreads(...t){let r=Eg(t),n=fu(oe(r).div(oe(this.#n)));vu(r,this.#i)||(this.#i=r,this.#r.write(r)),this.#t.dispatchWorkgroups(n.x,n.y,n.z)}get pipeline(){return this.#t}get sizeUniform(){return this.#r}},Ug=class es{constructor(t,r){this._getRoot=t,this._slotBindings=r}with(t,r){return new es(this._getRoot,[...this._slotBindings,[ni(t)?t.slot:t,r]])}withCompute(t){return new Pg(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let r=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let n=Mg[t.length],i=O([x,x,x])(t),s=(globalThis.__TYPEGPU_AUTONAME__??(u=>u))(r.createUniform(ne),"a"),a=_u({workgroupSize:n,in:{id:Vo.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:s,wrappedCallback:i}),o=(globalThis.__TYPEGPU_AUTONAME__??(u=>u))(this.withCompute(a).createPipeline(),"s");return new Vg(r,o,s,n)}withVertex(t,r){return new kg({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:r??{},multisampleState:void 0})}pipe(t){let r=t(new Uu([]));return new es(this._getRoot,[...this._slotBindings,...r.bindings])}},Pg=class{constructor(e,t,r){this._root=e,this._slotBindings=t,this._entryFn=r}createPipeline(){return gg(this._root,this._slotBindings,this._entryFn)}},kg=class An{constructor(t){this._options=t}withFragment(t,r,n){return st(typeof t!="string"),st(r===void 0||typeof r!="string"),new Og({...this._options,fragmentFn:t,targets:r??{}})}withPrimitive(t){return new An({...this._options,primitiveState:t})}withDepthStencil(t){return new An({...this._options,depthStencilState:t})}withMultisample(t){return new An({...this._options,multisampleState:t})}createPipeline(){return fl({...this._options,fragmentFn:null,targets:null})}},Og=class Bn{constructor(t){this._options=t}withPrimitive(t){return new Bn({...this._options,primitiveState:t})}withDepthStencil(t){return new Bn({...this._options,depthStencilState:t})}withMultisample(t){return new Bn({...this._options,multisampleState:t})}createPipeline(){return fl(this._options)}},ml=class extends Ug{constructor(t,r,n,i,s){super(()=>this,[]),this.device=t,this.nameRegistrySetting=r,this._ownDevice=n,this.shaderGenerator=s,this["~unstable"]=this,this[h]={logOptions:i}}"~unstable";_unwrappedBindGroupLayouts=new Sa(t=>t.unwrap(this));_unwrappedBindGroups=new Sa(t=>t.unwrap(this));[h];get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,r){return Mn(this,t,r)}createUniform(t,r){let n=Mn(this,t,r).$usage("uniform");return new Ii("uniform",n)}createMutable(t,r){let n=Mn(this,t,r).$usage("storage");return new Ii("mutable",n)}createReadonly(t,r){let n=Mn(this,t,r).$usage("storage");return new Ii("readonly",n)}createQuerySet(t,r,n){return pg(this,t,r,n)}createBindGroup(t,r){return new Wu(t,r)}destroy(){Vy(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return Oy(t,this)}createSampler(t){return $y(t,this)}createComparisonSampler(t){return by(t,this)}unwrap(t){if(al(t))return t[h].rawPipeline;if(ol(t))return t[h].core.unwrap().pipeline;if(Du(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(Hn(t))return this._unwrappedBindGroups.getOrMake(t);if(tn(t))return t.buffer;if(nn(t))return t[h].unwrap();if(sn(t)){if(!t[h].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[h].unwrap()}if(pl(t))return t.vertexLayout;if(Bu(t)||Cu(t)){if(t[h].unwrap)return t[h].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(Gs(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,r){let n=this.device.createCommandEncoder(),i=n.beginRenderPass(t),s=new Map,a=new Map,o,u=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:l,priors:p}=o[h],d=l.unwrap();i.setPipeline(d.pipeline);let y=new Set(d.usedBindGroupLayouts);d.usedBindGroupLayouts.forEach((T,G)=>{if(d.catchall&&G===d.catchall[0])i.setBindGroup(G,this.unwrap(d.catchall[1])),y.delete(T);else{let Y=p.bindGroupLayoutMap?.get(T)??s.get(T);Y!==void 0&&(y.delete(T),Hn(Y)?i.setBindGroup(G,this.unwrap(Y)):i.setBindGroup(G,Y))}});let $=new Set;if(l.usedVertexLayouts.forEach((T,G)=>{let Y=p.vertexLayoutMap?.get(T),D=Y?{buffer:Y,offset:void 0,size:void 0}:a.get(T);!D||!D.buffer?$.add(T):tn(D.buffer)?i.setVertexBuffer(G,this.unwrap(D.buffer),D.offset,D.size):i.setVertexBuffer(G,D.buffer,D.offset,D.size)}),y.size>0)throw new as(y);if($.size>0)throw new Za($)};r({setViewport(...l){i.setViewport(...l)},setScissorRect(...l){i.setScissorRect(...l)},setBlendConstant(...l){i.setBlendConstant(...l)},setStencilReference(...l){i.setStencilReference(...l)},beginOcclusionQuery(...l){i.beginOcclusionQuery(...l)},endOcclusionQuery(...l){i.endOcclusionQuery(...l)},executeBundles(...l){i.executeBundles(...l)},setPipeline(l){o=l},setIndexBuffer:(l,p,d,y)=>{tn(l)?i.setIndexBuffer(this.unwrap(l),p,d,y):i.setIndexBuffer(l,p,d,y)},setVertexBuffer(l,p,d,y){a.set(l,{buffer:p,offset:d,size:y})},setBindGroup(l,p){s.set(l,p)},draw(l,p,d,y){u(),i.draw(l,p,d,y)},drawIndexed(...l){u(),i.drawIndexed(...l)},drawIndirect(...l){u(),i.drawIndirect(...l)},drawIndexedIndirect(...l){u(),i.drawIndexedIndirect(...l)}}),i.end(),this.device.queue.submit([n.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function Ag(e){let{adapter:t,device:r,unstable_names:n="strict",unstable_logOptions:i}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let s=await navigator.gpu.requestAdapter(t);if(!s)throw new Error("Could not find a compatible GPU");let a=[];for(let u of r?.requiredFeatures??[]){if(!s.features.has(u))throw new Error(`Requested feature "${u}" is not supported by the adapter.`);a.push(u)}for(let u of r?.optionalFeatures??[])s.features.has(u)?a.push(u):console.warn(`Optional feature "${u}" is not supported by the adapter.`);let o=await s.requestDevice({...r,requiredFeatures:a});return new ml(o,n,!0,i??{},e?.shaderGenerator)}function Bg(e){let{device:t,unstable_names:r="strict",unstable_logOptions:n}=e??{};return new ml(t,r,!1,n??{},e?.shaderGenerator)}function Cg(e,t){return new Fg(e,t)}var Fg=class{constructor(e,t=void 0){this.schema=e,this.defaultValue=t,this.slot=Zn(t),this[se]=this.slot}[h]=!0;[se];resourceType="accessor";slot;get[A](){return new Proxy({[h]:!0,[ze]:this.#e(),[z]:e=>e.resolve(this),toString:()=>`accessor:${w(this)??"<unnamed>"}.$`},je)}#e(){let e=Ue(),t=wi(e.unwrap(this.slot));if(zu(t))return t[h].gpuImpl();let r=ii(t);if(r)return r;e.pushMode(new on);try{let n=Gt(this.schema,t);return m(n,this.schema,"constant")}finally{e.popMode("normal")}}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${w(this)??"<unnamed>"}`}get value(){if(He())return this[A];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[z](e){let t=this.#e();return m(e.resolve(t.value,t.dataType).value,t.dataType,t.origin)}};function Gg(e){return jg(e)}function Lg([e,t]){return`${w(e)??"<unnamed>"}=${t}`}function jg(e){if(Ue())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[h]:!0,resourceType:"derived","~compute":e,get[A](){let t=Ue();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return wi(t.unwrap(this))},get value(){return this[A]},get $(){return this.value},with(t,r){return yl(this,[[t,r]])},toString(){return"derived"}}}function yl(e,t){return{[h]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[Xt]:{inner:e,pairs:t},get[A](){let r=Ue();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return wi(r.unwrap(this))},get value(){return this[A]},get $(){return this.value},with(r,n){return yl(e,[...t,[r,n]])},toString(){return`derived[${t.map(Lg).join(", ")}]`}}}var Rg={fn:O,bindGroupLayout:Nu,vertexLayout:Ea,slot:Zn,init:Ag,initFromDevice:Bg,resolve:ug,resolveWithContext:Qi,privateVar:Jn,workgroupVar:Ta,const:Di,"~unstable":{fn:O,fragmentFn:Ym,vertexFn:Cc,computeFn:_u,comptime:Ft,vertexLayout:Ea,namespace:Lr,derived:Gg,slot:Zn,accessor:Cg,privateVar:Jn,workgroupVar:Ta,const:Di,declare:Lm,rawCodeSnippet:qm,simulate:cg}},Ma=Rg,Ng=Ft(((e,t)=>t===void 0?r=>Va(e,r):Va(e,t))).$name("disarrayOf");function Va(e,t){let r=n=>{if(n&&n.length!==t)throw new Error(`Disarray schema of ${t} elements of type ${e.type} called with ${n.length} argument(s).`);return Array.from({length:t},(i,s)=>Gt(e,n?.[s]))};if(Object.setPrototypeOf(r,Dg),r.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create disarray schema with invalid element count: ${t}.`);return r.elementCount=t,r}var Dg={[h]:!0,type:"disarray",toString(){return`disarrayOf(${this.elementType}, ${this.elementCount})`}};function qg(e){let t=r=>Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Gt(i,r?.[n])]));return Object.setPrototypeOf(t,Wg),t.propTypes=e,t}var Wg={[h]:!0,type:"unstruct",$name(e){return F(this,e),this},toString(){return`unstruct:${w(this)??"<unnamed>"}`}};function zr(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(pe(e)&&pe(t)||Ye(e)&&Ye(t)){let r=e.propTypes,n=t.propTypes,i=Object.keys(r),s=Object.keys(n);if(i.length!==s.length)return!1;for(let a=0;a<i.length;a++){let o=i[a],u=s[a];if(o!==u||!o||!u||!zr(r[o],n[u]))return!1}return!0}if($e(e)&&$e(t)||vt(e)&&vt(t))return e.elementCount===t.elementCount&&zr(e.elementType,t.elementType);if(qe(e)&&qe(t))return e.addressSpace===t.addressSpace&&e.access===t.access&&zr(e.inner,t.inner);if(jn(e)&&jn(t))return zr(e.inner,t.inner);if(We(e)&&We(t)||Xe(e)&&Xe(t)){if(!zr(e.inner,t.inner)||e.attribs.length!==t.attribs.length)return!1;let r=s=>{let a=s;return`${a.type}(${(a.params??[]).join(",")})`},n=e.attribs.map(r),i=t.attribs.map(r);for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1}return!0}function sr(e,t){let r=e.prototype,n=Ri[t][h].jsImpl;r[t]=function(i){return n(this,i)}}sr(Kt,"add");sr(Kt,"sub");sr(Kt,"mul");sr(Kt,"div");sr(Fr,"add");sr(Fr,"sub");sr(Fr,"mul");const Yg=Object.freeze(Object.defineProperty({__proto__:null,Void:re,align:xc,alignmentOf:fc,arrayOf:Qt,atomic:Ko,bool:C,builtin:Vo,comparisonSampler:Ps,deepEqual:zr,disarrayOf:Ng,f16:ae,f32:v,float16:Wh,float16x2:Yh,float16x4:Xh,float32:Qh,float32x2:Hh,float32x3:Zh,float32x4:Jh,formatToWGSLType:$t,i32:j,interpolate:$c,invariant:bc,isAlignAttrib:rs,isAtomic:jn,isBuiltin:bt,isBuiltinAttrib:is,isData:Br,isDecorated:We,isDisarray:vt,isInterpolateAttrib:Bl,isLocationAttrib:ja,isLooseData:Ar,isLooseDecorated:Xe,isPackedData:So,isPtr:qe,isSizeAttrib:ns,isUnstruct:Ye,isWgslArray:$e,isWgslData:jt,isWgslStruct:pe,location:Yn,mat2x2f:_t,mat3x3f:zt,mat4x4f:W,matToArray:Wc,packedFormats:Ss,ptrFn:us,ptrHandle:Jl,ptrPrivate:Xl,ptrStorage:Hl,ptrUniform:Zl,ptrWorkgroup:Ql,ref:sh,sampler:Us,sint16:Ch,sint16x2:Fh,sint16x4:Gh,sint32:nc,sint32x2:ic,sint32x3:sc,sint32x4:ac,sint8:zh,sint8x2:Ih,sint8x4:Sh,size:vc,sizeOf:wc,snorm16:Nh,snorm16x2:Dh,snorm16x4:qh,snorm8:Uh,snorm8x2:Ph,snorm8x4:kh,struct:ai,texture1d:Lo,texture2d:jo,texture2dArray:No,texture3d:Wo,textureCube:Do,textureCubeArray:qo,textureDepth2d:ap,textureDepth2dArray:up,textureDepthCube:lp,textureDepthCubeArray:hp,textureDepthMultisampled2d:op,textureExternal:Zo,textureMultisampled2d:Ro,textureStorage1d:Yo,textureStorage2d:Xo,textureStorage2dArray:Qo,textureStorage3d:Ho,u16:fh,u32:x,uint16:Oh,uint16x2:Ah,uint16x4:Bh,uint32:Kh,uint32x2:ec,uint32x3:tc,uint32x4:rc,uint8:bh,uint8x2:Th,uint8x4:_h,unorm10_10_10_2:oc,unorm16:Lh,unorm16x2:jh,unorm16x4:Rh,unorm8:Eh,unorm8x2:Mh,unorm8x4:Vh,unorm8x4_bgra:uc,unstruct:qg,vec2b:er,vec2f:_,vec2h:ut,vec2i:me,vec2u:_e,vec3b:tr,vec3f:oe,vec3h:lt,vec3i:Pe,vec3u:ne,vec4b:rr,vec4f:I,vec4h:ht,vec4i:he,vec4u:ye},Symbol.toStringTag,{value:"Module"}));var Xg=f({name:"discard",normalImpl:"`discard` relies on GPU resources and cannot be executed outside of a draw call",signature:{argTypes:[],returnType:re},codegenImpl:()=>"discard;"}),wn=Ht[h].jsImpl,Qg=ui[h].jsImpl,Hg=ui[h].gpuImpl,Zg=li[h].jsImpl,Jg=li[h].gpuImpl,Kg=hi[h].jsImpl,ew=hi[h].gpuImpl,tw=ci[h].jsImpl,rw=ci[h].gpuImpl,nw=pi[h].jsImpl,iw=pi[h].gpuImpl,sw=f({name:"translate4",normalImpl:(e,t)=>wn(Qg(t),e),signature:{argTypes:[W,oe],returnType:W},codegenImpl:(e,t)=>c`(${Hg(t)} * ${e})`}),aw=f({name:"scale4",normalImpl:(e,t)=>wn(Zg(t),e),signature:{argTypes:[W,oe],returnType:W},codegenImpl:(e,t)=>c`(${Jg(t)} * ${e})`}),Ls={argTypes:[W,v],returnType:W},ow=f({name:"rotateX4",normalImpl:(e,t)=>wn(Kg(t),e),signature:Ls,codegenImpl:(e,t)=>c`(${ew(t)} * ${e})`}),uw=f({name:"rotateY4",normalImpl:(e,t)=>wn(tw(t),e),signature:Ls,codegenImpl:(e,t)=>c`(${rw(t)} * ${e})`}),lw=f({name:"rotateZ4",normalImpl:(e,t)=>wn(nw(t),e),signature:Ls,codegenImpl:(e,t)=>c`(${iw(t)} * ${e})`}),hw=f({name:"workgroupBarrier",normalImpl:"workgroupBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:re},codegenImpl:()=>"workgroupBarrier()"}),cw=f({name:"storageBarrier",normalImpl:"storageBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:re},codegenImpl:()=>"storageBarrier()"}),pw=f({name:"textureBarrier",normalImpl:"textureBarrier is a no-op outside of CODEGEN mode.",signature:{argTypes:[],returnType:re},codegenImpl:()=>"textureBarrier()"}),St="Atomic operations are not supported outside of CODEGEN mode.",fw=f({name:"atomicLoad",normalImpl:St,signature:e=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Lt(e)}`);return{argTypes:[e],returnType:e.inner}},codegenImpl:e=>c`atomicLoad(&${e})`}),dw=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Lt(e)}`);return{argTypes:[e,e.inner.type==="u32"?x:j],returnType:re}},ar=(e,t)=>{if(e.type!=="atomic")throw new Error(`Invalid atomic type: ${Lt(e)}`);let r=e.inner.type==="u32"?x:j;return{argTypes:[e,r],returnType:r}},mw=f({name:"atomicStore",normalImpl:St,signature:dw,codegenImpl:(e,t)=>c`atomicStore(&${e}, ${t})`}),yw=f({name:"atomicAdd",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicAdd(&${e}, ${t})`}),gw=f({name:"atomicSub",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicSub(&${e}, ${t})`}),ww=f({name:"atomicMax",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicMax(&${e}, ${t})`}),xw=f({name:"atomicMin",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicMin(&${e}, ${t})`}),vw=f({name:"atomicAnd",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicAnd(&${e}, ${t})`}),$w=f({name:"atomicOr",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicOr(&${e}, ${t})`}),bw=f({name:"atomicXor",normalImpl:St,signature:ar,codegenImpl:(e,t)=>c`atomicXor(&${e}, ${t})`}),Et="Derivative builtins are not allowed on the CPU",Tw=f({name:"dpdx",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdx(${e})`}),_w=f({name:"dpdxCoarse",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxCoarse(${e})`}),zw=f({name:"dpdxFine",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdxFine(${e})`}),Iw=f({name:"dpdy",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdy(${e})`}),Sw=f({name:"dpdyCoarse",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyCoarse(${e})`}),Ew=f({name:"dpdyFine",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`dpdyFine(${e})`}),Mw=f({name:"fwidth",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidth(${e})`}),Vw=f({name:"fwidthCoarse",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthCoarse(${e})`}),Uw=f({name:"fwidthFine",normalImpl:Et,signature:e=>({argTypes:[e],returnType:e}),codegenImpl:e=>c`fwidthFine(${e})`}),Ua=e=>qe(e)&&$e(e.inner)?e.inner.elementCount:0,Pw=f({name:"arrayLength",signature:e=>{let t=qe(e)?e:us(e);return{argTypes:[t],returnType:Ua(t)>0?un:x}},normalImpl:e=>uo(e)?e.$.length:e.length,codegenImpl(e){let t=Ua(e.dataType);return t>0?String(t):c`arrayLength(${e})`}});function kw(e,t,r,n,i){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Ow=f({name:"textureSample",normalImpl:kw,codegenImpl:(...e)=>c`textureSample(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?v:I}}});function Aw(e,t,r,n,i,s){throw new Error("Texture sampling with bias relies on GPU resources and cannot be executed outside of a draw call")}var Bw=f({name:"textureSampleBias",normalImpl:Aw,codegenImpl:(...e)=>c`textureSampleBias(${e})`,signature:(...e)=>({argTypes:e,returnType:I})});function Cw(e,t,r,n,i,s){throw new Error("Texture sampling relies on GPU resources and cannot be executed outside of a draw call")}var Fw=f({name:"textureSampleLevel",normalImpl:Cw,codegenImpl:(...e)=>c`textureSampleLevel(${e})`,signature:(...e)=>{let t=e[0].type.startsWith("texture_depth");return{argTypes:e,returnType:t?v:I}}});function Gw(e,t,r){throw new Error("`textureLoad` relies on GPU resources and cannot be executed outside of a draw call")}var Lw=f({name:"textureLoad",normalImpl:Gw,codegenImpl:(...e)=>c`textureLoad(${e})`,signature:(...e)=>{let t=e[0];if(Jo(t)){let i=t.type.startsWith("texture_depth"),s=t.sampleType;return{argTypes:e,returnType:i?v:s.type==="f32"?I:s.type==="u32"?ye:he}}let r=t.format,n=gn(r).vectorType;return{argTypes:e,returnType:n}}});function jw(e,t,r,n){throw new Error("`textureStore` relies on GPU resources and cannot be executed outside of a draw call")}var Rw=f({name:"textureStore",normalImpl:jw,codegenImpl:(...e)=>c`textureStore(${e})`,signature:(...e)=>({argTypes:e,returnType:re})});function Nw(e,t){throw new Error("`textureDimensions` relies on GPU resources and cannot be executed outside of a draw call")}var Dw=f({name:"textureDimensions",normalImpl:Nw,codegenImpl:(...e)=>c`textureDimensions(${e})`,signature:(...e)=>{let t=e[0].dimension;return t==="1d"?{argTypes:e,returnType:x}:t==="3d"?{argTypes:e,returnType:ne}:{argTypes:e,returnType:_e}}});function qw(e,t,r,n,i,s){throw new Error("Texture comparison sampling relies on GPU resources and cannot be executed outside of a draw call")}var Ww=f({name:"textureSampleCompare",normalImpl:qw,codegenImpl:(...e)=>c`textureSampleCompare(${e})`,signature:(...e)=>({argTypes:e,returnType:v})});function Yw(e,t,r){throw new Error("Texture sampling with base clamp to edge is not supported outside of GPU mode.")}var Xw=f({name:"textureSampleBaseClampToEdge",normalImpl:Yw,codegenImpl:(...e)=>c`textureSampleBaseClampToEdge(${e})`,signature:(...e)=>({argTypes:e,returnType:I})}),ue="Subgroup operations can only be used in the GPU context.",Qw=f({name:"subgroupAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupAdd(${e})`}),Hw=f({name:"subgroupExclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupExclusiveAdd(${e})`}),Zw=f({name:"subgroupInclusiveAdd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupInclusiveAdd(${e})`}),Jw=f({name:"subgroupAll",signature:{argTypes:[C],returnType:C},normalImpl:ue,codegenImpl:e=>c`subgroupAll(${e})`}),Kw=f({name:"subgroupAnd",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupAnd(${e})`}),ex=f({name:"subgroupAny",signature:{argTypes:[C],returnType:C},normalImpl:ue,codegenImpl:e=>c`subgroupAny(${e})`}),tx=f({name:"subgroupBallot",signature:{argTypes:[C],returnType:ye},normalImpl:ue,codegenImpl:e=>c`subgroupBallot(${e})`}),rx=f({name:"subgroupBroadcast",signature:(...e)=>{let t=fe([e[1]],[j,x]);if(!t)throw new Error(`subgroupBroadcast's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ue,codegenImpl:(e,t)=>c`subgroupBroadcast(${e}, ${t})`}),nx=f({name:"subgroupBroadcastFirst",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupBroadcastFirst(${e})`}),ix=f({name:"subgroupElect",signature:{argTypes:[],returnType:C},normalImpl:ue,codegenImpl:()=>c`subgroupElect()`}),sx=f({name:"subgroupMax",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupMax(${e})`}),ax=f({name:"subgroupMin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupMin(${e})`}),ox=f({name:"subgroupMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupMul(${e})`}),ux=f({name:"subgroupExclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupExclusiveMul(${e})`}),lx=f({name:"subgroupInclusiveMul",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupInclusiveMul(${e})`}),hx=f({name:"subgroupOr",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupOr(${e})`}),cx=f({name:"subgroupShuffle",signature:(...e)=>{let t=fe([e[1]],[j,x]);if(!t)throw new Error(`subgroupShuffle's second argument has to be compatible with i32 or u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ue,codegenImpl:(e,t)=>c`subgroupShuffle(${e}, ${t})`}),px=f({name:"subgroupShuffleDown",signature:(...e)=>{let t=fe([e[1]],[x]);if(!t)throw new Error(`subgroupShuffleDown's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ue,codegenImpl:(e,t)=>c`subgroupShuffleDown(${e}, ${t})`}),fx=f({name:"subgroupShuffleUp",signature:(...e)=>{let t=fe([e[1]],[x]);if(!t)throw new Error(`subgroupShuffleUp's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ue,codegenImpl:(e,t)=>c`subgroupShuffleUp(${e}, ${t})`}),dx=f({name:"subgroupShuffleXor",signature:(...e)=>{let t=fe([e[1]],[x]);if(!t)throw new Error(`subgroupShuffleXor's second argument has to be compatible with u32. Got: ${e[1].type}`);return{argTypes:[e[0],t[0]],returnType:e[0]}},normalImpl:ue,codegenImpl:(e,t)=>c`subgroupShuffleXor(${e}, ${t})`}),mx=f({name:"subgroupXor",signature:e=>({argTypes:[e],returnType:e}),normalImpl:ue,codegenImpl:e=>c`subgroupXor(${e})`}),yx=Ft(e=>{let t=Ue();if(!t)throw new Error("Functions using `extensionEnabled` cannot be called directly. Either generate WGSL from them, or use tgpu['~unstable'].simulate(...)");if(typeof e!="string"||!Cs.includes(e))throw new Error(`extensionEnabled has to be called with a string literal representing a valid WGSL extension name. Got: '${e}'`);return(t.enableExtensions??[]).includes(e)});const gx=Object.freeze(Object.defineProperty({__proto__:null,abs:vf,acos:bf,acosh:_f,add:kt,all:xm,allEq:vu,and:wm,any:vm,arrayLength:Pw,asin:If,asinh:Ef,atan:Vf,atan2:Of,atanh:Pf,atomicAdd:yw,atomicAnd:vw,atomicLoad:fw,atomicMax:ww,atomicMin:xw,atomicOr:$w,atomicStore:mw,atomicSub:gw,atomicXor:bw,bitcastU32toF32:gu,bitcastU32toI32:wu,ceil:fu,clamp:Cf,cos:Gf,cosh:jf,countLeadingZeros:Rf,countOneBits:Nf,countTrailingZeros:Df,cross:qf,degrees:Yf,determinant:Xf,discard:Xg,distance:du,div:fi,dot:mu,dot4I8Packed:Zf,dot4U8Packed:Hf,dpdx:Tw,dpdxCoarse:_w,dpdxFine:zw,dpdy:Iw,dpdyCoarse:Sw,dpdyFine:Ew,eq:hm,exp:Kf,exp2:td,extensionEnabled:yx,extractBits:rd,faceForward:nd,firstLeadingBit:id,firstTrailingBit:sd,floor:od,fma:ld,fract:cd,frexp:fd,fwidth:Mw,fwidthCoarse:Vw,fwidthFine:Uw,ge:mm,gt:dm,identity2:Oo,identity3:Ao,identity4:Bo,insertBits:dd,inverseSqrt:yd,isCloseTo:$m,ldexp:gd,le:fm,length:en,log:vd,log2:bd,lt:pm,max:_d,min:Id,mix:Ed,mod:ip,modf:Vd,mul:Ht,ne:cm,neg:Go,normalize:Ud,not:ym,or:gm,pack2x16float:om,pack4x8unorm:lm,pow:yu,quantizeToF16:kd,radians:Ad,reflect:Bd,refract:Cd,reverseBits:Fd,rotateX4:ow,rotateY4:uw,rotateZ4:lw,rotationX4:hi,rotationY4:ci,rotationZ4:pi,round:Ld,saturate:Rd,scale4:aw,scaling4:li,select:Tm,sign:Dd,sin:Wd,sinh:Xd,smoothstep:Hd,sqrt:Jd,step:em,storageBarrier:cw,sub:nr,subgroupAdd:Qw,subgroupAll:Jw,subgroupAnd:Kw,subgroupAny:ex,subgroupBallot:tx,subgroupBroadcast:rx,subgroupBroadcastFirst:nx,subgroupElect:ix,subgroupExclusiveAdd:Hw,subgroupExclusiveMul:ux,subgroupInclusiveAdd:Zw,subgroupInclusiveMul:lx,subgroupMax:sx,subgroupMin:ax,subgroupMul:ox,subgroupOr:hx,subgroupShuffle:cx,subgroupShuffleDown:px,subgroupShuffleUp:fx,subgroupShuffleXor:dx,subgroupXor:mx,tan:rm,tanh:im,textureBarrier:pw,textureDimensions:Dw,textureLoad:Lw,textureSample:Ow,textureSampleBaseClampToEdge:Xw,textureSampleBias:Bw,textureSampleCompare:Ww,textureSampleLevel:Fw,textureStore:Rw,translate4:sw,translation4:ui,transpose:sm,trunc:am,unpack2x16float:xu,unpack4x8unorm:um,workgroupBarrier:hw},Symbol.toStringTag,{value:"Module"}));var wx=Pl('<div class="w-screen h-screen flex justify-center items-center bg-white"><canvas class="border-0 border-black bg-black">');const xx=()=>{let e;Tl(async()=>{const r=e.getContext("2d");e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio,e.style.width=`${window.innerWidth}px`,e.style.height=`${window.innerHeight}px`;const n=Math.min(e.width,e.height),i=["","",""],s=.02/1e3*(e.width+e.height)/2;r.font=`${s*1.25/.02}em serif`;const a=500,o=1e3,u=4e-7/.03*s,l=.002/.03*s,p=await Ma.init(),d=(globalThis.__TYPEGPU_AUTONAME__??(ee=>ee))(p.createMutable(_,_(e.width/o,e.height/o)),"renderSize");window.addEventListener("resize",()=>{e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio,e.style.width=`${window.innerWidth}px`,e.style.height=`${window.innerHeight}px`,r.font=`${s*1.25/.02}em serif`,d.write(_(e.width/o,e.height/o))});const y=(globalThis.__TYPEGPU_AUTONAME__??(ee=>ee))(ai({position:_,velocity:_,sign:j}),"ParticleData"),$=[0,1].map(()=>p.createBuffer(Qt(y,a)).$usage("storage")),T=[{x:.2*e.width/o,y:.6*e.height/o,radius:.2*n/o,num:a/3|0,sign:0},{x:.8*e.width/o,y:.65*e.height/o,radius:.2*n/o,num:a/3|0,sign:1},{x:.5*e.width/o,y:.25*e.height/o,radius:.2*n/o,num:a-a/3|0,sign:2}];(()=>{const ee=[];for(const Ie of T)for(let te=0;te<Ie.num;te++){const ke=Math.random()*Math.PI*2,pt=Math.random()*Ie.radius;ee.push({position:_(Ie.x+Math.cos(ke)*pt,Ie.y+Math.sin(ke)*pt),velocity:_(Math.random()*.001-5e-4,Math.random()*.001-5e-4),sign:Ie.sign})}$[0].write(ee),$[1].write(ee)})();const Y=Qt(y),D=(globalThis.__TYPEGPU_AUTONAME__??(ee=>ee))(Ma.bindGroupLayout({currentPoints:{storage:Y,access:"readonly"},nextPoints:{storage:Y,access:"mutable"}}),"computeBindGroupLayout"),{currentPoints:Te,nextPoints:Mt}=D.bound,or=(ee=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(ee.f=((Ie,te)=>{"use gpu";let ke=(te-Ie+3)%3;return ke===2&&(ke=-1),ke}),{v:1,name:"attractOrder",ast:{params:[{type:"i",name:"self"},{type:"i",name:"other"}],body:[0,[[12,"relation",[1,[1,[1,"other","-","self"],"+",[5,"3"]],"%",[5,"3"]]],[11,[1,"relation","===",[5,"2"]],[0,[[2,"relation","=",[4,"-",[5,"1"]]]]]],[10,"relation"]]],externalNames:[]},externals:()=>({})})&&ee.f)({}),ct=(ee=>(globalThis.__TYPEGPU_META__??=new WeakMap).set(ee.f=(Ie=>{"use gpu";const te=y(Te.value[Ie]);let ke=_();for(let vn=x(0);vn<Te.value.length;vn++){if(vn===Ie)continue;const $n=Te.value[vn],js=or(te.sign,$n.sign);if(js===-1&&du(te.position,$n.position)<s){te.sign=$n.sign;continue}const gl=u*v(js),Rs=[_(0,0),_(d.$.x,0),_(-d.$.x,0),_(0,d.$.y),_(0,-d.$.y),_(d.$.x,d.$.y),_(-d.$.x,-d.$.y),_(-d.$.x,d.$.y),_(d.$.x,-d.$.y)];let $i=_();for(let bi=0;bi<Rs.length;bi++){const wl=Rs[bi],Ns=nr(kt($n.position,wl),te.position);$i=kt($i,fi(Ns,en(Ns)**3))}ke=kt(ke,Ht(gl,$i))}const pt=kt(te.velocity,ke);en(pt)>l?te.velocity=Ht(pt,l/en(pt)):te.velocity=_(pt),te.position.x=(te.position.x+d.$.x)%d.$.x,te.position.y=(te.position.y+d.$.y)%d.$.y,te.position=kt(te.position,te.velocity),Mt.value[Ie]=y(te)}),{v:1,name:"simulate",ast:{params:[{type:"i",name:"index"}],body:[0,[[13,"instanceInfo",[6,"ParticleData",[[8,[7,"currentPoints","value"],"index"]]]],[12,"dVel",[6,[7,"d","vec2f"],[]]],[14,[12,"j",[6,[7,"d","u32"],[[5,"0"]]]],[1,"j","<",[7,[7,"currentPoints","value"],"length"]],[102,"++","j"],[0,[[11,[1,"j","===","index"],[16]],[13,"other",[8,[7,"currentPoints","value"],"j"]],[13,"attrOrder",[6,"attractOrder",[[7,"instanceInfo","sign"],[7,"other","sign"]]]],[11,[3,[1,"attrOrder","===",[4,"-",[5,"1"]]],"&&",[1,[6,[7,"std","distance"],[[7,"instanceInfo","position"],[7,"other","position"]]],"<","charRadius"]],[0,[[2,[7,"instanceInfo","sign"],"=",[7,"other","sign"]],[16]]]],[13,"attraction",[1,"ATTRACTION_CONST","*",[6,[7,"d","f32"],["attrOrder"]]]],[13,"shifts",[100,[[6,[7,"d","vec2f"],[[5,"0"],[5,"0"]]],[6,[7,"d","vec2f"],[[7,[7,"renderSize","$"],"x"],[5,"0"]]],[6,[7,"d","vec2f"],[[4,"-",[7,[7,"renderSize","$"],"x"]],[5,"0"]]],[6,[7,"d","vec2f"],[[5,"0"],[7,[7,"renderSize","$"],"y"]]],[6,[7,"d","vec2f"],[[5,"0"],[4,"-",[7,[7,"renderSize","$"],"y"]]]],[6,[7,"d","vec2f"],[[7,[7,"renderSize","$"],"x"],[7,[7,"renderSize","$"],"y"]]],[6,[7,"d","vec2f"],[[4,"-",[7,[7,"renderSize","$"],"x"]],[4,"-",[7,[7,"renderSize","$"],"y"]]]],[6,[7,"d","vec2f"],[[4,"-",[7,[7,"renderSize","$"],"x"]],[7,[7,"renderSize","$"],"y"]]],[6,[7,"d","vec2f"],[[7,[7,"renderSize","$"],"x"],[4,"-",[7,[7,"renderSize","$"],"y"]]]]]]],[12,"strength",[6,[7,"d","vec2f"],[]]],[14,[12,"i",[5,"0"]],[1,"i","<",[7,"shifts","length"]],[102,"++","i"],[0,[[13,"shift",[8,"shifts","i"]],[13,"r",[6,[7,"std","sub"],[[6,[7,"std","add"],[[7,"other","position"],"shift"]],[7,"instanceInfo","position"]]]],[2,"strength","=",[6,[7,"std","add"],["strength",[6,[7,"std","div"],["r",[1,[6,[7,"std","length"],["r"]],"**",[5,"3"]]]]]]]]]],[2,"dVel","=",[6,[7,"std","add"],["dVel",[6,[7,"std","mul"],["attraction","strength"]]]]]]]],[13,"resultVel",[6,[7,"std","add"],[[7,"instanceInfo","velocity"],"dVel"]]],[11,[1,[6,[7,"std","length"],["resultVel"]],">","MAX_VELOCITY"],[0,[[2,[7,"instanceInfo","velocity"],"=",[6,[7,"std","mul"],["resultVel",[1,"MAX_VELOCITY","/",[6,[7,"std","length"],["resultVel"]]]]]]]],[0,[[2,[7,"instanceInfo","velocity"],"=",[6,[7,"d","vec2f"],["resultVel"]]]]]],[2,[7,[7,"instanceInfo","position"],"x"],"=",[1,[1,[7,[7,"instanceInfo","position"],"x"],"+",[7,[7,"renderSize","$"],"x"]],"%",[7,[7,"renderSize","$"],"x"]]],[2,[7,[7,"instanceInfo","position"],"y"],"=",[1,[1,[7,[7,"instanceInfo","position"],"y"],"+",[7,[7,"renderSize","$"],"y"]],"%",[7,[7,"renderSize","$"],"y"]]],[2,[7,"instanceInfo","position"],"=",[6,[7,"std","add"],[[7,"instanceInfo","position"],[7,"instanceInfo","velocity"]]]],[2,[8,[7,"nextPoints","value"],"index"],"=",[6,"ParticleData",["instanceInfo"]]]]],externalNames:["ParticleData","currentPoints","d","attractOrder","std","charRadius","ATTRACTION_CONST","renderSize","MAX_VELOCITY","nextPoints"]},externals:()=>({ParticleData:y,currentPoints:Te,d:Yg,attractOrder:or,std:gx,charRadius:s,ATTRACTION_CONST:u,renderSize:d,MAX_VELOCITY:l,nextPoints:Mt})})&&ee.f)({}),ur=(globalThis.__TYPEGPU_AUTONAME__??(ee=>ee))(p["~unstable"].createGuardedComputePipeline(ct),"simulatePipeline"),jr=[0,1].map(ee=>p.createBindGroup(D,{currentPoints:$[ee],nextPoints:$[1-ee]}));let Vt=!1;const xn=()=>{Vt=!Vt,$[Vt?0:1].read().then(ee=>{r.clearRect(0,0,e.width,e.height);for(const Ie of ee){const{position:{x:te,y:ke},sign:pt}=Ie;r.strokeText(i[pt],te*o,ke*o)}}),ur.with(jr[Vt?0:1]).dispatchThreads(a),requestAnimationFrame(xn)};requestAnimationFrame(xn)});let t;return(()=>{var r=wx(),n=r.firstChild,i=t;typeof i=="function"?Ds(i,r):t=r;var s=e;return typeof s=="function"?Ds(s,n):e=n,r})()},vx=document.getElementById("root");Ul(()=>Ml(xx,{}),vx);
